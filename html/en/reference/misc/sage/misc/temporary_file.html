
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="viewport" content="width=600, initial-scale=1">
    <title>Temporary file handling &#8212; Sage 9.3 Reference Manual: Utilities</title>
    <link rel="stylesheet" href="../../../_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script async="async" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="get_remote_file" href="remote_file.html" />
    <link rel="prev" title="Elements with labels." href="element_with_label.html" />
    <link rel="icon" href="../../../_static/sageicon.png" type="image/x-icon" />
    <script src="../../../_static/thebe.js" type="text/javascript"></script>
    <script src="../../../_static/thebe-sage.js" type="text/javascript"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="remote_file.html" title="get_remote_file"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="element_with_label.html" title="Elements with labels."
             accesskey="P">previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Sage 9.3 Reference Manual: Utilities</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Temporary file handling</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="temporary-file-handling">
<span id="sage-misc-temporary-file"></span><h1>Temporary file handling<a class="headerlink" href="#temporary-file-handling" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-sage.misc.temporary_file"></span><p>AUTHORS:</p>
<ul class="simple">
<li><p>Volker Braun, Jeroen Demeyer (2012-10-18): move these functions here
from sage/misc/misc.py and make them secure, see <a class="reference external" href="https://trac.sagemath.org/13579">trac ticket #13579</a>.</p></li>
<li><p>Jeroen Demeyer (2013-03-17): add <a class="reference internal" href="#sage.misc.temporary_file.atomic_write" title="sage.misc.temporary_file.atomic_write"><code class="xref py py-class docutils literal notranslate"><span class="pre">atomic_write</span></code></a>,
see <a class="reference external" href="https://trac.sagemath.org/14292">trac ticket #14292</a>.</p></li>
</ul>
<dl class="py class">
<dt id="sage.misc.temporary_file.atomic_write">
<em class="property">class </em><code class="sig-prename descclassname">sage.misc.temporary_file.</code><code class="sig-name descname">atomic_write</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target_filename</span></em>, <em class="sig-param"><span class="n">append</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">438</span></em>, <em class="sig-param"><span class="n">binary</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.temporary_file.atomic_write" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Write to a given file using a temporary file and then rename it
to the target file. This renaming should be atomic on modern
operating systems. Therefore, this class can be used to avoid race
conditions when a file might be read while it is being written.
It also avoids having partially written files due to exceptions
or crashes.</p>
<p>This is to be used in a <code class="docutils literal notranslate"><span class="pre">with</span></code> statement, where a temporary file
is created when entering the <code class="docutils literal notranslate"><span class="pre">with</span></code> and is moved in place of the
target file when exiting the <code class="docutils literal notranslate"><span class="pre">with</span></code> (if no exceptions occurred).</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">target_filename</span></code> – the name of the file to be written.
Normally, the contents of this file will be overwritten.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">append</span></code> – (boolean, default: False) if True and
<code class="docutils literal notranslate"><span class="pre">target_filename</span></code> is an existing file, then copy the current
contents of <code class="docutils literal notranslate"><span class="pre">target_filename</span></code> to the temporary file when
entering the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement. Otherwise, the temporary file is
initially empty.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code> – (default: <code class="docutils literal notranslate"><span class="pre">0o666</span></code>) mode bits for the file. The
temporary file is created with mode <code class="docutils literal notranslate"><span class="pre">mode</span> <span class="pre">&amp;</span> <span class="pre">~umask</span></code> and the
resulting file will also have these permissions (unless the
mode bits of the file were changed manually). (Not to be confused with
the file opening mode.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">binary</span></code> – (boolean, default: True on Python 2, False on Python 3) the
underlying file is opened in binary mode.  If False then it is opened in
text mode and an encoding with which to write the file may be supplied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> – additional keyword arguments passed to the underlying
<span class="math notranslate nohighlight">\(io.open\)</span> call.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.temporary_file</span> <span class="kn">import</span> <span class="n">atomic_write</span>
<span class="gp">sage: </span><span class="n">target_file</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Old contents&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;New contents&quot;</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
<span class="gp">....: </span>        <span class="n">f2</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;Old contents&#39;</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;New contents&#39;</span>
</pre></div>
</div>
<p>The name of the temporary file can be accessed using <code class="docutils literal notranslate"><span class="pre">f.name</span></code>.
It is not a problem to close and re-open the temporary file:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.temporary_file</span> <span class="kn">import</span> <span class="n">atomic_write</span>
<span class="gp">sage: </span><span class="n">target_file</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Old contents&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
<span class="gp">....: </span>        <span class="n">_</span> <span class="o">=</span> <span class="n">f2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Newer contents&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;Newer contents&#39;</span>
</pre></div>
</div>
<p>If an exception occurs while writing the file, the target file is
not touched:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Newest contents&quot;</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">RuntimeError</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;Newer contents&#39;</span>
</pre></div>
</div>
<p>Some examples of using the <code class="docutils literal notranslate"><span class="pre">append</span></code> option. Note that the file
is never opened in “append” mode, it is possible to overwrite
existing data:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">target_file</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; World&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;Hello World&#39;</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;HELLO&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;HELLO World&#39;</span>
</pre></div>
</div>
<p>If the target file is a symbolic link, the link is kept and the
target of the link is written to:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">link_to_target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">(),</span> <span class="s2">&quot;templink&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">link_to_target</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">link_to_target</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Newest contents&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;Newest contents&#39;</span>
</pre></div>
</div>
<p>We check the permission bits of the new file. Note that the old
permissions do not matter:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="mi">0</span><span class="n">o600</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="mi">0</span><span class="n">o022</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="k">pass</span>
<span class="gp">sage: </span><span class="s1">&#39;{:#o}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">target_file</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o777</span><span class="p">)</span>
<span class="go">&#39;0o644&#39;</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">umask</span><span class="p">(</span><span class="mi">0</span><span class="n">o077</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="n">o777</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="k">pass</span>
<span class="gp">sage: </span><span class="s1">&#39;{:#o}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">target_file</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o777</span><span class="p">)</span>
<span class="go">&#39;0o700&#39;</span>
</pre></div>
</div>
<p>Test writing twice to the same target file. The outermost <code class="docutils literal notranslate"><span class="pre">with</span></code>
“wins”:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt; &#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">,</span>         <span class="o">....</span><span class="p">:</span>          <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;AAA&quot;</span><span class="p">);</span> <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;BBB&quot;</span><span class="p">);</span> <span class="n">g</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;&gt;&gt;&gt; AAA&#39;</span>
</pre></div>
</div>
<p>Supplying an encoding means we’re writing the file in “text mode” (in the
same sense as <span class="math notranslate nohighlight">\(io.open\)</span>) and so we must write unicode strings:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">target_file</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="gp">....: </span>                  <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Hélas&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">io</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="go">Hélas</span>
</pre></div>
</div>
<p>Supplying an encoding in binary mode (or other arguments that don’t
make sense to <span class="math notranslate nohighlight">\(io.open\)</span> in binary mode) is an error:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">writer</span> <span class="o">=</span> <span class="n">atomic_write</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="gp">....: </span>                      <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">writer</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">ValueError: binary mode doesn&#39;t take an encoding argument</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">writer</span><span class="o">.</span><span class="n">tempname</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.misc.temporary_file.delete_tmpfiles">
<code class="sig-prename descclassname">sage.misc.temporary_file.</code><code class="sig-name descname">delete_tmpfiles</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.temporary_file.delete_tmpfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove the directory <code class="docutils literal notranslate"><span class="pre">SAGE_TMP</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt id="sage.misc.temporary_file.tmp_dir">
<code class="sig-prename descclassname">sage.misc.temporary_file.</code><code class="sig-name descname">tmp_dir</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">'dir_'</span></em>, <em class="sig-param"><span class="n">ext</span><span class="o">=</span><span class="default_value">''</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.temporary_file.tmp_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Create and return a temporary directory in
<code class="docutils literal notranslate"><span class="pre">$HOME/.sage/temp/hostname/pid/</span></code></p>
<p>The temporary directory is deleted automatically when Sage exits.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> – (default: <code class="docutils literal notranslate"><span class="pre">&quot;dir_&quot;</span></code>) A prefix for the directory name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ext</span></code> – (default: <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>) A suffix for the directory name.</p></li>
</ul>
<p>OUTPUT:</p>
<p>The absolute path of the temporary directory created, with a
trailing slash (or whatever the path separator is on your OS).</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">d</span> <span class="o">=</span> <span class="n">tmp_dir</span><span class="p">(</span><span class="s1">&#39;dir_testing_&#39;</span><span class="p">,</span> <span class="s1">&#39;.extension&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">d</span>   <span class="c1"># random output</span>
<span class="go">&#39;/home/username/.sage/temp/hostname/7961/dir_testing_XgRu4p.extension/&#39;</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file_inside_d&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Temporary directories are unaccessible by other users:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o077</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.misc.temporary_file.tmp_filename">
<code class="sig-prename descclassname">sage.misc.temporary_file.</code><code class="sig-name descname">tmp_filename</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">'tmp_'</span></em>, <em class="sig-param"><span class="n">ext</span><span class="o">=</span><span class="default_value">''</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.temporary_file.tmp_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Create and return a temporary file in
<code class="docutils literal notranslate"><span class="pre">$HOME/.sage/temp/hostname/pid/</span></code></p>
<p>The temporary file is deleted automatically when Sage exits.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you need a particular file extension always use
<code class="docutils literal notranslate"><span class="pre">tmp_filename(ext=&quot;.foo&quot;)</span></code>, this will ensure that the file
does not yet exist. If you were to use
<code class="docutils literal notranslate"><span class="pre">tmp_filename()+&quot;.foo&quot;</span></code>, then you might overwrite an
existing file!</p>
</div>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> – (default: <code class="docutils literal notranslate"><span class="pre">&quot;tmp_&quot;</span></code>) A prefix for the file name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ext</span></code> – (default: <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>) A suffix for the file name. If you
want a filename extension in the usual sense, this should start
with a dot.</p></li>
</ul>
<p>OUTPUT:</p>
<p>The absolute path of the temporary file created.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fn</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">(</span><span class="s1">&#39;just_for_testing_&#39;</span><span class="p">,</span> <span class="s1">&#39;.extension&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">fn</span>  <span class="c1"># random</span>
<span class="go">&#39;/home/username/.sage/temp/hostname/8044/just_for_testing_tVVHsn.extension&#39;</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Temporary files are unaccessible by other users:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="n">o077</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="element_with_label.html"
                        title="previous chapter">Elements with labels.</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="remote_file.html"
                        title="next chapter">get_remote_file</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/sage/misc/temporary_file.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="remote_file.html" title="get_remote_file"
             >next</a> |</li>
        <li class="right" >
          <a href="element_with_label.html" title="Elements with labels."
             >previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Sage 9.3 Reference Manual: Utilities</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Temporary file handling</a></li> 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005--2021, The Sage Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* The sidebar toggle adapts its height to the bodywrapper height. */
    const resizeObserver = new ResizeObserver(entries => {
        tog.height(bod.height());
    });
    resizeObserver.observe(bod[0]);

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>