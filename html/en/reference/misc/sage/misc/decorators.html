
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="viewport" content="width=600, initial-scale=1">
    <title>Decorators &#8212; Sage 9.3 Reference Manual: Utilities</title>
    <link rel="stylesheet" href="../../../_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script async="async" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Constant functions" href="constant_function.html" />
    <link rel="prev" title="Bindable classes" href="bindable_class.html" />
    <link rel="icon" href="../../../_static/sageicon.png" type="image/x-icon" />
    <script src="../../../_static/thebe.js" type="text/javascript"></script>
    <script src="../../../_static/thebe-sage.js" type="text/javascript"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="constant_function.html" title="Constant functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="bindable_class.html" title="Bindable classes"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Sage 9.3 Reference Manual: Utilities</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Decorators</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="decorators">
<span id="sage-misc-decorators"></span><h1>Decorators<a class="headerlink" href="#decorators" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-sage.misc.decorators"></span><p>Python decorators for use in Sage.</p>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>Tim Dumol (5 Dec 2009) – initial version.</p></li>
<li><p>Johan S. R. Nielsen (2010) – collect decorators from various modules.</p></li>
<li><p>Johan S. R. Nielsen (8 apr 2011) – improve introspection on decorators.</p></li>
<li><p>Simon King (2011-05-26) – improve introspection of sage_wraps. Put this
file into the reference manual.</p></li>
<li><p>Julian Rueth (2014-03-19): added <code class="docutils literal notranslate"><span class="pre">decorator_keywords</span></code> decorator</p></li>
</ul>
<dl class="py function">
<dt id="sage.misc.decorators.decorator_defaults">
<code class="sig-prename descclassname">sage.misc.decorators.</code><code class="sig-name descname">decorator_defaults</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.decorators.decorator_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>This function allows a decorator to have default arguments.</p>
<p>Normally, a decorator can be called with or without arguments.
However, the two cases call for different types of return values.
If a decorator is called with no parentheses, it should be run
directly on the function.  However, if a decorator is called with
parentheses (i.e., arguments), then it should return a function
that is then in turn called with the defined function as an
argument.</p>
<p>This decorator allows us to have these default arguments without
worrying about the return type.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.decorators</span> <span class="kn">import</span> <span class="n">decorator_defaults</span>
<span class="gp">sage: </span><span class="nd">@decorator_defaults</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">my_decorator</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="gp">....: </span>  <span class="k">print</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>
<span class="gp">....: </span>  <span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="gp">....: </span>  <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

<span class="gp">sage: </span><span class="nd">@my_decorator</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">my_fun</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
<span class="gp">....: </span>  <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
<span class="go">{}</span>
<span class="go">()</span>
<span class="go">my_fun</span>
<span class="gp">sage: </span><span class="nd">@my_decorator</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">my_fun</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
<span class="gp">....: </span>  <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
<span class="go">{&#39;c&#39;: 1, &#39;d&#39;: 2}</span>
<span class="go">(3, 4)</span>
<span class="go">my_fun</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.misc.decorators.decorator_keywords">
<code class="sig-prename descclassname">sage.misc.decorators.</code><code class="sig-name descname">decorator_keywords</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.decorators.decorator_keywords" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator for decorators with optional keyword arguments.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.decorators</span> <span class="kn">import</span> <span class="n">decorator_keywords</span>
<span class="gp">sage: </span><span class="nd">@decorator_keywords</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">processor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">if</span> <span class="n">processor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="gp">....: </span>            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">processor</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>
</div>
<p>This decorator can be called with and without arguments:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nd">@preprocess</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>
<span class="gp">sage: </span><span class="n">foo</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">1</span>

<span class="gp">sage: </span><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="p">((</span><span class="mi">0</span><span class="p">,),{})</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">((</span><span class="n">x</span><span class="p">,),{})</span>
<span class="gp">sage: </span><span class="nd">@preprocess</span><span class="p">(</span><span class="n">processor</span><span class="o">=</span><span class="n">normalize</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>
<span class="gp">sage: </span><span class="n">foo</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="sage.misc.decorators.infix_operator">
<em class="property">class </em><code class="sig-prename descclassname">sage.misc.decorators.</code><code class="sig-name descname">infix_operator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">precedence</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.decorators.infix_operator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A decorator for functions which allows for a hack that makes
the function behave like an infix operator.</p>
<p>This decorator exists as a convenience for interactive use.</p>
<p>EXAMPLES:</p>
<p>An infix dot product operator:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nd">@infix_operator</span><span class="p">(</span><span class="s1">&#39;multiply&#39;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="sd">&#39;&#39;&#39;Dot product.&#39;&#39;&#39;</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">dot_product</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">u</span> <span class="o">=</span> <span class="n">vector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="n">vector</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">u</span> <span class="o">*</span><span class="n">dot</span><span class="o">*</span> <span class="n">v</span>
<span class="go">22</span>
</pre></div>
</div>
<p>An infix element-wise addition operator:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nd">@infix_operator</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">eadd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">....: </span>  <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">parent</span><span class="p">([</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)])</span>
<span class="gp">sage: </span><span class="n">u</span> <span class="o">=</span> <span class="n">vector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="n">vector</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">u</span> <span class="o">+</span><span class="n">eadd</span><span class="o">+</span> <span class="n">v</span>
<span class="go">(6, 6, 6)</span>
<span class="gp">sage: </span><span class="mi">2</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span><span class="n">eadd</span><span class="o">+</span> <span class="n">v</span>
<span class="go">(7, 8, 9)</span>
</pre></div>
</div>
<p>A hack to simulate a postfix operator:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nd">@infix_operator</span><span class="p">(</span><span class="s1">&#39;or&#39;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">thendo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">b</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">|</span><span class="n">thendo</span><span class="o">|</span> <span class="n">cos</span> <span class="o">|</span><span class="n">thendo</span><span class="o">|</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
<span class="go">cos(x)^2</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="sage.misc.decorators.options">
<em class="property">class </em><code class="sig-prename descclassname">sage.misc.decorators.</code><code class="sig-name descname">options</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.decorators.options" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A decorator for functions which allows for default options to be
set and reset by the end user.  Additionally, if one needs to, one
can get at the original keyword arguments passed into the
decorator.</p>
</dd></dl>

<dl class="py class">
<dt id="sage.misc.decorators.rename_keyword">
<em class="property">class </em><code class="sig-prename descclassname">sage.misc.decorators.</code><code class="sig-name descname">rename_keyword</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">deprecated</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">deprecation</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">renames</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.decorators.rename_keyword" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A decorator which renames keyword arguments and optionally
deprecates the new keyword.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">deprecation</span></code> – integer. The trac ticket number where the
deprecation was introduced.</p></li>
<li><p>the rest of the arguments is a list of keyword arguments in the
form <code class="docutils literal notranslate"><span class="pre">renamed_option='existing_option'</span></code>.  This will have the
effect of renaming <code class="docutils literal notranslate"><span class="pre">renamed_option</span></code> so that the function only
sees <code class="docutils literal notranslate"><span class="pre">existing_option</span></code>.  If both <code class="docutils literal notranslate"><span class="pre">renamed_option</span></code> and
<code class="docutils literal notranslate"><span class="pre">existing_option</span></code> are passed to the function, <code class="docutils literal notranslate"><span class="pre">existing_option</span></code>
will override the <code class="docutils literal notranslate"><span class="pre">renamed_option</span></code> value.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.decorators</span> <span class="kn">import</span> <span class="n">rename_keyword</span>
<span class="gp">sage: </span><span class="n">r</span> <span class="o">=</span> <span class="n">rename_keyword</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgbcolor&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">r</span><span class="o">.</span><span class="n">renames</span>
<span class="go">{&#39;color&#39;: &#39;rgbcolor&#39;}</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">r</span><span class="p">))</span><span class="o">.</span><span class="n">renames</span>
<span class="go">{&#39;color&#39;: &#39;rgbcolor&#39;}</span>
</pre></div>
</div>
<p>To deprecate an old keyword:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">r</span> <span class="o">=</span> <span class="n">rename_keyword</span><span class="p">(</span><span class="n">deprecation</span><span class="o">=</span><span class="mi">13109</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgbcolor&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.misc.decorators.sage_wraps">
<code class="sig-prename descclassname">sage.misc.decorators.</code><code class="sig-name descname">sage_wraps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">wrapped</span></em>, <em class="sig-param"><span class="n">assigned</span><span class="o">=</span><span class="default_value">'__module__', '__name__', '__qualname__', '__doc__', '__annotations__'</span></em>, <em class="sig-param"><span class="n">updated</span><span class="o">=</span><span class="default_value">'__dict__'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.decorators.sage_wraps" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator factory which should be used in decorators for making sure that
meta-information on the decorated callables are retained through the
decorator, such that the introspection functions of
<code class="docutils literal notranslate"><span class="pre">sage.misc.sageinspect</span></code> retrieves them correctly. This includes
documentation string, source, and argument specification. This is an
extension of the Python standard library decorator functools.wraps.</p>
<p>That the argument specification is retained from the decorated functions
implies, that if one uses <code class="docutils literal notranslate"><span class="pre">sage_wraps</span></code> in a decorator which intentionally
changes the argument specification, one should add this information to
the special attribute <code class="docutils literal notranslate"><span class="pre">_sage_argspec_</span></code> of the wrapping function (for an
example, see e.g. <code class="docutils literal notranslate"><span class="pre">&#64;options</span></code> decorator in this module).</p>
<p>EXAMPLES:</p>
<p>Demonstrate that documentation string and source are retained from the
decorated function:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="nd">@sage_wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">new_f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">new_f</span>
<span class="gp">sage: </span><span class="nd">@square</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="s2">&quot;My little function&quot;</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">x</span>
<span class="gp">sage: </span><span class="n">g</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">sage: </span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">x^2</span>
<span class="gp">sage: </span><span class="n">g</span><span class="o">.</span><span class="vm">__doc__</span>
<span class="go">&#39;My little function&#39;</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.sageinspect</span> <span class="kn">import</span> <span class="n">sage_getsource</span><span class="p">,</span> <span class="n">sage_getsourcelines</span><span class="p">,</span> <span class="n">sage_getfile</span>
<span class="gp">sage: </span><span class="n">sage_getsource</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">&#39;@square...def g(x)...&#39;</span>
</pre></div>
</div>
<p>Demonstrate that the argument description are retained from the
decorated function through the special method (when left
unchanged) (see <a class="reference external" href="https://trac.sagemath.org/9976">trac ticket #9976</a>):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">diff_arg_dec</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="nd">@sage_wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">new_f</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">some_def_arg</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">some_def_arg</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">new_f</span>
<span class="gp">sage: </span><span class="nd">@diff_arg_dec</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">x</span>
<span class="gp">sage: </span><span class="n">g</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">sage: </span><span class="n">g</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">some_def_arg</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">5</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.sageinspect</span> <span class="kn">import</span> <span class="n">sage_getargspec</span>
<span class="gp">sage: </span><span class="n">sage_getargspec</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="go">ArgSpec(args=[&#39;x&#39;], varargs=None, keywords=None, defaults=None)</span>
</pre></div>
</div>
<p>Demonstrate that it correctly gets the source lines and the source
file, which is essential for interactive code edition; note that we
do not test the line numbers, as they may easily change:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">P</span><span class="o">.&lt;</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">I</span> <span class="o">=</span> <span class="n">P</span><span class="o">*</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">sage_getfile</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">interreduced_basis</span><span class="p">)</span>       <span class="c1"># known bug</span>
<span class="go">&#39;.../sage/rings/polynomial/multi_polynomial_ideal.py&#39;</span>
<span class="gp">sage: </span><span class="n">sage_getsourcelines</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">interreduced_basis</span><span class="p">)</span>
<span class="go">([&#39;    @handle_AA_and_QQbar\n&#39;,</span>
<span class="go">  &#39;    @singular_gb_standard_options\n&#39;,</span>
<span class="go">  &#39;    @libsingular_gb_standard_options\n&#39;,</span>
<span class="go">  &#39;    def interreduced_basis(self):\n&#39;,</span>
<span class="go">  ...</span>
<span class="go">  &#39;        return self.basis.reduced()\n&#39;], ...)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">f</span></code> attribute of the decorated function refers to the
original function:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">foo</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nd">@sage_wraps</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
<span class="gp">....: </span>    <span class="k">pass</span>
<span class="gp">sage: </span><span class="n">wrapped</span> <span class="o">=</span> <span class="n">sage_wraps</span><span class="p">(</span><span class="n">foo</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">wrapped</span><span class="o">.</span><span class="n">f</span> <span class="ow">is</span> <span class="n">foo</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Demonstrate that sage_wraps works for non-function callables
(<a class="reference external" href="https://trac.sagemath.org/9919">trac ticket #9919</a>):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">square_for_met</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="gp">....: </span>  <span class="nd">@sage_wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">....: </span>  <span class="k">def</span> <span class="nf">new_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">....: </span>      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="gp">....: </span>  <span class="k">return</span> <span class="n">new_f</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
<span class="gp">....: </span>  <span class="nd">@square_for_met</span>
<span class="gp">....: </span>  <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">....: </span>      <span class="s2">&quot;My little method&quot;</span>
<span class="gp">....: </span>      <span class="k">return</span> <span class="n">x</span>
<span class="gp">sage: </span><span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">t</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">sage: </span><span class="n">t</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="vm">__doc__</span>
<span class="go">&#39;My little method&#39;</span>
</pre></div>
</div>
<p>The bug described in <a class="reference external" href="https://trac.sagemath.org/11734">trac ticket #11734</a> is fixed:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="nd">@sage_wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">new_f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">new_f</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span>
<span class="gp">sage: </span><span class="n">g</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">g</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># this line used to fail for some people if these command were manually entered on the sage prompt</span>
<span class="go">81</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="sage.misc.decorators.specialize">
<em class="property">class </em><code class="sig-prename descclassname">sage.misc.decorators.</code><code class="sig-name descname">specialize</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.decorators.specialize" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A decorator generator that returns a decorator that in turn
returns a specialized function for function <code class="docutils literal notranslate"><span class="pre">f</span></code>. In other words,
it returns a function that acts like <code class="docutils literal notranslate"><span class="pre">f</span></code> with arguments
<code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> supplied.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*args</span></code>, <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> – arguments to specialize the function for.</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a decorator that accepts a function <code class="docutils literal notranslate"><span class="pre">f</span></code> and specializes it
with <code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code></p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">specialize</span><span class="p">(</span><span class="mi">5</span><span class="p">)(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">15</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">10</span>
<span class="gp">sage: </span><span class="nd">@specialize</span><span class="p">(</span><span class="s2">&quot;Bon Voyage&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">greeting</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}, {1}!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">greeting</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">greet</span><span class="p">(</span><span class="s2">&quot;Monsieur Jean Valjean&quot;</span><span class="p">)</span>
<span class="go">Bon Voyage, Monsieur Jean Valjean!</span>
<span class="gp">sage: </span><span class="n">greet</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Javert&#39;</span><span class="p">)</span>
<span class="go">Bon Voyage, Javert!</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="sage.misc.decorators.suboptions">
<em class="property">class </em><code class="sig-prename descclassname">sage.misc.decorators.</code><code class="sig-name descname">suboptions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.decorators.suboptions" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A decorator for functions which collects all keywords
starting with <code class="docutils literal notranslate"><span class="pre">name+'_'</span></code> and collects them into a dictionary
which will be passed on to the wrapped function as a
dictionary called <code class="docutils literal notranslate"><span class="pre">name_options</span></code>.</p>
<p>The keyword arguments passed into the constructor are taken
to be default for the <code class="docutils literal notranslate"><span class="pre">name_options</span></code> dictionary.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.decorators</span> <span class="kn">import</span> <span class="n">suboptions</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="n">suboptions</span><span class="p">(</span><span class="s1">&#39;arrow&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">s</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;arrow_&#39;</span>
<span class="gp">sage: </span><span class="n">s</span><span class="o">.</span><span class="n">options</span>
<span class="go">{&#39;size&#39;: 2}</span>
</pre></div>
</div>
</dd></dl>

</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="bindable_class.html"
                        title="previous chapter">Bindable classes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="constant_function.html"
                        title="next chapter">Constant functions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/sage/misc/decorators.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="constant_function.html" title="Constant functions"
             >next</a> |</li>
        <li class="right" >
          <a href="bindable_class.html" title="Bindable classes"
             >previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Sage 9.3 Reference Manual: Utilities</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Decorators</a></li> 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005--2021, The Sage Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* The sidebar toggle adapts its height to the bodywrapper height. */
    const resizeObserver = new ResizeObserver(entries => {
        tog.height(bod.height());
    });
    resizeObserver.observe(bod[0]);

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>