
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=600, initial-scale=1">
    <title>Object persistence &#8212; Sage Reference Manual v8.6: Utilities</title>
    <link rel="stylesheet" href="../../../_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Function pickling" href="fpickle.html" />
    <link rel="prev" title="Support for persistent functions in .sage files" href="func_persist.html" />
    <link rel="icon" href="../../../_static/sageicon.png" type="image/x-icon" />
    <script src="../../../_static/thebe.js" type="text/javascript"></script>
    <script src="../../../_static/thebe-sage.js" type="text/javascript"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="fpickle.html" title="Function pickling"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="func_persist.html" title="Support for persistent functions in .sage files"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Utilities</a> &#187;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="object-persistence">
<span id="sage-misc-persist"></span><h1>Object persistence<a class="headerlink" href="#object-persistence" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-sage.misc.persist"></span><p>You can load and save most Sage object to disk using the load and
save member functions and commands.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is impossible to save certain Sage objects to disk. For example,
if <span class="math notranslate nohighlight">\(x\)</span> is a MAGMA object, i.e., a wrapper around an object
that is defined in MAGMA, there is no way to save <span class="math notranslate nohighlight">\(x\)</span> it to
disk, since MAGMA doesn’t support saving of individual objects to
disk.</p>
</div>
<ul class="simple">
<li>Versions: Loading and saving of objects is guaranteed to work
even if the version of Python changes. Saved objects can be loaded
in future versions of Python. However, if the data structure that
defines the object, e.g., in Sage code, changes drastically (or
changes name or disappears), then the object might not load
correctly or work correctly.</li>
<li>Objects are zlib compressed for space efficiency.</li>
</ul>
<dl class="class">
<dt id="sage.misc.persist.SagePickler">
<em class="property">class </em><code class="descclassname">sage.misc.persist.</code><code class="descname">SagePickler</code><span class="sig-paren">(</span><em>file_obj</em>, <em>persistent_id=None</em>, <em>py2compat=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.SagePickler" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">sage.misc.persist._BasePickler</span></code></p>
<p>Subclass <span class="math notranslate nohighlight">\(pickle.Pickler\)</span> with Sage-specific default options, and
built-in support for external object persistence.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">file_obj</span></code> – a readable file-like object returning <code class="docutils literal notranslate"><span class="pre">bytes</span></code> from
which the pickle data will be loaded.</li>
<li><code class="docutils literal notranslate"><span class="pre">persistent_id</span></code> – callable or None; if given this callable takes a
single object to be pickled, and returns an “ID” (a key with which to
restore the object upon unpickling, which may itself be any pickleable
object).  See the Python documentation on <a class="reference external" href="https://docs.python.org/2.7/library/pickle.html#pickling-and-unpickling-external-objects">pickling and unpickling
external objects</a> for more details.</li>
<li><code class="docutils literal notranslate"><span class="pre">py2compat</span></code> – on Python 3 only, this creates pickles that have a
better chance of being read on Python 2, by using protocol version 2
(instead of 4) and fixing up imports of standard library modules and
types whose names changed between Python 2 and 3.  This is enabled by
default for the best chances of cross-Python compatibility.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.persist</span> <span class="kn">import</span> <span class="p">(</span>
<span class="go">....:     unpickle_override, register_unpickle_override, SageUnpickler)</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.rings.integer</span> <span class="kn">import</span> <span class="n">make_integer</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="gp">sage: </span><span class="k">def</span> <span class="nf">fake_constructor</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="go">....:     print(&quot;unpickling an Integer&quot;)</span>
<span class="go">....:     return make_integer(x)</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;make_integer&#39;</span><span class="p">,</span>
<span class="go">....:                            fake_constructor)</span>
<span class="gp">sage: </span><span class="n">unp</span> <span class="o">=</span> <span class="n">SageUnpickler</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="bp">False</span><span class="p">)))</span>
<span class="gp">sage: </span><span class="n">unp</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="go">unpickling an Integer</span>
<span class="go">1</span>
<span class="gp">sage: </span><span class="k">del</span> <span class="n">unpickle_override</span><span class="p">[(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;make_integer&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>The <span class="math notranslate nohighlight">\(SagePickler\)</span> can also be passed a <code class="docutils literal notranslate"><span class="pre">persistent_id</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">table</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">}</span>
<span class="gp">sage: </span><span class="c1"># in practice this might be a database or something...</span>
<span class="gp">sage: </span><span class="k">def</span> <span class="nf">load_object_from_table</span><span class="p">(</span><span class="n">obj_id</span><span class="p">):</span>
<span class="go">....:     tag, obj_id</span>
<span class="go">....:     return table[obj_id]</span>
</pre></div>
</div>
<dl class="classmethod">
<dt id="sage.misc.persist.SagePickler.dumps">
<em class="property">classmethod </em><code class="descname">dumps</code><span class="sig-paren">(</span><em>obj</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.SagePickler.dumps" title="Permalink to this definition">¶</a></dt>
<dd><p>Equivalent to <a class="reference external" href="https://docs.python.org/library/pickle.html#pickle.dumps" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">pickle.dumps()</span></code></a> but using the
<a class="reference internal" href="#sage.misc.persist.SagePickler" title="sage.misc.persist.SagePickler"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.misc.persist.SagePickler</span></code></a>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">obj</span></code> - the object to pickle.</li>
<li><code class="docutils literal notranslate"><span class="pre">kwargs</span></code> - keyword arguments passed to the
<a class="reference internal" href="#sage.misc.persist.SagePickler" title="sage.misc.persist.SagePickler"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.misc.persist.SagePickler</span></code></a> constructor.</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">pickle</span></code> - the pickled object as <span class="math notranslate nohighlight">\(bytes\)</span>.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.persist</span> <span class="kn">import</span> <span class="n">SagePickler</span>
<span class="gp">sage: </span><span class="n">gherkin</span> <span class="o">=</span> <span class="n">SagePickler</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">gherkin</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="sage.misc.persist.SageUnpickler">
<em class="property">class </em><code class="descclassname">sage.misc.persist.</code><code class="descname">SageUnpickler</code><span class="sig-paren">(</span><em>file_obj</em>, <em>persistent_load=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.SageUnpickler" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">sage.misc.persist._BaseUnpickler</span></code></p>
<p>Subclass <span class="math notranslate nohighlight">\(pickle.Unpickler\)</span> to control how certain objects get unpickled
(registered overrides, specifically).</p>
<p>This is only needed in Python 3 and up.  On Python 2 the behavior of the
<code class="docutils literal notranslate"><span class="pre">cPickle</span></code> module is customized differently.</p>
<p>This class simply overrides <code class="docutils literal notranslate"><span class="pre">Unpickler.find_class</span></code> to wrap
<span class="math notranslate nohighlight">\(sage.misc.persist.unpickle_global`\)</span>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">file_obj</span></code> – a readable file-like object returning <code class="docutils literal notranslate"><span class="pre">bytes</span></code> from
which the pickle data will be loaded.</li>
<li><code class="docutils literal notranslate"><span class="pre">persistent_load</span></code> – callable or None; if given this callable
implements loading of persistent external objects.  The function
should take a single argument, the persistent object ID. See the
Python documentation on <a class="reference external" href="https://docs.python.org/2.7/library/pickle.html#pickling-and-unpickling-external-objects">pickling and unpickling external objects</a>
for more details.</li>
<li><code class="docutils literal notranslate"><span class="pre">kwargs</span></code> – additional keyword arguments passed to the
<span class="math notranslate nohighlight">\(pickle.Unpickler\)</span> constructor.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.persist</span> <span class="kn">import</span> <span class="p">(</span>
<span class="go">....:     unpickle_override, register_unpickle_override, SageUnpickler)</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.rings.integer</span> <span class="kn">import</span> <span class="n">make_integer</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="gp">sage: </span><span class="k">def</span> <span class="nf">fake_constructor</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="go">....:     print(&quot;unpickling an Integer&quot;)</span>
<span class="go">....:     return make_integer(x)</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;make_integer&#39;</span><span class="p">,</span>
<span class="go">....:                            fake_constructor)</span>
<span class="gp">sage: </span><span class="n">unp</span> <span class="o">=</span> <span class="n">SageUnpickler</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="bp">False</span><span class="p">)))</span>
<span class="gp">sage: </span><span class="n">unp</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="go">unpickling an Integer</span>
<span class="go">1</span>
<span class="gp">sage: </span><span class="k">del</span> <span class="n">unpickle_override</span><span class="p">[(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;make_integer&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>The <span class="math notranslate nohighlight">\(SageUnpickler\)</span> can also be passed a <code class="docutils literal notranslate"><span class="pre">persistent_load</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">table</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">}</span>
<span class="gp">sage: </span><span class="c1"># in practice this might be a database or something...</span>
<span class="gp">sage: </span><span class="k">def</span> <span class="nf">load_object_from_table</span><span class="p">(</span><span class="n">obj_id</span><span class="p">):</span>
<span class="go">....:     tag, obj_id</span>
<span class="go">....:     return table[obj_id]</span>
</pre></div>
</div>
<dl class="classmethod">
<dt id="sage.misc.persist.SageUnpickler.loads">
<em class="property">classmethod </em><code class="descname">loads</code><span class="sig-paren">(</span><em>data</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.SageUnpickler.loads" title="Permalink to this definition">¶</a></dt>
<dd><p>Equivalent to <a class="reference external" href="https://docs.python.org/library/pickle.html#pickle.dumps" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">pickle.dumps()</span></code></a> but using the
<a class="reference internal" href="#sage.misc.persist.SagePickler" title="sage.misc.persist.SagePickler"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.misc.persist.SagePickler</span></code></a>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">data</span></code> - the pickle data as <span class="math notranslate nohighlight">\(bytes\)</span>.</li>
<li><code class="docutils literal notranslate"><span class="pre">kwargs</span></code> - keyword arguments passed to the
<a class="reference internal" href="#sage.misc.persist.SageUnpickler" title="sage.misc.persist.SageUnpickler"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.misc.persist.SageUnpickler</span></code></a> constructor.</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">obj</span></code> - the object that was serialized to the given pickle data.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.persist</span> <span class="kn">import</span> <span class="n">SageUnpickler</span>
<span class="gp">sage: </span><span class="n">gherkin</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">SageUnpickler</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">gherkin</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.db">
<code class="descclassname">sage.misc.persist.</code><code class="descname">db</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.db" title="Permalink to this definition">¶</a></dt>
<dd><p>Load object with given name from the Sage database. Use x.db(name)
or db_save(x, name) to save objects to the database.</p>
<p>The database directory is <code class="docutils literal notranslate"><span class="pre">$HOME/.sage/db</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.db_save">
<code class="descclassname">sage.misc.persist.</code><code class="descname">db_save</code><span class="sig-paren">(</span><em>x</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.db_save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save x to the Sage database.</p>
<p>The database directory is <code class="docutils literal notranslate"><span class="pre">$HOME/.sage/db</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.dumps">
<code class="descclassname">sage.misc.persist.</code><code class="descname">dumps</code><span class="sig-paren">(</span><em>obj</em>, <em>compress=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.dumps" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump obj to a string s.  To recover obj, use <code class="docutils literal notranslate"><span class="pre">loads(s)</span></code>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="#sage.misc.persist.loads" title="sage.misc.persist.loads"><code class="xref py py-func docutils literal notranslate"><span class="pre">loads()</span></code></a></p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">a2</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">a2</span>
<span class="go">2/3</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.load">
<code class="descclassname">sage.misc.persist.</code><code class="descname">load</code><span class="sig-paren">(</span><em>compress=True</em>, <em>verbose=True</em>, <em>*filename</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load Sage object from the file with name filename, which will have
an <code class="docutils literal notranslate"><span class="pre">.sobj</span></code> extension added if it doesn’t have one.  Or, if the input
is a filename ending in <code class="docutils literal notranslate"><span class="pre">.py</span></code>, <code class="docutils literal notranslate"><span class="pre">.pyx</span></code>, <code class="docutils literal notranslate"><span class="pre">.sage</span></code>, <code class="docutils literal notranslate"><span class="pre">.spyx</span></code>,
<code class="docutils literal notranslate"><span class="pre">.f</span></code>, <code class="docutils literal notranslate"><span class="pre">.f90</span></code> or <code class="docutils literal notranslate"><span class="pre">.m</span></code>, load that file into the current running
session.</p>
<p>Loaded files are not loaded into their own namespace, i.e., this is
much more like Python’s <code class="docutils literal notranslate"><span class="pre">execfile</span></code> than Python’s <code class="docutils literal notranslate"><span class="pre">import</span></code>.</p>
<p>This function also loads a <code class="docutils literal notranslate"><span class="pre">.sobj</span></code> file over a network by
specifying the full URL.  (Setting <code class="docutils literal notranslate"><span class="pre">verbose</span> <span class="pre">=</span> <span class="pre">False</span></code> suppresses
the loading progress indicator.)</p>
<p>Finally, if you give multiple positional input arguments, then all
of those files are loaded, or all of the objects are loaded and a
list of the corresponding loaded objects is returned.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">u</span> <span class="o">=</span> <span class="s1">&#39;http://sage.math.washington.edu/home/was/db/test.sobj&#39;</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>                                                  <span class="c1"># optional - internet</span>
<span class="go">Attempting to load remote file: http://sage.math.washington.edu/home/was/db/test.sobj</span>
<span class="go">Loading: [.]</span>
<span class="gp">sage: </span><span class="n">s</span>                                                            <span class="c1"># optional - internet</span>
<span class="go">&#39;hello SAGE&#39;</span>
</pre></div>
</div>
<p>We test loading a file or multiple files or even mixing loading files and objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">t</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">(</span><span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="go">....:     _ = f.write(&quot;print(&#39;hello world&#39;)&quot;)</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">hello world</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="go">hello world</span>
<span class="go">hello world</span>
<span class="gp">sage: </span><span class="n">t2</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">();</span> <span class="n">save</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span>
<span class="go">hello world</span>
<span class="go">hello world</span>
<span class="go">[None, None, 2/3]</span>
</pre></div>
</div>
<p>Files with a <code class="docutils literal notranslate"><span class="pre">.sage</span></code> extension are preparsed. Also note that we
can access global variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">t</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">(</span><span class="n">ext</span><span class="o">=</span><span class="s2">&quot;.sage&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="go">....:     _ = f.write(&quot;a += Mod(2/3, 11)&quot;)  # This evaluates to Mod(8, 11)</span>
<span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">a</span>
<span class="go">7</span>
</pre></div>
</div>
<p>We can load Fortran files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;      subroutine hello</span><span class="se">\n</span><span class="s1">         print *, &quot;Hello World!&quot;</span><span class="se">\n</span><span class="s1">      end subroutine hello</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="gp">sage: </span><span class="n">t</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">(</span><span class="n">ext</span><span class="o">=</span><span class="s2">&quot;.F&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="go">....:     _ = f.write(code)</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">hello</span>
<span class="go">&lt;fortran object&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.load_sage_element">
<code class="descclassname">sage.misc.persist.</code><code class="descname">load_sage_element</code><span class="sig-paren">(</span><em>cls</em>, <em>parent</em>, <em>dic_pic</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.load_sage_element" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="sage.misc.persist.load_sage_object">
<code class="descclassname">sage.misc.persist.</code><code class="descname">load_sage_object</code><span class="sig-paren">(</span><em>cls</em>, <em>dic</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.load_sage_object" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="sage.misc.persist.loads">
<code class="descclassname">sage.misc.persist.</code><code class="descname">loads</code><span class="sig-paren">(</span><em>s</em>, <em>compress=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.loads" title="Permalink to this definition">¶</a></dt>
<dd><p>Recover an object x that has been dumped to a string s
using <code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">=</span> <span class="pre">dumps(x)</span></code>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="#sage.misc.persist.dumps" title="sage.misc.persist.dumps"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a></p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[   1    2]</span>
<span class="go">[   3 -4/3]</span>
</pre></div>
</div>
<p>If compress is True (the default), it will try to decompress
the data with zlib and with bz2 (in turn); if neither succeeds,
it will assume the data is actually uncompressed.  If compress=False
is explicitly specified, then no decompression is attempted.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="o">==</span> <span class="n">v</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="n">compress</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">v</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">compress</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">UnpicklingError</span>: <span class="n">invalid load key, &#39;x&#39;.</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.make_None">
<code class="descclassname">sage.misc.persist.</code><code class="descname">make_None</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.make_None" title="Permalink to this definition">¶</a></dt>
<dd><p>Do nothing and return <code class="docutils literal notranslate"><span class="pre">None</span></code>. Used for overriding pickles when
that pickle is no longer needed.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.persist</span> <span class="kn">import</span> <span class="n">make_None</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">make_None</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">))</span>
<span class="go">None</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.picklejar">
<code class="descclassname">sage.misc.persist.</code><code class="descname">picklejar</code><span class="sig-paren">(</span><em>obj</em>, <em>dir=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.picklejar" title="Permalink to this definition">¶</a></dt>
<dd><p>Create pickled sobj of <code class="docutils literal notranslate"><span class="pre">obj</span></code> in <code class="docutils literal notranslate"><span class="pre">dir</span></code>, with name the absolute
value of the hash of the pickle of obj.  This is used in conjunction
with <a class="reference internal" href="#sage.misc.persist.unpickle_all" title="sage.misc.persist.unpickle_all"><code class="xref py py-func docutils literal notranslate"><span class="pre">unpickle_all()</span></code></a>.</p>
<p>To use this to test the whole Sage library right now, set the
environment variable <code class="docutils literal notranslate"><span class="pre">SAGE_PICKLE_JAR</span></code>, which will make it so
<a class="reference internal" href="#sage.misc.persist.dumps" title="sage.misc.persist.dumps"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a> will by default call <a class="reference internal" href="#sage.misc.persist.picklejar" title="sage.misc.persist.picklejar"><code class="xref py py-func docutils literal notranslate"><span class="pre">picklejar()</span></code></a> with the
default dir.  Once you do that and doctest Sage, you’ll find that
the <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/tmp/pickle_jar</span></code> directory contains a bunch of
pickled objects along with corresponding txt descriptions of them.
Use the <a class="reference internal" href="#sage.misc.persist.unpickle_all" title="sage.misc.persist.unpickle_all"><code class="xref py py-func docutils literal notranslate"><span class="pre">unpickle_all()</span></code></a> to see if they unpickle later.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">obj</span></code> – a pickleable object</li>
<li><code class="docutils literal notranslate"><span class="pre">dir</span></code> – a string or None; if None then <code class="docutils literal notranslate"><span class="pre">dir</span></code> defaults to
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/tmp/pickle_jar</span></code></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">dir</span> <span class="o">=</span> <span class="n">tmp_dir</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">persist</span><span class="o">.</span><span class="n">picklejar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">persist</span><span class="o">.</span><span class="n">picklejar</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">))</span>   <span class="c1"># Two entries (sobj and txt) for each object</span>
<span class="go">4</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.register_unpickle_override">
<code class="descclassname">sage.misc.persist.</code><code class="descname">register_unpickle_override</code><span class="sig-paren">(</span><em>module</em>, <em>name</em>, <em>callable</em>, <em>call_name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.register_unpickle_override" title="Permalink to this definition">¶</a></dt>
<dd><p>Python pickles include the module and class name of classes.
This means that rearranging the Sage source can invalidate old
pickles.  To keep the old pickles working, you can call
register_unpickle_override with an old module name and class name,
and the Python callable (function, class with __call__ method, etc.)
to use for unpickling.  (If this callable is a value in some module,
you can specify the module name and class name, for the benefit of
<a class="reference internal" href="explain_pickle.html#sage.misc.explain_pickle.explain_pickle" title="sage.misc.explain_pickle.explain_pickle"><code class="xref py py-func docutils literal notranslate"><span class="pre">explain_pickle()</span></code></a> when called with <code class="docutils literal notranslate"><span class="pre">in_current_sage=True</span></code>).)</p>
<p>EXAMPLES:</p>
<p>Imagine that there used to be an <code class="docutils literal notranslate"><span class="pre">old_integer</span></code> module and old
pickles essentially trying to do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.old_integer&#39;</span><span class="p">,</span> <span class="s1">&#39;OldInteger&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ImportError</span>: <span class="n">cannot import OldInteger from sage.rings.old_integer, call register_unpickle_override(&#39;sage.rings.old_integer&#39;, &#39;OldInteger&#39;, ...) to fix this</span>
</pre></div>
</div>
<p>After following the advice from the error message, unpickling
works:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.persist</span> <span class="kn">import</span> <span class="n">register_unpickle_override</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;sage.rings.old_integer&#39;</span><span class="p">,</span> <span class="s1">&#39;OldInteger&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.old_integer&#39;</span><span class="p">,</span> <span class="s1">&#39;OldInteger&#39;</span><span class="p">)</span>
<span class="go">&lt;... &#39;sage.rings.integer.Integer&#39;&gt;</span>
</pre></div>
</div>
<p>In many cases, unpickling problems for old pickles can be resolved with a
simple call to <code class="docutils literal notranslate"><span class="pre">register_unpickle_override</span></code>, as in the example above and
in many of the <code class="docutils literal notranslate"><span class="pre">sage</span></code> source files.  However, if the underlying data
structure has changed significantly then unpickling may fail and it
will be necessary to explicitly implement unpickling methods for the
associated objects. The python pickle protocol is described in detail on the
web and, in particular, in the <a class="reference external" href="http://docs.python.org/library/pickle.html#pickle-protocol">python pickling documentation</a>. For example, the
following excerpt from this documentation shows that the unpickling of
classes is controlled by their <code class="xref py py-meth docutils literal notranslate"><span class="pre">__setstate__()</span></code> method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>object.__setstate__(state)

    Upon unpickling, if the class also defines the method :meth:`__setstate__`, it is
    called with the unpickled state. If there is no :meth:`__setstate__` method,
    the pickled state must be a dictionary and its items are assigned to the new
    instance&#39;s dictionary. If a class defines both :meth:`getstate__` and
    :meth:`__setstate__`, the state object needn&#39;t be a dictionary and these methods
    can do what they want.
</pre></div>
</div>
<p>By implementing a <code class="xref py py-meth docutils literal notranslate"><span class="pre">__setstate__()</span></code> method for a class it should be
possible to fix any unpickling problems for the class. As an example of what
needs to be done, we show how to unpickle a <a class="reference external" href="../../../combinat/sage/combinat/combinat.html#sage.combinat.combinat.CombinatorialObject" title="(in Sage Reference Manual: Combinatorics v8.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CombinatorialObject</span></code></a>
object using a class which also inherits from
<a class="reference external" href="../../../structure/sage/structure/element.html#sage.structure.element.Element" title="(in Sage Reference Manual: Parents and Elements v8.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a>. This exact problem often arises
when refactoring old code into the element framework. First we create a
pickle to play with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.element</span> <span class="kn">import</span> <span class="n">Element</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">SourPickle</span><span class="p">(</span><span class="n">CombinatorialObject</span><span class="p">):</span> <span class="k">pass</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">SweetPickle</span><span class="p">(</span><span class="n">CombinatorialObject</span><span class="p">,</span> <span class="n">Element</span><span class="p">):</span> <span class="k">pass</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">__main__</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">SourPickle</span> <span class="o">=</span> <span class="n">SourPickle</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">SweetPickle</span> <span class="o">=</span> <span class="n">SweetPickle</span>  <span class="c1"># a hack to allow us to pickle command line classes</span>
<span class="gp">sage: </span><span class="n">gherkin</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">SourPickle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
<p>Using <a class="reference internal" href="#sage.misc.persist.register_unpickle_override" title="sage.misc.persist.register_unpickle_override"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_unpickle_override()</span></code></a> we try to sweeten our pickle, but
we are unable to eat it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.persist</span> <span class="kn">import</span> <span class="n">register_unpickle_override</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;__main__&#39;</span><span class="p">,</span> <span class="s1">&#39;SourPickle&#39;</span><span class="p">,</span> <span class="n">SweetPickle</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">gherkin</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">KeyError</span>: <span class="n">0</span>
</pre></div>
</div>
<p>The problem is that the <code class="docutils literal notranslate"><span class="pre">SweetPickle</span></code> has inherited a
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__setstate__()</span></code> method from
<a class="reference external" href="../../../structure/sage/structure/element.html#sage.structure.element.Element" title="(in Sage Reference Manual: Parents and Elements v8.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> which is not compatible with
unpickling for <a class="reference external" href="../../../combinat/sage/combinat/combinat.html#sage.combinat.combinat.CombinatorialObject" title="(in Sage Reference Manual: Combinatorics v8.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CombinatorialObject</span></code></a>. We can fix this by explicitly
defining a new <code class="xref py py-meth docutils literal notranslate"><span class="pre">__setstate__()</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">class</span> <span class="nc">SweeterPickle</span><span class="p">(</span><span class="n">CombinatorialObject</span><span class="p">,</span> <span class="n">Element</span><span class="p">):</span>
<span class="go">....:     def __setstate__(self, state):</span>
<span class="go">....:         # a pickle from CombinatorialObject is just its instance</span>
<span class="go">....:         # dictionary</span>
<span class="go">....:         if isinstance(state, dict):</span>
<span class="go">....:             # this is a fudge: we need an appropriate parent here</span>
<span class="go">....:             self._set_parent(Tableaux())</span>
<span class="go">....:             self.__dict__ = state</span>
<span class="go">....:         else:</span>
<span class="go">....:             P, D = state</span>
<span class="go">....:             if P is not None:</span>
<span class="go">....:                 self._set_parent(P)</span>
<span class="go">....:             self.__dict__ = D</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">SweeterPickle</span> <span class="o">=</span> <span class="n">SweeterPickle</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;__main__&#39;</span><span class="p">,</span> <span class="s1">&#39;SourPickle&#39;</span><span class="p">,</span> <span class="n">SweeterPickle</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">gherkin</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">SweeterPickle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])))</span>  <span class="c1"># check that pickles work for SweeterPickle</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">state</span></code> passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">__setstate__()</span></code> will usually be something like
the instance dictionary of the pickled object, however, with some older
classes such as <a class="reference external" href="../../../combinat/sage/combinat/combinat.html#sage.combinat.combinat.CombinatorialObject" title="(in Sage Reference Manual: Combinatorics v8.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CombinatorialObject</span></code></a> it will be a tuple. In general,
the <code class="docutils literal notranslate"><span class="pre">state</span></code> can be any python object.  <code class="docutils literal notranslate"><span class="pre">Sage</span></code> provides a special tool,
<a class="reference internal" href="explain_pickle.html#sage.misc.explain_pickle.explain_pickle" title="sage.misc.explain_pickle.explain_pickle"><code class="xref py py-func docutils literal notranslate"><span class="pre">explain_pickle()</span></code></a>, which can help in figuring
out the contents of an old pickle. Here is a second example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="go">....:    def __init__(self,value):</span>
<span class="go">....:        self.original_attribute = value</span>
<span class="go">....:    def __repr__(self):</span>
<span class="go">....:        return &#39;A(%s)&#39; % self.original_attribute</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="go">....:    def __init__(self,value):</span>
<span class="go">....:        self.new_attribute = value</span>
<span class="go">....:    def __setstate__(self,state):</span>
<span class="go">....:        try:</span>
<span class="go">....:            self.new_attribute = state[&#39;new_attribute&#39;]</span>
<span class="go">....:        except KeyError:      # an old pickle</span>
<span class="go">....:            self.new_attribute = state[&#39;original_attribute&#39;]</span>
<span class="go">....:    def __repr__(self):</span>
<span class="go">....:        return &#39;B(%s)&#39; % self.new_attribute</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">__main__</span>
<span class="gp">sage: </span><span class="c1"># a hack to allow us to pickle command line classes</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">A</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>
<span class="gp">sage: </span><span class="n">A</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">A(10)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
<span class="go">A(10)</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">explain_pickle</span><span class="o">.</span><span class="n">explain_pickle</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
<span class="go">pg_A = unpickle_global(&#39;__main__&#39;, &#39;A&#39;)</span>
<span class="go">si = unpickle_newobj(pg_A, ())</span>
<span class="go">pg_make_integer = unpickle_global(&#39;sage.rings.integer&#39;, &#39;make_integer&#39;)</span>
<span class="go">unpickle_build(si, {&#39;original_attribute&#39;:pg_make_integer(&#39;a&#39;)})</span>
<span class="go">si</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.persist</span> <span class="kn">import</span> <span class="n">register_unpickle_override</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;__main__&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
<span class="go">B(10)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">B</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
<span class="go">B(10)</span>
</pre></div>
</div>
<p>Pickling for python classes and extension classes, such as cython, is
different – again this is discussed in the <a class="reference external" href="http://docs.python.org/library/pickle.html#pickle-protocol">python pickling
documentation</a>. For the unpickling of extension classes you need to write
a <code class="xref py py-meth docutils literal notranslate"><span class="pre">__reduce__()</span></code> method which typically returns a tuple <code class="docutils literal notranslate"><span class="pre">(f,</span>
<span class="pre">args,...)</span></code> such that <code class="docutils literal notranslate"><span class="pre">f(*args)</span></code> returns (a copy of) the original object.
The following code snippet is the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__reduce__()</span></code> method from
<a class="reference external" href="../../../rings_standard/sage/rings/integer.html#sage.rings.integer.Integer" title="(in Sage Reference Manual: Standard Commutative Rings v8.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.rings.integer.Integer</span></code></a>.</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s">&#39;Including the documentation properly causes a doc-test failure so we include it as a comment:&#39;</span>
    <span class="c">#* &#39;&#39;&#39;</span>
    <span class="c">#* This is used when pickling integers.</span>
    <span class="c">#*</span>
    <span class="c">#* EXAMPLES::</span>
    <span class="c">#*</span>
    <span class="c">#*     sage: n = 5</span>
    <span class="c">#*     sage: t = n.__reduce__(); t</span>
    <span class="c">#*     (&lt;built-in function make_integer&gt;, (&#39;5&#39;,))</span>
    <span class="c">#*     sage: t[0](*t[1])</span>
    <span class="c">#*     5</span>
    <span class="c">#*     sage: loads(dumps(n)) == n</span>
    <span class="c">#*     True</span>
    <span class="c">#* &#39;&#39;&#39;</span>
    <span class="c"># This single line below took me HOURS to figure out.</span>
    <span class="c"># It is the *trick* needed to pickle Cython extension types.</span>
    <span class="c"># The trick is that you must put a pure Python function</span>
    <span class="c"># as the first argument, and that function must return</span>
    <span class="c"># the result of unpickling with the argument in the second</span>
    <span class="c"># tuple as input. All kinds of problems happen</span>
    <span class="c"># if we don&#39;t do this.</span>
    <span class="k">return</span> <span class="n">sage</span><span class="o">.</span><span class="n">rings</span><span class="o">.</span><span class="n">integer</span><span class="o">.</span><span class="n">make_integer</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="mf">32</span><span class="p">),)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.save">
<code class="descclassname">sage.misc.persist.</code><code class="descname">save</code><span class="sig-paren">(</span><em>obj</em>, <em>filename</em>, <em>compress=True</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save <code class="docutils literal notranslate"><span class="pre">obj</span></code> to the file with name <code class="docutils literal notranslate"><span class="pre">filename</span></code>, which will have an
<code class="docutils literal notranslate"><span class="pre">.sobj</span></code> extension added if it doesn’t have one and if <code class="docutils literal notranslate"><span class="pre">obj</span></code>
doesn’t have its own <code class="docutils literal notranslate"><span class="pre">save()</span></code> method, like e.g. Python tuples.</p>
<p>For image objects and the like (which have their own <code class="docutils literal notranslate"><span class="pre">save()</span></code> method),
you may have to specify a specific extension, e.g. <code class="docutils literal notranslate"><span class="pre">.png</span></code>, if you
don’t want the object to be saved as a Sage object (or likewise, if
<code class="docutils literal notranslate"><span class="pre">filename</span></code> could be interpreted as already having some extension).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This will <em>replace</em> the contents of the file if it already exists.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">objfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s1">&#39;test.sobj&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">objfile_short</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">objfile</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">objfile_short</span><span class="p">)</span>
<span class="go">[   1    2]</span>
<span class="go">[   3 -5/2]</span>
<span class="gp">sage: </span><span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">objfile_short</span><span class="p">)</span>   <span class="c1"># saves the plot to &quot;test.sobj&quot;</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s2">&quot;sage.png&quot;</span><span class="p">),</span> <span class="n">xmin</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s2">&quot;filename.with.some.wrong.ext&quot;</span><span class="p">))</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">allowed file extensions for images are &#39;.eps&#39;, &#39;.pdf&#39;, &#39;.pgf&#39;, &#39;.png&#39;, &#39;.ps&#39;, &#39;.sobj&#39;, &#39;.svg&#39;!</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">objfile</span><span class="p">))</span>
<span class="go">Graphics object consisting of 2 graphics primitives</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;A python string&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">objfile</span><span class="p">)</span>
<span class="go">&#39;A python string&#39;</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">objfile_short</span><span class="p">)</span>
<span class="go">&#39;A python string&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.unpickle_all">
<code class="descclassname">sage.misc.persist.</code><code class="descname">unpickle_all</code><span class="sig-paren">(</span><em>dir</em>, <em>debug=False</em>, <em>run_test_suite=False</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.unpickle_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpickle all sobj’s in the given directory, reporting failures as
they occur.  Also printed the number of successes and failure.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">dir</span></code> – a string; the name of a directory (or of a .tar.bz2
file that decompresses to a directory) full of pickles.</li>
<li><code class="docutils literal notranslate"><span class="pre">debug</span></code> – a boolean (default: False)
whether to report a stacktrace in case of failure</li>
<li><code class="docutils literal notranslate"><span class="pre">run_test_suite</span></code> – a boolean (default: False)
whether to run <code class="docutils literal notranslate"><span class="pre">TestSuite(x).run()</span></code> on the unpickled objects</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">dir</span> <span class="o">=</span> <span class="n">tmp_dir</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">persist</span><span class="o">.</span><span class="n">picklejar</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">persist</span><span class="o">.</span><span class="n">unpickle_all</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
<span class="go">Successfully unpickled 1 objects.</span>
<span class="go">Failed to unpickle 0 objects.</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.misc.persist.unpickle_global">
<code class="descclassname">sage.misc.persist.</code><code class="descname">unpickle_global</code><span class="sig-paren">(</span><em>module</em>, <em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.misc.persist.unpickle_global" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a module name and a name within that module (typically a class
name), retrieve the corresponding object.  This normally just looks
up the name in the module, but it can be overridden by
register_unpickle_override.  This is used in the Sage unpickling
mechanism, so if the Sage source code organization changes,
register_unpickle_override can allow old pickles to continue to work.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.persist</span> <span class="kn">import</span> <span class="n">unpickle_override</span><span class="p">,</span> <span class="n">register_unpickle_override</span>
<span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;Integer&#39;</span><span class="p">)</span>
<span class="go">&lt;type &#39;sage.rings.integer.Integer&#39;&gt;</span>
</pre></div>
</div>
<p>Now we horribly break the pickling system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;Integer&#39;</span><span class="p">,</span> <span class="n">Rational</span><span class="p">,</span> <span class="n">call_name</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;sage.rings.rational&#39;</span><span class="p">,</span> <span class="s1">&#39;Rational&#39;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;Integer&#39;</span><span class="p">)</span>
<span class="go">&lt;type &#39;sage.rings.rational.Rational&#39;&gt;</span>
</pre></div>
</div>
<p>and we reach into the internals and put it back:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">del</span> <span class="n">unpickle_override</span><span class="p">[(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;Integer&#39;</span><span class="p">)]</span>
<span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;Integer&#39;</span><span class="p">)</span>
<span class="go">&lt;type &#39;sage.rings.integer.Integer&#39;&gt;</span>
</pre></div>
</div>
<p>A meaningful error message with resolution instructions is displayed for
old pickles that accidentally got broken because a class or entire module
was moved or renamed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.all&#39;</span><span class="p">,</span> <span class="s1">&#39;some_old_class&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ImportError</span>: <span class="n">cannot import some_old_class from sage.all, call</span>
<span class="go">register_unpickle_override(&#39;sage.all&#39;, &#39;some_old_class&#39;, ...)</span>
<span class="go">to fix this</span>

<span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.some_old_module&#39;</span><span class="p">,</span> <span class="s1">&#39;some_old_class&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ImportError</span>: <span class="n">cannot import some_old_class from sage.some_old_module, call</span>
<span class="go">register_unpickle_override(&#39;sage.some_old_module&#39;, &#39;some_old_class&#39;, ...)</span>
<span class="go">to fix this</span>
</pre></div>
</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="func_persist.html"
                        title="previous chapter">Support for persistent functions in .sage files</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="fpickle.html"
                        title="next chapter">Function pickling</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/sage/misc/persist.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="fpickle.html" title="Function pickling"
             >next</a> |</li>
        <li class="right" >
          <a href="func_persist.html" title="Support for persistent functions in .sage files"
             >previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Utilities</a> &#187;</li>
 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005--2019, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>