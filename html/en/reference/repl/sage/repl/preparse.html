
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="viewport" content="width=600, initial-scale=1">
    <title>The Sage Preparser &#8212; Sage 9.2 Reference Manual: The Sage Command Line</title>
    <link rel="stylesheet" href="../../../_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script async="async" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Load Python, Sage, Cython, Fortran and Magma files in Sage" href="load.html" />
    <link rel="prev" title="Interactively tracing execution of a command" href="../misc/trace.html" />
    <link rel="icon" href="../../../_static/sageicon.png" type="image/x-icon" />
    <script src="../../../_static/thebe.js" type="text/javascript"></script>
    <script src="../../../_static/thebe-sage.js" type="text/javascript"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="load.html" title="Load Python, Sage, Cython, Fortran and Magma files in Sage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../misc/trace.html" title="Interactively tracing execution of a command"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Sage 9.2 Reference Manual: The Sage Command Line</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">The Sage Preparser</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-sage-preparser">
<span id="sage-repl-preparse"></span><h1>The Sage Preparser<a class="headerlink" href="#the-sage-preparser" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-sage.repl.preparse"></span><p>AUTHORS:</p>
<blockquote>
<div><ul class="simple">
<li><p>William Stein (2006-02-19)</p>
<ul>
<li><p>Fixed bug when loading .py files.</p></li>
</ul>
</li>
<li><p>William Stein (2006-03-09)</p>
<ul>
<li><p>Fixed crash in parsing exponentials.</p></li>
<li><p>Precision of real literals now determined by digits of input
(like Mathematica).</p></li>
</ul>
</li>
<li><p>Joe Wetherell (2006-04-14)</p>
<ul>
<li><p>Added MAGMA-style constructor preparsing.</p></li>
</ul>
</li>
<li><p>Bobby Moretti (2007-01-25)</p>
<ul>
<li><p>Added preliminary function assignment notation.</p></li>
</ul>
</li>
<li><p>Robert Bradshaw (2007-09-19)</p>
<ul>
<li><p>Added strip_string_literals, containing_block utility
functions. Arrr!</p></li>
<li><p>Added [1,2,..,n] notation.</p></li>
</ul>
</li>
<li><p>Robert Bradshaw (2008-01-04)</p>
<ul>
<li><p>Implicit multiplication (off by default).</p></li>
</ul>
</li>
<li><p>Robert Bradshaw (2008-09-23)</p>
<ul>
<li><p>Factor out constants.</p></li>
</ul>
</li>
<li><p>Robert Bradshaw (2000-01)</p>
<ul>
<li><p>Simplify preparser by making it modular and using regular
expressions.</p></li>
<li><p>Bug fixes, complex numbers, and binary input.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<p>EXAMPLES:</p>
<p>Preparsing:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2/3&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(2)/Integer(3)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2.5&#39;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;2.5&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2^3&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(2)**Integer(3)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a^b&#39;</span><span class="p">)</span>            <span class="c1"># exponent</span>
<span class="go">&#39;a**b&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a**b&#39;</span><span class="p">)</span>
<span class="go">&#39;a**b&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;G.0&#39;</span><span class="p">)</span>            <span class="c1"># generator</span>
<span class="go">&#39;G.gen(0)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a = 939393R&#39;</span><span class="p">)</span>    <span class="c1"># raw</span>
<span class="go">&#39;a = 939393&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a b c in L&#39;</span><span class="p">)</span>     <span class="c1"># implicit multiplication</span>
<span class="go">&#39;a*b*c in L&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2e3x + 3exp(y)&#39;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;2e3&#39;)*x + Integer(3)*exp(y)&quot;</span>
</pre></div>
</div>
<p>A string with escaped quotes in it (the point here is that the
preparser doesn’t get confused by the internal quotes):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="s2">&quot;&quot;</span><span class="n">Yes</span><span class="p">,</span><span class="s2">&quot; he said.&quot;</span>
<span class="go">&#39;&quot;Yes,&quot; he said.&#39;</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">; s</span>
<span class="go">&#39;\&#39;</span>
</pre></div>
</div>
<p>A hex literal:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;0x2e3&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0x2e3)&#39;</span>
<span class="gp">sage: </span><span class="mh">0xA</span>
<span class="go">10</span>
<span class="gp">sage: </span><span class="mh">0xe</span>
<span class="go">14</span>
</pre></div>
</div>
<p>Raw and hex work correctly:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="mh">0xa1</span><span class="p">)</span>
<span class="go">&lt;type &#39;sage.rings.integer.Integer&#39;&gt;</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="mh">0xa1</span><span class="n">r</span><span class="p">)</span>
<span class="go">&lt;type &#39;int&#39;&gt;</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="mh">0Xa1</span><span class="n">R</span><span class="p">)</span>
<span class="go">&lt;type &#39;int&#39;&gt;</span>
</pre></div>
</div>
<p>The preparser can handle PEP 515 (see <a class="reference external" href="https://trac.sagemath.org/28490">trac ticket #28490</a>):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="mi">1</span><span class="n">_000_000</span> <span class="o">+</span> <span class="mi">3</span><span class="n">_000</span> <span class="c1"># py3</span>
<span class="go">1003000</span>
</pre></div>
</div>
<p>In Sage, methods can also be called on integer and real literals (note
that in pure Python this would be a syntax error):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="mf">16.</span><span class="n">sqrt</span><span class="p">()</span>
<span class="go">4</span>
<span class="gp">sage: </span><span class="mf">87.</span><span class="n">factor</span><span class="p">()</span>
<span class="go">3 * 29</span>
<span class="gp">sage: </span><span class="mf">15.10</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
<span class="go">3.88587184554509</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;87.sqrt()&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(87).sqrt()&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;15.10.sqrt()&#39;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;15.10&#39;).sqrt()&quot;</span>
</pre></div>
</div>
<p>Note that calling methods on int literals in pure Python is a syntax
error, but Sage allows this for Sage integers and reals, because users
frequently request it:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;4.__add__(3)&#39;</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">SyntaxError: invalid syntax</span>
</pre></div>
</div>
<p>Symbolic functional notation:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span> <span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">beta</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">theta</span>
<span class="gp">sage: </span><span class="n">f</span>
<span class="go">(theta, beta) |--&gt; beta + theta</span>
<span class="gp">sage: </span><span class="n">a</span>
<span class="go">10</span>
<span class="gp">sage: </span><span class="n">b</span>
<span class="go">x^2 + theta</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
<span class="go">2*theta</span>

<span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span>
<span class="go">(x, y) |--&gt; sqrt(5)*x*y</span>
</pre></div>
</div>
<p>This involves an =-, but should still be turned into a symbolic
expression:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a(x) =- 5&#39;</span><span class="p">)</span>
<span class="go">&#39;__tmp__=var(&quot;x&quot;); a = symbolic_expression(- Integer(5)).function(x)&#39;</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">=-</span><span class="n">x</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">-10</span>
</pre></div>
</div>
<p>This involves -=, which should not be turned into a symbolic
expression (of course a(x) isn’t an identifier, so this will never be
valid):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a(x) -= 5&#39;</span><span class="p">)</span>
<span class="go">&#39;a(x) -= Integer(5)&#39;</span>
</pre></div>
</div>
<p>Raw literals:</p>
<p>Raw literals are not preparsed, which can be useful from an efficiency
point of view.  Just like Python ints are denoted by an L, in Sage raw
integer and floating literals are followed by an”r” (or “R”) for raw,
meaning not preparsed.</p>
<p>We create a raw integer:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="mi">393939</span><span class="n">r</span>
<span class="gp">sage: </span><span class="n">a</span>
<span class="go">393939</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">&lt;type &#39;int&#39;&gt;</span>
</pre></div>
</div>
<p>We create a raw float:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">z</span> <span class="o">=</span> <span class="mf">1.5949</span><span class="n">r</span>
<span class="gp">sage: </span><span class="n">z</span>
<span class="go">1.5949</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="go">&lt;type &#39;float&#39;&gt;</span>
</pre></div>
</div>
<p>You can also use an upper case letter:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">z</span> <span class="o">=</span> <span class="mf">3.1415</span><span class="n">R</span>
<span class="gp">sage: </span><span class="n">z</span>
<span class="go">3.1415</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="go">&lt;type &#39;float&#39;&gt;</span>
</pre></div>
</div>
<p>This next example illustrates how raw literals can be very useful in
certain cases.  We make a list of even integers up to 10000:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>
</pre></div>
</div>
<p>This takes a noticeable fraction of a second (e.g., 0.25
seconds). After preparsing, what Python is really executing is the
following:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;v = [ 2*i for i in range(10000)]&#39;</span><span class="p">)</span>
<span class="go">&#39;v = [ Integer(2)*i for i in range(Integer(10000))]&#39;</span>
</pre></div>
</div>
<p>If instead we use a raw 2 we get execution that is <em>instant</em> (0.00
seconds):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">2</span><span class="n">r</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="n">r</span><span class="p">)]</span>
</pre></div>
</div>
<p>Behind the scenes what happens is the following:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;v = [ 2r * i for i in range(10000r)]&#39;</span><span class="p">)</span>
<span class="go">&#39;v = [ 2 * i for i in range(10000)]&#39;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The results of the above two expressions are different.  The
first one computes a list of Sage integers, whereas the second
creates a list of Python integers.  Python integers are typically
much more efficient than Sage integers when they are very small;
large Sage integers are much more efficient than Python integers,
since they are implemented using the GMP C library.</p>
</div>
<dl class="py function">
<dt id="sage.repl.preparse.containing_block">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">containing_block</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">code</span></em>, <em class="sig-param"><span class="n">idx</span></em>, <em class="sig-param"><span class="n">delimiters</span><span class="o">=</span><span class="default_value">['()', '[]', '{}']</span></em>, <em class="sig-param"><span class="n">require_delim</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.containing_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the code block given by balanced delimiters that contains the position <code class="docutils literal notranslate"><span class="pre">idx</span></code>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">idx</span></code> - an integer; a starting position</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delimiters</span></code> - a list of strings (default: [‘()’, ‘[]’,
‘{}’]); the delimiters to balance. A delimiter must be a single
character and no character can at the same time be opening and
closing delimiter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">require_delim</span></code> - a boolean (default: True); whether to raise
a SyntaxError if delimiters are present. If the delimiters are
unbalanced, an error will be raised in any case.</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a 2-tuple <code class="docutils literal notranslate"><span class="pre">(a,b)</span></code> of integers, such that <code class="docutils literal notranslate"><span class="pre">code[a:b]</span></code> is
delimited by balanced delimiters, <code class="docutils literal notranslate"><span class="pre">a&lt;=idx&lt;b</span></code>, and <code class="docutils literal notranslate"><span class="pre">a</span></code>
is maximal and <code class="docutils literal notranslate"><span class="pre">b</span></code> is minimal with that property. If that
does not exist, a <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code> is raised.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">require_delim</span></code> is false and <code class="docutils literal notranslate"><span class="pre">a,b</span></code> as above can not be
found, then <code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">len(code)</span></code> is returned.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">containing_block</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;factor(next_prime(L[5]+1))&quot;</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span>
<span class="go">&#39;+&#39;</span>
<span class="gp">sage: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">containing_block</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span>
<span class="go">(17, 25)</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
<span class="go">&#39;(L[5]+1)&#39;</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
<span class="go">&#39;5&#39;</span>
<span class="gp">sage: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">containing_block</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
<span class="go">&#39;[5]&#39;</span>
<span class="gp">sage: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">containing_block</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">delimiters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;()&#39;</span><span class="p">]);</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
<span class="go">&#39;(L[5]+1)&#39;</span>
<span class="gp">sage: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">containing_block</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
<span class="go">&#39;(next_prime(L[5]+1))&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.extract_numeric_literals">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">extract_numeric_literals</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">code</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.extract_numeric_literals" title="Permalink to this definition">¶</a></dt>
<dd><p>Pulls out numeric literals and assigns them to global variables.
This eliminates the need to re-parse and create the literals,
e.g., during every iteration of a loop.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string; a block of code</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a (string, string:string dictionary) 2-tuple; the block with
literals replaced by variable names and a mapping from names to
the new variables</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">extract_numeric_literals</span>
<span class="gp">sage: </span><span class="n">code</span><span class="p">,</span> <span class="n">nums</span> <span class="o">=</span> <span class="n">extract_numeric_literals</span><span class="p">(</span><span class="s2">&quot;1.2 + 5&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="go">_sage_const_1p2  + _sage_const_5</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<span class="go">{&#39;_sage_const_1p2&#39;: &quot;RealNumber(&#39;1.2&#39;)&quot;, &#39;_sage_const_5&#39;: &#39;Integer(5)&#39;}</span>

<span class="gp">sage: </span><span class="n">extract_numeric_literals</span><span class="p">(</span><span class="s2">&quot;[1, 1.1, 1e1, -1e-1, 1.]&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;[_sage_const_1 , _sage_const_1p1 , _sage_const_1e1 , -_sage_const_1en1 , _sage_const_1p ]&#39;</span>

<span class="gp">sage: </span><span class="n">extract_numeric_literals</span><span class="p">(</span><span class="s2">&quot;[1.sqrt(), 1.2.sqrt(), 1r, 1.2r, R.1, R0.1, (1..5)]&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;[_sage_const_1 .sqrt(), _sage_const_1p2 .sqrt(), 1 , 1.2 , R.1, R0.1, (_sage_const_1 .._sage_const_5 )]&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.handle_encoding_declaration">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">handle_encoding_declaration</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">contents</span></em>, <em class="sig-param"><span class="n">out</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.handle_encoding_declaration" title="Permalink to this definition">¶</a></dt>
<dd><p>Find a PEP 263-style Python encoding declaration in the first or
second line of <code class="docutils literal notranslate"><span class="pre">contents</span></code>. If found, output it to <code class="docutils literal notranslate"><span class="pre">out</span></code> and return
<code class="docutils literal notranslate"><span class="pre">contents</span></code> without the encoding line; otherwise output a default
UTF-8 declaration and return <code class="docutils literal notranslate"><span class="pre">contents</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">handle_encoding_declaration</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">sage: </span><span class="n">c1</span><span class="o">=</span><span class="s1">&#39;# -*- coding: latin-1 -*-</span><span class="se">\n</span><span class="s1">import os, sys</span><span class="se">\n</span><span class="s1">...&#39;</span>
<span class="gp">sage: </span><span class="n">c2</span><span class="o">=</span><span class="s1">&#39;# -*- coding: iso-8859-15 -*-</span><span class="se">\n</span><span class="s1">import os, sys</span><span class="se">\n</span><span class="s1">...&#39;</span>
<span class="gp">sage: </span><span class="n">c3</span><span class="o">=</span><span class="s1">&#39;# -*- coding: ascii -*-</span><span class="se">\n</span><span class="s1">import os, sys</span><span class="se">\n</span><span class="s1">...&#39;</span>
<span class="gp">sage: </span><span class="n">c4</span><span class="o">=</span><span class="s1">&#39;import os, sys</span><span class="se">\n</span><span class="s1">...&#39;</span>
<span class="gp">sage: </span><span class="n">handle_encoding_declaration</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="go"># -*- coding: latin-1 -*-</span>
<span class="go">&#39;import os, sys\n...&#39;</span>
<span class="gp">sage: </span><span class="n">handle_encoding_declaration</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="go"># -*- coding: iso-8859-15 -*-</span>
<span class="go">&#39;import os, sys\n...&#39;</span>
<span class="gp">sage: </span><span class="n">handle_encoding_declaration</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="go"># -*- coding: ascii -*-</span>
<span class="go">&#39;import os, sys\n...&#39;</span>
<span class="gp">sage: </span><span class="n">handle_encoding_declaration</span><span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="go"># -*- coding: utf-8 -*-</span>
<span class="go">&#39;import os, sys\n...&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0263"><strong>PEP 263</strong></a> says that Python will interpret a UTF-8
byte order mark as a declaration of UTF-8 encoding, but I don’t
think we do that; this function only sees a Python string so it
can’t account for a BOM.</p></li>
<li><p>We default to UTF-8 encoding even though PEP 263 says that
Python files should default to ASCII.</p></li>
<li><p>Also see <a class="reference external" href="https://docs.python.org/ref/encodings.html">https://docs.python.org/ref/encodings.html</a>.</p></li>
</ul>
</div>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>Lars Fischer</p></li>
<li><p>Dan Drake (2010-12-08, rewrite for <a class="reference external" href="https://trac.sagemath.org/10440">trac ticket #10440</a>)</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.implicit_mul">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">implicit_mul</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">code</span></em>, <em class="sig-param"><span class="n">level</span><span class="o">=</span><span class="default_value">5</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.implicit_mul" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert *’s to make implicit multiplication explicit.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code>  – a string; the code with missing *’s</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">level</span></code> – an integer (default: 5); see <a class="reference internal" href="#sage.repl.preparse.implicit_multiplication" title="sage.repl.preparse.implicit_multiplication"><code class="xref py py-func docutils literal notranslate"><span class="pre">implicit_multiplication()</span></code></a>
for a list</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">implicit_mul</span>
<span class="gp">sage: </span><span class="n">implicit_mul</span><span class="p">(</span><span class="s1">&#39;(2x^2-4x+3)a0&#39;</span><span class="p">)</span>
<span class="go">&#39;(2*x^2-4*x+3)*a0&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_mul</span><span class="p">(</span><span class="s1">&#39;a b c in L&#39;</span><span class="p">)</span>
<span class="go">&#39;a*b*c in L&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_mul</span><span class="p">(</span><span class="s1">&#39;1r + 1e3 + 5exp(2)&#39;</span><span class="p">)</span>
<span class="go">&#39;1r + 1e3 + 5*exp(2)&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_mul</span><span class="p">(</span><span class="s1">&#39;f(a)(b)&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="go">&#39;f(a)*(b)&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.implicit_multiplication">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">implicit_multiplication</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">level</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.implicit_multiplication" title="Permalink to this definition">¶</a></dt>
<dd><p>Turn implicit multiplication on or off, optionally setting a
specific <code class="docutils literal notranslate"><span class="pre">level</span></code>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">level</span></code> – a boolean or integer (default: 5); how aggressive to be in
placing *’s</p>
<ul>
<li><p>0 - Do nothing</p></li>
<li><p>1 - Numeric followed by alphanumeric</p></li>
<li><p>2 - Closing parentheses followed by alphanumeric</p></li>
<li><p>3 - Spaces between alphanumeric</p></li>
<li><p>10 - Adjacent parentheses (may mangle call statements)</p></li>
</ul>
</li>
</ul>
<p>OUTPUT:</p>
<p>The current <code class="docutils literal notranslate"><span class="pre">level</span></code> if no argument is given.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">()</span>
<span class="go">5</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2x&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(2)*x&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2x&#39;</span><span class="p">)</span>
<span class="go">&#39;2x&#39;</span>
</pre></div>
</div>
<p>Note that the <a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-automagic">IPython automagic</a>
feature cannot be used if <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">&gt;=</span> <span class="pre">3</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;cd Documents&#39;</span><span class="p">)</span>
<span class="go">&#39;cd*Documents&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;cd Documents&#39;</span><span class="p">)</span>
<span class="go">&#39;cd Documents&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, one can use the explicit syntax for IPython magics such as
<code class="docutils literal notranslate"><span class="pre">%cd</span> <span class="pre">Documents</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.in_quote">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">in_quote</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.in_quote" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.isalphadigit_">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">isalphadigit_</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">s</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.isalphadigit_" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">s</span></code> is a non-empty string of alphabetic characters
or a non-empty string of digits or just a single <code class="docutils literal notranslate"><span class="pre">_</span></code></p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">isalphadigit_</span>
<span class="gp">sage: </span><span class="n">isalphadigit_</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">isalphadigit_</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">isalphadigit_</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">isalphadigit_</span><span class="p">(</span><span class="s1">&#39;a123&#39;</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.parse_ellipsis">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">parse_ellipsis</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">code</span></em>, <em class="sig-param"><span class="n">preparse_step</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.parse_ellipsis" title="Permalink to this definition">¶</a></dt>
<dd><p>Preparses [0,2,..,n] notation.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">preparse_step</span></code> - a boolean (default: True)</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">parse_ellipsis</span>
<span class="gp">sage: </span><span class="n">parse_ellipsis</span><span class="p">(</span><span class="s2">&quot;[1,2,..,n]&quot;</span><span class="p">)</span>
<span class="go">&#39;(ellipsis_range(1,2,Ellipsis,n))&#39;</span>
<span class="gp">sage: </span><span class="n">parse_ellipsis</span><span class="p">(</span><span class="s2">&quot;for i in (f(x) .. L[10]):&quot;</span><span class="p">)</span>
<span class="go">&#39;for i in (ellipsis_iter(f(x) ,Ellipsis, L[10])):&#39;</span>
<span class="gp">sage: </span><span class="p">[</span><span class="mf">1.0</span><span class="o">..</span><span class="mf">2.0</span><span class="p">]</span>
<span class="go">[1.00000000000000, 2.00000000000000]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.preparse">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">preparse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">line</span></em>, <em class="sig-param"><span class="n">reset</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">do_time</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">ignore_prompts</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">numeric_literals</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Preparses a line of input.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">line</span></code> - a string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reset</span></code> - a boolean (default: True)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">do_time</span></code> - a boolean (default: False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ignore_prompts</span></code> - a boolean (default: False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numeric_literals</span></code> - a boolean (default: True)</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;ZZ.&lt;x&gt; = ZZ[&#39;x&#39;]&quot;</span><span class="p">)</span>
<span class="go">&quot;ZZ = ZZ[&#39;x&#39;]; (x,) = ZZ._first_ngens(1)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;ZZ.&lt;x&gt; = ZZ[&#39;y&#39;]&quot;</span><span class="p">)</span>
<span class="go">&quot;ZZ = ZZ[&#39;y&#39;]; (x,) = ZZ._first_ngens(1)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;ZZ.&lt;x,y&gt; = ZZ[]&quot;</span><span class="p">)</span>
<span class="go">&quot;ZZ = ZZ[&#39;x, y&#39;]; (x, y,) = ZZ._first_ngens(2)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;ZZ.&lt;x,y&gt; = ZZ[&#39;u,v&#39;]&quot;</span><span class="p">)</span>
<span class="go">&quot;ZZ = ZZ[&#39;u,v&#39;]; (x, y,) = ZZ._first_ngens(2)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;ZZ.&lt;x&gt; = QQ[2^(1/3)]&quot;</span><span class="p">)</span>
<span class="go">&#39;ZZ = QQ[Integer(2)**(Integer(1)/Integer(3))]; (x,) = ZZ._first_ngens(1)&#39;</span>
<span class="gp">sage: </span><span class="n">QQ</span><span class="p">[</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)]</span>
<span class="go">Number Field in a with defining polynomial x^3 - 2 with a = 1.259921049894873?</span>

<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;a^b&quot;</span><span class="p">)</span>
<span class="go">&#39;a**b&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;a^^b&quot;</span><span class="p">)</span>
<span class="go">&#39;a^b&#39;</span>
<span class="gp">sage: </span><span class="mi">8</span><span class="o">^</span><span class="mi">1</span>
<span class="go">8</span>
<span class="gp">sage: </span><span class="mi">8</span><span class="o">^^</span><span class="mi">1</span>
<span class="go">9</span>
<span class="gp">sage: </span><span class="mi">9</span><span class="o">^^</span><span class="mi">1</span>
<span class="go">8</span>

<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;A </span><span class="se">\\</span><span class="s2"> B&quot;</span><span class="p">)</span>
<span class="go">&#39;A  * BackslashOperator() * B&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;A^2 </span><span class="se">\\</span><span class="s2"> B + C&quot;</span><span class="p">)</span>
<span class="go">&#39;A**Integer(2)  * BackslashOperator() * B + C&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;a </span><span class="se">\\</span><span class="s2"> b </span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># There is really only one backslash here, it&#39;s just being escaped.</span>
<span class="go">&#39;a  * BackslashOperator() * b \\&#39;</span>

<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;time R.&lt;x&gt; = ZZ[]&quot;</span><span class="p">,</span> <span class="n">do_time</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">&#39;__time__=misc.cputime(); __wall__=misc.walltime(); R = ZZ[\&#39;x\&#39;]; print(&quot;Time: CPU %.2f s, Wall: %.2f s&quot;%(misc.cputime(__time__), misc.walltime(__wall__))); (x,) = R._first_ngens(1)&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.preparse_calculus">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">preparse_calculus</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">code</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_calculus" title="Permalink to this definition">¶</a></dt>
<dd><p>Supports calculus-like function assignment, e.g., transforms:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">f(x,y,z) = sin(x^3 - 4*y) + y^x</span>
</pre></div>
</div>
<p>into:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">__tmp__=var(&quot;x,y,z&quot;)</span>
<span class="go">f = symbolic_expression(sin(x**3 - 4*y) + y**x).function(x,y,z)</span>
</pre></div>
</div>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>Bobby Moretti</p>
<ul>
<li><p>Initial version - 02/2007</p></li>
</ul>
</li>
<li><p>William Stein</p>
<ul>
<li><p>Make variables become defined if they aren’t already defined.</p></li>
</ul>
</li>
<li><p>Robert Bradshaw</p>
<ul>
<li><p>Rewrite using regular expressions (01/2009)</p></li>
</ul>
</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;f(x) = x^3-x&quot;</span><span class="p">)</span>
<span class="go">&#39;__tmp__=var(&quot;x&quot;); f = symbolic_expression(x**Integer(3)-x).function(x)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;f(u,v) = u - v&quot;</span><span class="p">)</span>
<span class="go">&#39;__tmp__=var(&quot;u,v&quot;); f = symbolic_expression(u - v).function(u,v)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;f(x) =-5&quot;</span><span class="p">)</span>
<span class="go">&#39;__tmp__=var(&quot;x&quot;); f = symbolic_expression(-Integer(5)).function(x)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;f(x) -= 5&quot;</span><span class="p">)</span>
<span class="go">&#39;f(x) -= Integer(5)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;f(x_1, x_2) = x_1^2 - x_2^2&quot;</span><span class="p">)</span>
<span class="go">&#39;__tmp__=var(&quot;x_1,x_2&quot;); f = symbolic_expression(x_1**Integer(2) - x_2**Integer(2)).function(x_1,x_2)&#39;</span>
</pre></div>
</div>
<p>For simplicity, this function assumes all statements begin and end
with a semicolon:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">preparse_calculus</span>
<span class="gp">sage: </span><span class="n">preparse_calculus</span><span class="p">(</span><span class="s2">&quot;;f(t,s)=t^2;&quot;</span><span class="p">)</span>
<span class="go">&#39;;__tmp__=var(&quot;t,s&quot;); f = symbolic_expression(t^2).function(t,s);&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_calculus</span><span class="p">(</span><span class="s2">&quot;;f( t , s ) = t^2;&quot;</span><span class="p">)</span>
<span class="go">&#39;;__tmp__=var(&quot;t,s&quot;); f = symbolic_expression(t^2).function(t,s);&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.preparse_file">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">preparse_file</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">contents</span></em>, <em class="sig-param"><span class="n">globals</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">numeric_literals</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Preparses input, attending to numeric literals and load/attach
file directives.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Temporarily, if &#64;parallel is in the input, then
numeric_literals is always set to False.</p>
</div>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contents</span></code> - a string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">globals</span></code> - dict or None (default: None); if given, then
arguments to load/attach are evaluated in the namespace of this
dict.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numeric_literals</span></code> - bool (default: True), whether to factor
out wrapping of integers and floats, so they don’t get created
repeatedly inside loops</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.preparse_file_named">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">preparse_file_named</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_file_named" title="Permalink to this definition">¶</a></dt>
<dd><p>Preparse file named code{name} (presumably a .sage file), outputting to a
temporary file.  Returns name of temporary file.</p>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.preparse_file_named_to_stream">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">preparse_file_named_to_stream</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">out</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_file_named_to_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Preparse file named code{name} (presumably a .sage file), outputting to
stream code{out}.</p>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.preparse_generators">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">preparse_generators</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">code</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_generators" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses generator syntax, converting:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">obj.&lt;gen0,gen1,...,genN&gt; = objConstructor(...)</span>
</pre></div>
</div>
<p>into:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">obj = objConstructor(..., names=(&quot;gen0&quot;, &quot;gen1&quot;, ..., &quot;genN&quot;))</span>
<span class="go">(gen0, gen1, ..., genN,) = obj.gens()</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">obj.&lt;gen0,gen1,...,genN&gt; = R[interior]</span>
</pre></div>
</div>
<p>into:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">obj = R[interior]; (gen0, gen1, ..., genN,) = obj.gens()</span>
</pre></div>
</div>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string</p></li>
</ul>
<p>LIMITATIONS:</p>
<blockquote>
<div><ul class="simple">
<li><p>The entire constructor <em>must</em> be on one line.</p></li>
</ul>
</div></blockquote>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>2006-04-14: Joe Wetherell (<a class="reference external" href="mailto:jlwether&#37;&#52;&#48;alum&#46;mit&#46;edu">jlwether<span>&#64;</span>alum<span>&#46;</span>mit<span>&#46;</span>edu</a>)</p>
<ul>
<li><p>Initial version.</p></li>
</ul>
</li>
<li><p>2006-04-17: William Stein</p>
<ul>
<li><p>Improvements to allow multiple statements.</p></li>
</ul>
</li>
<li><p>2006-05-01: William</p>
<ul>
<li><p>Fix bug that Joe found.</p></li>
</ul>
</li>
<li><p>2006-10-31: William</p>
<ul>
<li><p>Fix so obj doesn’t have to be mutated.</p></li>
</ul>
</li>
<li><p>2009-01-27: Robert Bradshaw</p>
<ul>
<li><p>Rewrite using regular expressions</p></li>
</ul>
</li>
</ul>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.preparse_numeric_literals">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">preparse_numeric_literals</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">code</span></em>, <em class="sig-param"><span class="n">extract</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_numeric_literals" title="Permalink to this definition">¶</a></dt>
<dd><p>This preparses numerical literals into their Sage counterparts,
e.g. Integer, RealNumber, and ComplexNumber.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string; a code block to preparse</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extract</span></code> - a boolean (default: False); whether to create
names for the literals and return a dictionary of
name-construction pairs</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string or (string, string:string dictionary) 2-tuple; the
preparsed block and, if <code class="docutils literal notranslate"><span class="pre">extract</span></code> is True, the
name-construction mapping</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">preparse_numeric_literals</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5&quot;</span><span class="p">)</span>
<span class="go">&#39;Integer(5)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5j&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;5&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5jr&quot;</span><span class="p">)</span>
<span class="go">&#39;5J&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5l&quot;</span><span class="p">)</span>
<span class="go">&#39;5l&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5L&quot;</span><span class="p">)</span>
<span class="go">&#39;5L&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;1.5&quot;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;1.5&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;1.5j&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;1.5&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;.5j&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;.5&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5e9j&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;5e9&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5.&quot;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;5.&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5.j&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;5.&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5.foo()&quot;</span><span class="p">)</span>
<span class="go">&#39;Integer(5).foo()&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5.5.foo()&quot;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;5.5&#39;).foo()&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5.5j.foo()&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;5.5&#39;).foo()&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5j.foo()&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;5&#39;).foo()&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;1.exp()&quot;</span><span class="p">)</span>
<span class="go">&#39;Integer(1).exp()&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;1e+10&quot;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;1e+10&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;0x0af&quot;</span><span class="p">)</span>
<span class="go">&#39;Integer(0x0af)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;0x10.sqrt()&quot;</span><span class="p">)</span>
<span class="go">&#39;Integer(0x10).sqrt()&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0o100&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0o100)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0b111001&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0b111001)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0xe&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0xe)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0xEAR&#39;</span><span class="p">)</span>
<span class="go">&#39;0xEA&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0x1012Fae&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0x1012Fae)&#39;</span>
</pre></div>
</div>
<p>Test underscores as digit separators (PEP 515,
<a class="reference external" href="https://www.python.org/dev/peps/pep-0515/">https://www.python.org/dev/peps/pep-0515/</a>):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;123_456&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(123_456)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;123_456.78_9_0&#39;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;123_456.78_9_0&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0b11_011&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0b11_011)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0o76_321&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0o76_321)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0xaa_aaa&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0xaa_aaa)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;1_3.2_5e-2_2&#39;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;1_3.2_5e-2_2&#39;)&quot;</span>

<span class="gp">sage: </span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;1_1.&quot;</span><span class="p">,</span> <span class="s2">&quot;11_2.&quot;</span><span class="p">,</span> <span class="s2">&quot;1.1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;1_1.1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;.1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;.1_1e1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;.1e1_1&quot;</span><span class="p">,</span>
<span class="gp">....: </span>          <span class="s2">&quot;1e12_3&quot;</span><span class="p">,</span> <span class="s2">&quot;1_1e1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;1.1_3e1_2&quot;</span><span class="p">,</span> <span class="s2">&quot;1_1e1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;1e1&quot;</span><span class="p">,</span> <span class="s2">&quot;1.e1_1&quot;</span><span class="p">,</span>
<span class="gp">....: </span>          <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;1_1.0&quot;</span><span class="p">]:</span>
<span class="gp">....: </span>    <span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">assert</span> <span class="n">preparse</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">f</span>
<span class="go">&quot;RealNumber(&#39;1_1.&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;11_2.&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1.1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1_1.1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;.1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;.1_1e1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;.1e1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1e12_3&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1_1e1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1.1_3e1_2&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1_1e1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1e1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1.e1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1.0&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1_1.0&#39;)&quot;</span>
</pre></div>
</div>
<p>Having consecutive underscores is not valid Python syntax, so
it is not preparsed, and similarly with a trailing underscore:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;123__45&#39;</span><span class="p">)</span>
<span class="go">&#39;123__45&#39;</span>
<span class="gp">sage: </span><span class="mi">123</span><span class="n">__45</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">SyntaxError: invalid ...</span>

<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;3040_1_&#39;</span><span class="p">)</span>
<span class="go">&#39;3040_1_&#39;</span>
<span class="gp">sage: </span><span class="mi">3040</span><span class="n">_1_</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">SyntaxError: invalid ...</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.strip_prompts">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">strip_prompts</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">line</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.strip_prompts" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes leading sage: and &gt;&gt;&gt; prompts so that pasting of examples
from the documentation works.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">line</span></code> - a string to process</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string stripped of leading prompts</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">strip_prompts</span>
<span class="gp">sage: </span><span class="n">strip_prompts</span><span class="p">(</span><span class="s2">&quot;sage: 2 + 2&quot;</span><span class="p">)</span>
<span class="go">&#39;2 + 2&#39;</span>
<span class="gp">sage: </span><span class="n">strip_prompts</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&gt;   3 + 2&quot;</span><span class="p">)</span>
<span class="go">&#39;3 + 2&#39;</span>
<span class="gp">sage: </span><span class="n">strip_prompts</span><span class="p">(</span><span class="s2">&quot;  2 + 4&quot;</span><span class="p">)</span>
<span class="go">&#39;  2 + 4&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.repl.preparse.strip_string_literals">
<code class="sig-prename descclassname">sage.repl.preparse.</code><code class="sig-name descname">strip_string_literals</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">code</span></em>, <em class="sig-param"><span class="n">state</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.strip_string_literals" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a string with all literal quotes replaced with labels and
a dictionary of labels for re-substitution.  This makes parsing
easier.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string; the input</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state</span></code> - a 2-tuple (default: None); state with which to
continue processing, e.g., across multiple calls to this
function</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a 3-tuple of the processed code, the dictionary of labels, and
any accumulated state</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">strip_string_literals</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">strip_string_literals</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;&#39;[&#39;a&#39;, &quot;b&quot;, &#39;c&#39;, &quot;d\&quot;&quot;]&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">s</span>
<span class="go">&#39;[%(L1)s, %(L2)s, %(L3)s, %(L4)s]&#39;</span>
<span class="gp">sage: </span><span class="n">literals</span>
<span class="go">{&#39;L1&#39;: &quot;&#39;a&#39;&quot;, &#39;L2&#39;: &#39;&quot;b&quot;&#39;, &#39;L3&#39;: &quot;&#39;c&#39;&quot;, &#39;L4&#39;: &#39;&quot;d\\&quot;&quot;&#39;}</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">s</span> <span class="o">%</span> <span class="n">literals</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &quot;b&quot;, &#39;c&#39;, &quot;d\&quot;&quot;]</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">strip_string_literals</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-&quot;</span><span class="se">\\</span><span class="s1">\&quot;&quot;-&quot;</span><span class="se">\\</span><span class="s1">&quot;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">-%(L1)s-%(L2)s-</span>
</pre></div>
</div>
<p>Triple-quotes are handled as well:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">strip_string_literals</span><span class="p">(</span><span class="s2">&quot;[a, &#39;&#39;&#39;b&#39;&#39;&#39;, c, &#39;&#39;]&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">s</span>
<span class="go">&#39;[a, %(L1)s, c, %(L2)s]&#39;</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">s</span> <span class="o">%</span> <span class="n">literals</span><span class="p">)</span>
<span class="go">[a, &#39;&#39;&#39;b&#39;&#39;&#39;, c, &#39;&#39;]</span>
</pre></div>
</div>
<p>Comments are substitute too:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">strip_string_literals</span><span class="p">(</span><span class="s2">&quot;code &#39;#&#39; # ccc &#39;t&#39;&quot;</span><span class="p">);</span> <span class="n">s</span>
<span class="go">&#39;code %(L1)s #%(L2)s&#39;</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">%</span> <span class="n">literals</span>
<span class="go">&quot;code &#39;#&#39; # ccc &#39;t&#39;&quot;</span>
</pre></div>
</div>
<p>A state is returned so one can break strings across multiple calls to
this function:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">strip_string_literals</span><span class="p">(</span><span class="s1">&#39;s = &quot;some&#39;</span><span class="p">);</span> <span class="n">s</span>
<span class="go">&#39;s = %(L1)s&#39;</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">strip_string_literals</span><span class="p">(</span><span class="s1">&#39;thing&quot; * 5&#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span> <span class="n">s</span>
<span class="go">&#39;%(L1)s * 5&#39;</span>
</pre></div>
</div>
</dd></dl>

</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="../misc/trace.html"
                        title="previous chapter">Interactively tracing execution of a command</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="load.html"
                        title="next chapter">Load Python, Sage, Cython, Fortran and Magma files in Sage</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/sage/repl/preparse.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="load.html" title="Load Python, Sage, Cython, Fortran and Magma files in Sage"
             >next</a> |</li>
        <li class="right" >
          <a href="../misc/trace.html" title="Interactively tracing execution of a command"
             >previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Sage 9.2 Reference Manual: The Sage Command Line</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">The Sage Preparser</a></li> 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005--2020, The Sage Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* The sidebar toggle adapts its height to the bodywrapper height. */
    const resizeObserver = new ResizeObserver(entries => {
        tog.height(bod.height());
    });
    resizeObserver.observe(bod[0]);

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>