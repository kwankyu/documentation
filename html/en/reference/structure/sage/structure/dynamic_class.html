
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="viewport" content="width=600, initial-scale=1">
    <title>Dynamic classes &#8212; Sage 9.3 Reference Manual: Parents and Elements</title>
    <link rel="stylesheet" href="../../../_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script async="async" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Mutability Cython Implementation" href="mutability.html" />
    <link rel="prev" title="Factory for cached representations" href="factory.html" />
    <link rel="icon" href="../../../_static/sageicon.png" type="image/x-icon" />
    <script src="../../../_static/thebe.js" type="text/javascript"></script>
    <script src="../../../_static/thebe-sage.js" type="text/javascript"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="mutability.html" title="Mutability Cython Implementation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="factory.html" title="Factory for cached representations"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Sage 9.3 Reference Manual: Parents and Elements</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Dynamic classes</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="dynamic-classes">
<span id="sage-structure-dynamic-class"></span><h1>Dynamic classes<a class="headerlink" href="#dynamic-classes" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-sage.structure.dynamic_class"></span><p class="rubric">Why dynamic classes?</p>
<p>The short answer:</p>
<ul class="simple">
<li><p>Multiple inheritance is a powerful tool for constructing new classes
by combining preexisting building blocks.</p></li>
<li><p>There is a combinatorial explosion in the number of potentially
useful classes that can be produced this way.</p></li>
<li><p>The implementation of standard mathematical constructions calls for
producing such combinations automatically.</p></li>
<li><p>Dynamic classes, i.e. classes created on the fly by the Python
interpreter, are a natural mean to achieve this.</p></li>
</ul>
<p>The long answer:</p>
<p>Say we want to construct a new class <code class="docutils literal notranslate"><span class="pre">MyPermutation</span></code> for
permutations in a given set <span class="math notranslate nohighlight">\(S\)</span> (in Sage, <span class="math notranslate nohighlight">\(S\)</span> will be modelled by a
parent, but we won’t discuss this point here).  First, we have to
choose a data structure for the permutations, typically among the
following:</p>
<ul class="simple">
<li><p>Stored by cycle type</p></li>
<li><p>Stored by code</p></li>
<li><p>Stored in list notation
- C arrays of short ints (for small permutations)
- python lists of ints (for huge permutations)
- …</p></li>
<li><p>Stored by reduced word</p></li>
<li><p>Stored as a function</p></li>
<li><p>…</p></li>
</ul>
<p>Luckily, the Sage library provides (or will provide) classes
implementing each of those data structures. Those classes all share a
common interface (or possibly a common abstract base class). So we can
just derive our class from the chosen one:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">class MyPermutation(PermutationCycleType):</span>
<span class="go">    ...</span>
</pre></div>
</div>
<p>Then we may want to further choose a specific memory behavior (unique
representation, copy-on-write) which (hopefully) can again be achieved
by inheritance:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">class MyPermutation(UniqueRepresentation, PermutationCycleType):</span>
<span class="go">     ...</span>
</pre></div>
</div>
<p>Finally, we may want to endow the permutations in <span class="math notranslate nohighlight">\(S\)</span> with further
operations coming from the (algebraic) structure of <span class="math notranslate nohighlight">\(S\)</span>:</p>
<ul class="simple">
<li><p>group operations</p></li>
<li><p>or just monoid operations (for a subset of permutations not stable by inverse)</p></li>
<li><p>poset operations (for left/right/Bruhat order)</p></li>
<li><p>word operations (searching for substrings, patterns, …)</p></li>
</ul>
<p>Or any combination thereof. Now, our class typically looks like:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">class MyPermutation(UniqueRepresentation, PermutationCycleType, PosetElement, GroupElement):</span>
<span class="go">     ...</span>
</pre></div>
</div>
<p>Note the combinatorial explosion in the potential number of classes
which can be created this way.</p>
<p>In practice, such classes will be used in mathematical constructions
like:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">SymmetricGroup(5).subset(... TODO: find a good example in the context above ...)</span>
</pre></div>
</div>
<p>In such a construction, the structure of the result, and therefore the
operations on its elements can only be determined at execution
time. Let us take another standard construction:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">A = cartesian_product( B, C )</span>
</pre></div>
</div>
<p>Depending on the structure of <span class="math notranslate nohighlight">\(B\)</span> and <span class="math notranslate nohighlight">\(C\)</span>, and possibly on further
options passed down by the user, <span class="math notranslate nohighlight">\(A\)</span> may be:</p>
<ul class="simple">
<li><p>an enumerated set</p></li>
<li><p>a group</p></li>
<li><p>an algebra</p></li>
<li><p>a poset</p></li>
<li><p>…</p></li>
</ul>
<p>Or any combination thereof.</p>
<p>Hardcoding classes for all potential combinations would be at best
tedious. Furthermore, this would require a cumbersome mechanism to
lookup the appropriate class depending on the desired combination.</p>
<p>Instead, one may use the ability of Python to create new classes
dynamically:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">type(&quot;class name&quot;, tuple of base classes, dictionary of methods)</span>
</pre></div>
</div>
<p>This paradigm is powerful, but there are some technicalities to
address. The purpose of this library is to standardize its use within
Sage, and in particular to ensure that the constructed classes are
reused whenever possible (unique representation), and can be pickled.</p>
<p class="rubric">Combining dynamic classes and Cython classes</p>
<p>Cython classes cannot inherit from a dynamic class (there might be
some partial support for this in the future). On the other hand, such
an inheritance can be partially emulated using <code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattr__()</span></code>. See
<code class="docutils literal notranslate"><span class="pre">sage.categories.examples.semigroups_cython</span></code> for an example.</p>
<dl class="py class">
<dt id="sage.structure.dynamic_class.DynamicClasscallMetaclass">
<em class="property">class </em><code class="sig-prename descclassname">sage.structure.dynamic_class.</code><code class="sig-name descname">DynamicClasscallMetaclass</code><a class="headerlink" href="#sage.structure.dynamic_class.DynamicClasscallMetaclass" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.structure.dynamic_class.DynamicMetaclass" title="sage.structure.dynamic_class.DynamicMetaclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.structure.dynamic_class.DynamicMetaclass</span></code></a>, <a class="reference external" href="../../../misc/sage/misc/classcall_metaclass.html#sage.misc.classcall_metaclass.ClasscallMetaclass" title="(in Sage 9.3 Reference Manual: Utilities v9.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.misc.classcall_metaclass.ClasscallMetaclass</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="sage.structure.dynamic_class.DynamicInheritComparisonClasscallMetaclass">
<em class="property">class </em><code class="sig-prename descclassname">sage.structure.dynamic_class.</code><code class="sig-name descname">DynamicInheritComparisonClasscallMetaclass</code><a class="headerlink" href="#sage.structure.dynamic_class.DynamicInheritComparisonClasscallMetaclass" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.structure.dynamic_class.DynamicMetaclass" title="sage.structure.dynamic_class.DynamicMetaclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.structure.dynamic_class.DynamicMetaclass</span></code></a>, <a class="reference external" href="../../../misc/sage/misc/inherit_comparison.html#sage.misc.inherit_comparison.InheritComparisonClasscallMetaclass" title="(in Sage 9.3 Reference Manual: Utilities v9.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.misc.inherit_comparison.InheritComparisonClasscallMetaclass</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="sage.structure.dynamic_class.DynamicInheritComparisonMetaclass">
<em class="property">class </em><code class="sig-prename descclassname">sage.structure.dynamic_class.</code><code class="sig-name descname">DynamicInheritComparisonMetaclass</code><a class="headerlink" href="#sage.structure.dynamic_class.DynamicInheritComparisonMetaclass" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.structure.dynamic_class.DynamicMetaclass" title="sage.structure.dynamic_class.DynamicMetaclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.structure.dynamic_class.DynamicMetaclass</span></code></a>, <a class="reference external" href="../../../misc/sage/misc/inherit_comparison.html#sage.misc.inherit_comparison.InheritComparisonMetaclass" title="(in Sage 9.3 Reference Manual: Utilities v9.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.misc.inherit_comparison.InheritComparisonMetaclass</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="sage.structure.dynamic_class.DynamicMetaclass">
<em class="property">class </em><code class="sig-prename descclassname">sage.structure.dynamic_class.</code><code class="sig-name descname">DynamicMetaclass</code><a class="headerlink" href="#sage.structure.dynamic_class.DynamicMetaclass" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">type</span></code></p>
<p>A metaclass implementing an appropriate reduce-by-construction method</p>
</dd></dl>

<dl class="py attribute">
<dt id="sage.structure.dynamic_class.M">
<code class="sig-prename descclassname">sage.structure.dynamic_class.</code><code class="sig-name descname">M</code><a class="headerlink" href="#sage.structure.dynamic_class.M" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#sage.structure.dynamic_class.DynamicInheritComparisonClasscallMetaclass" title="sage.structure.dynamic_class.DynamicInheritComparisonClasscallMetaclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.structure.dynamic_class.DynamicInheritComparisonClasscallMetaclass</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="sage.structure.dynamic_class.TestClass">
<em class="property">class </em><code class="sig-prename descclassname">sage.structure.dynamic_class.</code><code class="sig-name descname">TestClass</code><a class="headerlink" href="#sage.structure.dynamic_class.TestClass" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class used for checking that introspection works</p>
<dl class="py method">
<dt id="sage.structure.dynamic_class.TestClass.bla">
<code class="sig-name descname">bla</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.dynamic_class.TestClass.bla" title="Permalink to this definition">¶</a></dt>
<dd><p>bla …</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="sage.structure.dynamic_class.dynamic_class">
<code class="sig-prename descclassname">sage.structure.dynamic_class.</code><code class="sig-name descname">dynamic_class</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">bases</span></em>, <em class="sig-param"><span class="n">cls</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">reduction</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">doccls</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">prepend_cls_bases</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">cache</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.dynamic_class.dynamic_class" title="Permalink to this definition">¶</a></dt>
<dd><p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> – a string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bases</span></code> – a tuple of classes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cls</span></code> – a class or <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reduction</span></code> – a tuple or <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">doccls</span></code> – a class or <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prepend_cls_bases</span></code> – a boolean (default: <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cache</span></code> – a boolean or <code class="docutils literal notranslate"><span class="pre">&quot;ignore_reduction&quot;</span></code> (default: <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p></li>
</ul>
<p>Constructs dynamically a new class <code class="docutils literal notranslate"><span class="pre">C</span></code> with name <code class="docutils literal notranslate"><span class="pre">name</span></code>, and
bases <code class="docutils literal notranslate"><span class="pre">bases</span></code>. If <code class="docutils literal notranslate"><span class="pre">cls</span></code> is provided, then its methods will be
inserted into <code class="docutils literal notranslate"><span class="pre">C</span></code>, and its bases will be prepended to <code class="docutils literal notranslate"><span class="pre">bases</span></code>
(unless <code class="docutils literal notranslate"><span class="pre">prepend_cls_bases</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>).</p>
<p>The module, documentation and source instrospection is taken from
<code class="docutils literal notranslate"><span class="pre">doccls</span></code>, or <code class="docutils literal notranslate"><span class="pre">cls</span></code> if <code class="docutils literal notranslate"><span class="pre">doccls</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, or <code class="docutils literal notranslate"><span class="pre">bases[0]</span></code>
if both are <code class="docutils literal notranslate"><span class="pre">None</span></code> (therefore <code class="docutils literal notranslate"><span class="pre">bases</span></code> should be non empty if
<code class="docutils literal notranslate"><span class="pre">cls`</span> <span class="pre">is</span> <span class="pre">``None</span></code>).</p>
<p>The constructed class can safely be pickled (assuming the
arguments themselves can).</p>
<p>Unless <code class="docutils literal notranslate"><span class="pre">cache</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, the result is cached, ensuring unique
representation of dynamic classes.</p>
<p>See <a class="reference internal" href="#module-sage.structure.dynamic_class" title="sage.structure.dynamic_class"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sage.structure.dynamic_class</span></code></a> for a discussion of the
dynamic classes paradigm, and its relevance to Sage.</p>
<p>EXAMPLES:</p>
<p>To setup the stage, we create a class Foo with some methods,
cached methods, and lazy attributes, and a class Bar:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.lazy_attribute</span> <span class="kn">import</span> <span class="n">lazy_attribute</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.cachefunc</span> <span class="kn">import</span> <span class="n">cached_function</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.dynamic_class</span> <span class="kn">import</span> <span class="n">dynamic_class</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="s2">&quot;The Foo class&quot;</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>
<span class="gp">....: </span>    <span class="nd">@cached_method</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">^</span><span class="mi">2</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">^</span><span class="mi">2</span>
<span class="gp">....: </span>    <span class="nd">@lazy_attribute</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">Bar</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">^</span><span class="mi">2</span>
</pre></div>
</div>
<p>We now create a class FooBar which is a copy of Foo, except that it
also inherits from Bar:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">FooBar</span> <span class="o">=</span> <span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;FooBar&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Bar</span><span class="p">,),</span> <span class="n">Foo</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">FooBar</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span><span class="o">.</span><span class="n">f</span><span class="p">()</span>
<span class="go">9</span>
<span class="gp">sage: </span><span class="n">x</span><span class="o">.</span><span class="n">f</span><span class="p">()</span> <span class="ow">is</span> <span class="n">x</span><span class="o">.</span><span class="n">f</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">x</span><span class="o">.</span><span class="n">x</span>
<span class="go">3</span>
<span class="gp">sage: </span><span class="n">x</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
<span class="go">9</span>
<span class="gp">sage: </span><span class="n">FooBar</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;FooBar&#39;</span>
<span class="gp">sage: </span><span class="n">FooBar</span><span class="o">.</span><span class="vm">__module__</span>
<span class="go">&#39;__main__&#39;</span>

<span class="gp">sage: </span><span class="n">Foo</span><span class="o">.</span><span class="vm">__bases__</span>
<span class="go">(&lt;type &#39;object&#39;&gt;,)</span>
<span class="gp">sage: </span><span class="n">FooBar</span><span class="o">.</span><span class="vm">__bases__</span>  <span class="c1"># py2</span>
<span class="go">(&lt;type &#39;object&#39;&gt;, &lt;class __main__.Bar at ...&gt;)</span>
<span class="gp">sage: </span><span class="n">FooBar</span><span class="o">.</span><span class="vm">__bases__</span>  <span class="c1"># py3</span>
<span class="go">(&lt;class &#39;__main__.Bar&#39;&gt;,)</span>
<span class="gp">sage: </span><span class="n">Foo</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
<span class="go">[&lt;class &#39;__main__.Foo&#39;&gt;, &lt;type &#39;object&#39;&gt;]</span>
<span class="gp">sage: </span><span class="n">FooBar</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>  <span class="c1"># py2</span>
<span class="go">[&lt;class &#39;__main__.FooBar&#39;&gt;, &lt;type &#39;object&#39;&gt;, &lt;class __main__.Bar at ...&gt;]</span>
<span class="gp">sage: </span><span class="n">FooBar</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>  <span class="c1"># py3</span>
<span class="go">[&lt;class &#39;__main__.FooBar&#39;&gt;, &lt;class &#39;__main__.Bar&#39;&gt;, &lt;class &#39;object&#39;&gt;]</span>
</pre></div>
</div>
<p>If all the base classes have a zero <code class="docutils literal notranslate"><span class="pre">__dictoffset__</span></code>, the dynamic
class also has a zero <code class="docutils literal notranslate"><span class="pre">__dictoffset__</span></code>. This means that the
instances of the class don’t have a <code class="docutils literal notranslate"><span class="pre">__dict__</span></code>
(see <a class="reference external" href="https://trac.sagemath.org/23435">trac ticket #23435</a>):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">dyn</span> <span class="o">=</span> <span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;dyn&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Integer</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">dyn</span><span class="o">.</span><span class="n">__dictoffset__</span>
<span class="go">0</span>
</pre></div>
</div>
<p class="rubric">Pickling</p>
<p>Dynamic classes are pickled by construction. Namely, upon
unpickling, the class will be reconstructed by recalling
dynamic_class with the same arguments:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">FooBar</span><span class="p">)</span><span class="o">.</span><span class="n">__reduce__</span><span class="p">(</span><span class="n">FooBar</span><span class="p">)</span>  <span class="c1"># py2</span>
<span class="go">(&lt;function dynamic_class at ...&gt;, (&#39;FooBar&#39;, (&lt;class __main__.Bar at ...&gt;,), &lt;class &#39;__main__.Foo&#39;&gt;, None, None))</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">FooBar</span><span class="p">)</span><span class="o">.</span><span class="n">__reduce__</span><span class="p">(</span><span class="n">FooBar</span><span class="p">)</span>  <span class="c1"># py3</span>
<span class="go">(&lt;function dynamic_class at ...&gt;, (&#39;FooBar&#39;, (&lt;class &#39;__main__.Bar&#39;&gt;,), &lt;class &#39;__main__.Foo&#39;&gt;, None, None))</span>
</pre></div>
</div>
<p>Technically, this is achieved by using a metaclass, since the
Python pickling protocol for classes is to pickle by name:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">FooBar</span><span class="p">)</span>
<span class="go">&lt;class &#39;sage.structure.dynamic_class.DynamicMetaclass&#39;&gt;</span>
</pre></div>
</div>
<p>The following (meaningless) example illustrates how to customize
the result of the reduction:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">BarFoo</span> <span class="o">=</span> <span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;BarFoo&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Foo</span><span class="p">,),</span> <span class="n">Bar</span><span class="p">,</span> <span class="n">reduction</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)))</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">BarFoo</span><span class="p">)</span><span class="o">.</span><span class="n">__reduce__</span><span class="p">(</span><span class="n">BarFoo</span><span class="p">)</span>
<span class="go">(&lt;type &#39;str&#39;&gt;, (3,))</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">BarFoo</span><span class="p">))</span>
<span class="go">&#39;3&#39;</span>
</pre></div>
</div>
<p class="rubric">Caching</p>
<p>By default, the built class is cached:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;FooBar&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Bar</span><span class="p">,),</span> <span class="n">Foo</span><span class="p">)</span> <span class="ow">is</span> <span class="n">FooBar</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;FooBar&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Bar</span><span class="p">,),</span> <span class="n">Foo</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="ow">is</span> <span class="n">FooBar</span>
<span class="go">True</span>
</pre></div>
</div>
<p>and the result depends on the reduction:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;BarFoo&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Foo</span><span class="p">,),</span> <span class="n">Bar</span><span class="p">,</span> <span class="n">reduction</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)))</span> <span class="ow">is</span> <span class="n">BarFoo</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;BarFoo&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Foo</span><span class="p">,),</span> <span class="n">Bar</span><span class="p">,</span> <span class="n">reduction</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)))</span> <span class="ow">is</span> <span class="n">BarFoo</span>
<span class="go">False</span>
</pre></div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">cache=False</span></code>, a new class is created each time:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">FooBar1</span> <span class="o">=</span> <span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;FooBar&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Bar</span><span class="p">,),</span> <span class="n">Foo</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">False</span><span class="p">);</span> <span class="n">FooBar1</span>
<span class="go">&lt;class &#39;__main__.FooBar&#39;&gt;</span>
<span class="gp">sage: </span><span class="n">FooBar2</span> <span class="o">=</span> <span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;FooBar&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Bar</span><span class="p">,),</span> <span class="n">Foo</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">False</span><span class="p">);</span> <span class="n">FooBar2</span>
<span class="go">&lt;class &#39;__main__.FooBar&#39;&gt;</span>
<span class="gp">sage: </span><span class="n">FooBar1</span> <span class="ow">is</span> <span class="n">FooBar</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="n">FooBar2</span> <span class="ow">is</span> <span class="n">FooBar1</span>
<span class="go">False</span>
</pre></div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">cache=&quot;ignore_reduction&quot;</span></code>, the class does not depend on
the reduction:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">BarFoo</span> <span class="o">=</span> <span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;BarFoo&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Foo</span><span class="p">,),</span> <span class="n">Bar</span><span class="p">,</span> <span class="n">reduction</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">cache</span><span class="o">=</span><span class="s2">&quot;ignore_reduction&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;BarFoo&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Foo</span><span class="p">,),</span> <span class="n">Bar</span><span class="p">,</span> <span class="n">reduction</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)),</span> <span class="n">cache</span><span class="o">=</span><span class="s2">&quot;ignore_reduction&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">BarFoo</span>
<span class="go">True</span>
</pre></div>
</div>
<p>In particular, the reduction used is that provided upon creating the
first class:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">dynamic_class</span><span class="p">(</span><span class="s2">&quot;BarFoo&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Foo</span><span class="p">,),</span> <span class="n">Bar</span><span class="p">,</span> <span class="n">reduction</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)),</span> <span class="n">cache</span><span class="o">=</span><span class="s2">&quot;ignore_reduction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">_reduction</span>
<span class="go">(&lt;type &#39;str&#39;&gt;, (3,))</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The behaviour upon creating several dynamic classes from the
same data but with different values for <code class="docutils literal notranslate"><span class="pre">cache</span></code> option is
currently left unspecified. In other words, for a given
application, it is recommended to consistently use the same
value for that option.</p>
</div>
</dd></dl>

<dl class="py function">
<dt id="sage.structure.dynamic_class.dynamic_class_internal">
<code class="sig-prename descclassname">sage.structure.dynamic_class.</code><code class="sig-name descname">dynamic_class_internal</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">bases</span></em>, <em class="sig-param"><span class="n">cls</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">reduction</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">doccls</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">prepend_cls_bases</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.dynamic_class.dynamic_class_internal" title="Permalink to this definition">¶</a></dt>
<dd><p>See sage.structure.dynamic_class.dynamic_class? for indirect doctests.</p>
</dd></dl>

</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="factory.html"
                        title="previous chapter">Factory for cached representations</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="mutability.html"
                        title="next chapter">Mutability Cython Implementation</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/sage/structure/dynamic_class.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="mutability.html" title="Mutability Cython Implementation"
             >next</a> |</li>
        <li class="right" >
          <a href="factory.html" title="Factory for cached representations"
             >previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Sage 9.3 Reference Manual: Parents and Elements</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Dynamic classes</a></li> 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005--2021, The Sage Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* The sidebar toggle adapts its height to the bodywrapper height. */
    const resizeObserver = new ResizeObserver(entries => {
        tog.height(bod.height());
    });
    resizeObserver.observe(bod[0]);

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>