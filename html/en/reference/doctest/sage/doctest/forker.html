
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=600, initial-scale=1">
    <title>Processes for running doctests &#8212; Sage Reference Manual v8.7: Sage&#39;s Doctesting Framework</title>
    <link rel="stylesheet" href="../../../_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Parsing docstrings" href="parsing.html" />
    <link rel="prev" title="Classes for sources of doctests" href="sources.html" />
    <link rel="icon" href="../../../_static/sageicon.png" type="image/x-icon" />
    <script src="../../../_static/thebe.js" type="text/javascript"></script>
    <script src="../../../_static/thebe-sage.js" type="text/javascript"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="parsing.html" title="Parsing docstrings"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sources.html" title="Classes for sources of doctests"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Sage&#39;s Doctesting Framework</a> &#187;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="processes-for-running-doctests">
<span id="sage-doctest-forker"></span><h1>Processes for running doctests<a class="headerlink" href="#processes-for-running-doctests" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-sage.doctest.forker"></span><p>This module controls the processes started by Sage that actually run
the doctests.</p>
<p>EXAMPLES:</p>
<p>The following examples are used in doctesting this file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">doctest_var</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="n">doctest_var</span><span class="o">^</span><span class="mi">2</span>
<span class="go">1764</span>
<span class="gp">sage: </span><span class="n">R</span><span class="o">.&lt;</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">a</span> <span class="o">+</span> <span class="n">doctest_var</span>
<span class="go">a + 42</span>
</pre></div>
</div>
<p>AUTHORS:</p>
<ul class="simple">
<li>David Roe (2012-03-27) – initial version, based on Robert Bradshaw’s code.</li>
<li>Jeroen Demeyer (2013 and 2015) – major improvements to forking and logging</li>
</ul>
<dl class="class">
<dt id="sage.doctest.forker.DocTestDispatcher">
<em class="property">class </em><code class="descclassname">sage.doctest.forker.</code><code class="descname">DocTestDispatcher</code><span class="sig-paren">(</span><em>controller</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestDispatcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="../../../structure/sage/structure/sage_object.html#sage.structure.sage_object.SageObject" title="(in Sage Reference Manual: Parents and Elements v8.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.structure.sage_object.SageObject</span></code></a></p>
<p>Creates parallel <a class="reference internal" href="#sage.doctest.forker.DocTestWorker" title="sage.doctest.forker.DocTestWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocTestWorker</span></code></a> processes and dispatches
doctesting tasks.</p>
<dl class="method">
<dt id="sage.doctest.forker.DocTestDispatcher.dispatch">
<code class="descname">dispatch</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestDispatcher.dispatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the doctests for the controller’s specified sources,
by calling <a class="reference internal" href="#sage.doctest.forker.DocTestDispatcher.parallel_dispatch" title="sage.doctest.forker.DocTestDispatcher.parallel_dispatch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">parallel_dispatch()</span></code></a> or <a class="reference internal" href="#sage.doctest.forker.DocTestDispatcher.serial_dispatch" title="sage.doctest.forker.DocTestDispatcher.serial_dispatch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">serial_dispatch()</span></code></a>
according to the <code class="docutils literal notranslate"><span class="pre">--serial</span></code> option.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestDispatcher</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.util</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">freehom</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;modules&#39;</span><span class="p">,</span> <span class="s1">&#39;free_module_homspace.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">bigo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;rings&#39;</span><span class="p">,</span> <span class="s1">&#39;big_oh.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DocTestDefaults</span><span class="p">(),</span> <span class="p">[</span><span class="n">freehom</span><span class="p">,</span> <span class="n">bigo</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">expand_files_into_sources</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDispatcher</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DR</span> <span class="o">=</span> <span class="n">DocTestReporter</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="n">DR</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">DD</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span><span class="o">.</span><span class="n">dispatch</span><span class="p">()</span>
<span class="go">sage -t .../sage/modules/free_module_homspace.py</span>
<span class="go">    [... tests, ... s]</span>
<span class="go">sage -t .../sage/rings/big_oh.py</span>
<span class="go">    [... tests, ... s]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.DocTestDispatcher.parallel_dispatch">
<code class="descname">parallel_dispatch</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestDispatcher.parallel_dispatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the doctests from the controller’s specified sources in parallel.</p>
<p>This creates <a class="reference internal" href="#sage.doctest.forker.DocTestWorker" title="sage.doctest.forker.DocTestWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocTestWorker</span></code></a> subprocesses, while the master
process checks for timeouts and collects and displays the results.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestDispatcher</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.util</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">crem</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;databases&#39;</span><span class="p">,</span> <span class="s1">&#39;cremona.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">bigo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;rings&#39;</span><span class="p">,</span> <span class="s1">&#39;big_oh.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DocTestDefaults</span><span class="p">(),</span> <span class="p">[</span><span class="n">crem</span><span class="p">,</span> <span class="n">bigo</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">expand_files_into_sources</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDispatcher</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DR</span> <span class="o">=</span> <span class="n">DocTestReporter</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="n">DR</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">DD</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span><span class="o">.</span><span class="n">parallel_dispatch</span><span class="p">()</span>
<span class="go">sage -t .../databases/cremona.py</span>
<span class="go">    [... tests, ... s]</span>
<span class="go">sage -t .../rings/big_oh.py</span>
<span class="go">    [... tests, ... s]</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">exitfirst=True</span></code> option is given, the results for a failing
module will be immediately printed and any other ongoing tests
canceled:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">test1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s1">&#39;test1.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">test2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s1">&#39;test2.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">test1</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="go">....:     _ = f.write(&quot;&#39;&#39;&#39;\nsage: import time; time.sleep(60)\n&#39;&#39;&#39;&quot;)</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">test2</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="go">....:     _ = f.write(&quot;&#39;&#39;&#39;\nsage: True\nFalse\n&#39;&#39;&#39;&quot;)</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DocTestDefaults</span><span class="p">(</span><span class="n">exitfirst</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="go">....:                                        nthreads=2),</span>
<span class="go">....:                        [test1, test2])</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">expand_files_into_sources</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDispatcher</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DR</span> <span class="o">=</span> <span class="n">DocTestReporter</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="n">DR</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">DD</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span><span class="o">.</span><span class="n">parallel_dispatch</span><span class="p">()</span>
<span class="go">sage -t .../test2.py</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;.../test2.py&quot;, line 2, in test2</span>
<span class="go">Failed example:</span>
<span class="go">    True</span>
<span class="go">Expected:</span>
<span class="go">    False</span>
<span class="go">Got:</span>
<span class="go">    True</span>
<span class="go">**********************************************************************</span>
<span class="go">1 item had failures:</span>
<span class="go">   1 of   1 in test2</span>
<span class="go">    [1 test, 1 failure, ... s]</span>
<span class="go">Killing test .../test1.py</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.DocTestDispatcher.serial_dispatch">
<code class="descname">serial_dispatch</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestDispatcher.serial_dispatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the doctests from the controller’s specified sources in series.</p>
<p>There is no graceful handling for signals, no possibility of
interrupting tests and no timeout.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestDispatcher</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.util</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">homset</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;rings&#39;</span><span class="p">,</span> <span class="s1">&#39;homset.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ideal</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;rings&#39;</span><span class="p">,</span> <span class="s1">&#39;ideal.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DocTestDefaults</span><span class="p">(),</span> <span class="p">[</span><span class="n">homset</span><span class="p">,</span> <span class="n">ideal</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">expand_files_into_sources</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDispatcher</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DR</span> <span class="o">=</span> <span class="n">DocTestReporter</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="n">DR</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">DD</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span><span class="o">.</span><span class="n">serial_dispatch</span><span class="p">()</span>
<span class="go">sage -t .../rings/homset.py</span>
<span class="go">    [... tests, ... s]</span>
<span class="go">sage -t .../rings/ideal.py</span>
<span class="go">    [... tests, ... s]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="sage.doctest.forker.DocTestTask">
<em class="property">class </em><code class="descclassname">sage.doctest.forker.</code><code class="descname">DocTestTask</code><span class="sig-paren">(</span><em>source</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This class encapsulates the tests from a single source.</p>
<p>This class does not insulate from problems in the source
(e.g. entering an infinite loop or causing a segfault), that has to
be dealt with at a higher level.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">source</span></code> – a <a class="reference internal" href="sources.html#sage.doctest.sources.DocTestSource" title="sage.doctest.sources.DocTestSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.doctest.sources.DocTestSource</span></code></a> instance.</li>
<li><code class="docutils literal notranslate"><span class="pre">verbose</span></code> – boolean, controls reporting of progress by <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTestRunner" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTestRunner</span></code></a>.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestTask</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">,</span> <span class="n">DocTestController</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;sources.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTT</span> <span class="o">=</span> <span class="n">DocTestTask</span><span class="p">(</span><span class="n">FDS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DD</span><span class="p">,[</span><span class="n">filename</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">ntests</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">DTT</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ntests</span> <span class="o">&gt;=</span> <span class="mi">300</span> <span class="ow">or</span> <span class="n">ntests</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;cputime&#39;, &#39;err&#39;, &#39;failures&#39;, &#39;optionals&#39;, &#39;tests&#39;, &#39;walltime&#39;, &#39;walltime_skips&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="sage.doctest.forker.DocTestWorker">
<em class="property">class </em><code class="descclassname">sage.doctest.forker.</code><code class="descname">DocTestWorker</code><span class="sig-paren">(</span><em>source</em>, <em>options</em>, <em>funclist=[]</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.process.Process</span></code></p>
<p>The DocTestWorker process runs one <a class="reference internal" href="#sage.doctest.forker.DocTestTask" title="sage.doctest.forker.DocTestTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocTestTask</span></code></a> for a given
source. It returns messages about doctest failures (or all tests if
verbose doctesting) though a pipe and returns results through a
<code class="docutils literal notranslate"><span class="pre">multiprocessing.Queue</span></code> instance (both these are created in the
<a class="reference internal" href="#sage.doctest.forker.DocTestWorker.start" title="sage.doctest.forker.DocTestWorker.start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">start()</span></code></a> method).</p>
<p>It runs the task in its own process-group, such that killing the
process group kills this process together with its child processes.</p>
<p>The class has additional methods and attributes for bookkeeping
by the master process. Except in <a class="reference internal" href="#sage.doctest.forker.DocTestWorker.run" title="sage.doctest.forker.DocTestWorker.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a>, nothing from this
class should be accessed by the child process.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">source</span></code> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">DocTestSource</span></code> instance</li>
<li><code class="docutils literal notranslate"><span class="pre">options</span></code> – an object representing doctest options.</li>
<li><code class="docutils literal notranslate"><span class="pre">funclist</span></code> – a list of callables to be called at the start of
the child process.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestWorker</span><span class="p">,</span> <span class="n">DocTestTask</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;util.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span> <span class="o">=</span> <span class="n">DocTestWorker</span><span class="p">(</span><span class="n">FDS</span><span class="p">,</span> <span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DD</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">reporter</span> <span class="o">=</span> <span class="n">DocTestReporter</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>  <span class="c1"># Wait for worker to finish</span>
<span class="gp">sage: </span><span class="n">result</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">result_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">reporter</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">FDS</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">exitcode</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="go">    [... tests, ... s]</span>
</pre></div>
</div>
<dl class="method">
<dt id="sage.doctest.forker.DocTestWorker.kill">
<code class="descname">kill</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker.kill" title="Permalink to this definition">¶</a></dt>
<dd><p>Kill this worker.  Returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the signal(s) are sent
successfully or <code class="docutils literal notranslate"><span class="pre">False</span></code> if the worker process no longer exists.</p>
<p>This method is only called if there is something wrong with the
worker. Under normal circumstances, the worker is supposed to
exit by itself after finishing.</p>
<p>The first time this is called, use <code class="docutils literal notranslate"><span class="pre">SIGQUIT</span></code>. This will trigger
the cysignals <code class="docutils literal notranslate"><span class="pre">SIGQUIT</span></code> handler and try to print an enhanced
traceback.</p>
<p>Subsequent times, use <code class="docutils literal notranslate"><span class="pre">SIGKILL</span></code>.  Also close the message pipe
if it was still open.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">time</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestWorker</span><span class="p">,</span> <span class="n">DocTestTask</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;tests&#39;</span><span class="p">,</span><span class="s1">&#39;99seconds.rst&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
</pre></div>
</div>
<p>We set up the worker to start by blocking <code class="docutils literal notranslate"><span class="pre">SIGQUIT</span></code>, such that
killing will fail initially:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">cysignals.pselect</span> <span class="kn">import</span> <span class="n">PSelecter</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">signal</span>
<span class="gp">sage: </span><span class="k">def</span> <span class="nf">block_hup</span><span class="p">():</span>
<span class="go">....:     # We never __exit__()</span>
<span class="go">....:     PSelecter([signal.SIGQUIT]).__enter__()</span>
<span class="gp">sage: </span><span class="n">W</span> <span class="o">=</span> <span class="n">DocTestWorker</span><span class="p">(</span><span class="n">FDS</span><span class="p">,</span> <span class="n">DD</span><span class="p">,</span> <span class="p">[</span><span class="n">block_hup</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">killed</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">killed</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># Worker doesn&#39;t die</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>         <span class="c1"># Worker dies now</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.DocTestWorker.read_messages">
<code class="descname">read_messages</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker.read_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>In the master process, read from the pipe and store the data
read in the <code class="docutils literal notranslate"><span class="pre">messages</span></code> attribute.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This function may need to be called multiple times in
order to read all of the messages.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestWorker</span><span class="p">,</span> <span class="n">DocTestTask</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;util.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">nthreads</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span> <span class="o">=</span> <span class="n">DocTestWorker</span><span class="p">(</span><span class="n">FDS</span><span class="p">,</span> <span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">while</span> <span class="n">W</span><span class="o">.</span><span class="n">rmessages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="go">....:     W.read_messages()</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nb">len</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.DocTestWorker.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the <a class="reference internal" href="#sage.doctest.forker.DocTestTask" title="sage.doctest.forker.DocTestTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocTestTask</span></code></a> under its own PGID.</p>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.DocTestWorker.save_result_output">
<code class="descname">save_result_output</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker.save_result_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Annotate <code class="docutils literal notranslate"><span class="pre">self</span></code> with <code class="docutils literal notranslate"><span class="pre">self.result</span></code> (the result read through
the <code class="docutils literal notranslate"><span class="pre">result_queue</span></code> and with <code class="docutils literal notranslate"><span class="pre">self.output</span></code>, the complete
contents of <code class="docutils literal notranslate"><span class="pre">self.outtmpfile</span></code>. Then close the Queue and
<code class="docutils literal notranslate"><span class="pre">self.outtmpfile</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestWorker</span><span class="p">,</span> <span class="n">DocTestTask</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;util.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span> <span class="o">=</span> <span class="n">DocTestWorker</span><span class="p">(</span><span class="n">FDS</span><span class="p">,</span> <span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">save_result_output</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;cputime&#39;, &#39;err&#39;, &#39;failures&#39;, &#39;optionals&#39;, &#39;tests&#39;, &#39;walltime&#39;, &#39;walltime_skips&#39;]</span>
<span class="gp">sage: </span><span class="nb">len</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method is called from the parent process, not from the
subprocess.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.DocTestWorker.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the worker and close the writing end of the message pipe.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="sage.doctest.forker.SageDocTestRunner">
<em class="property">class </em><code class="descclassname">sage.doctest.forker.</code><code class="descname">SageDocTestRunner</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTestRunner" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTestRunner</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A customized version of DocTestRunner that tracks dependencies
of doctests.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">stdout</span></code> – an open file to restore for debugging</li>
<li><code class="docutils literal notranslate"><span class="pre">checker</span></code> – None, or an instance of
<a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.OutputChecker" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.OutputChecker</span></code></a></li>
<li><code class="docutils literal notranslate"><span class="pre">verbose</span></code> – boolean, determines whether verbose printing
is enabled.</li>
<li><code class="docutils literal notranslate"><span class="pre">optionflags</span></code> – Controls the comparison with the expected
output.  See <code class="xref py py-mod docutils literal notranslate"><span class="pre">testmod</span></code> for more information.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span>
<span class="go">&lt;sage.doctest.forker.SageDocTestRunner object at ...&gt;</span>
</pre></div>
</div>
<dl class="method">
<dt id="sage.doctest.forker.SageDocTestRunner.compile_and_execute">
<code class="descname">compile_and_execute</code><span class="sig-paren">(</span><em>example</em>, <em>compiler</em>, <em>globs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.compile_and_execute" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the given example, recording dependencies.</p>
<p>Rather than using a basic dictionary, Sage’s doctest runner
uses a <a class="reference internal" href="util.html#sage.doctest.util.RecordingDict" title="sage.doctest.util.RecordingDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.doctest.util.RecordingDict</span></code></a>, which records
every time a value is set or retrieved.  Executing the given
code with this recording dictionary as the namespace allows
Sage to track dependencies between doctest lines.  For
example, in the following two lines</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>the recording dictionary records that the second line depends
on the first since the first INSERTS <code class="docutils literal notranslate"><span class="pre">x</span></code> into the global
namespace and the second line RETRIEVES <code class="docutils literal notranslate"><span class="pre">x</span></code> from the global
namespace.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance.</li>
<li><code class="docutils literal notranslate"><span class="pre">compiler</span></code> – a callable that, applied to example,
produces a code object</li>
<li><code class="docutils literal notranslate"><span class="pre">globs</span></code> – a dictionary in which to execute the code.</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>the output of the compiled code snippet.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.util</span> <span class="kn">import</span> <span class="n">RecordingDict</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">hashlib</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">running_doctest_digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">globs</span> <span class="o">=</span> <span class="n">RecordingDict</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="s1">&#39;doctest_var&#39;</span> <span class="ow">in</span> <span class="n">globs</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="n">globs</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ex0</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">compiler</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ex</span><span class="p">:</span> <span class="nb">compile</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;&lt;doctest sage.doctest.forker[0]&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="mi">32768</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">compile_and_execute</span><span class="p">(</span><span class="n">ex0</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">globs</span><span class="p">)</span>
<span class="go">1764</span>
<span class="gp">sage: </span><span class="n">globs</span><span class="p">[</span><span class="s1">&#39;doctest_var&#39;</span><span class="p">]</span>
<span class="go">42</span>
<span class="gp">sage: </span><span class="n">globs</span><span class="o">.</span><span class="n">set</span>
<span class="go">{&#39;doctest_var&#39;}</span>
<span class="gp">sage: </span><span class="n">globs</span><span class="o">.</span><span class="n">got</span>
<span class="go">{&#39;Integer&#39;}</span>
</pre></div>
</div>
<p>Now we can execute some more doctests to see the dependencies.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">ex1</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">compiler</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ex</span><span class="p">:</span><span class="nb">compile</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;&lt;doctest sage.doctest.forker[1]&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="mi">32768</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">compile_and_execute</span><span class="p">(</span><span class="n">ex1</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">globs</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">globs</span><span class="o">.</span><span class="n">set</span><span class="p">))</span>
<span class="go">[&#39;R&#39;, &#39;a&#39;]</span>
<span class="gp">sage: </span><span class="n">globs</span><span class="o">.</span><span class="n">got</span>
<span class="go">{&#39;ZZ&#39;}</span>
<span class="gp">sage: </span><span class="n">ex1</span><span class="o">.</span><span class="n">predecessors</span>
<span class="go">[]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">ex2</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">compiler</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ex</span><span class="p">:</span><span class="nb">compile</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;&lt;doctest sage.doctest.forker[2]&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="mi">32768</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">compile_and_execute</span><span class="p">(</span><span class="n">ex2</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">globs</span><span class="p">)</span>
<span class="go">a + 42</span>
<span class="gp">sage: </span><span class="nb">list</span><span class="p">(</span><span class="n">globs</span><span class="o">.</span><span class="n">set</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">globs</span><span class="o">.</span><span class="n">got</span><span class="p">))</span>
<span class="go">[&#39;a&#39;, &#39;doctest_var&#39;]</span>
<span class="gp">sage: </span><span class="nb">set</span><span class="p">(</span><span class="n">ex2</span><span class="o">.</span><span class="n">predecessors</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="n">ex0</span><span class="p">,</span><span class="n">ex1</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageDocTestRunner.report_failure">
<code class="descname">report_failure</code><span class="sig-paren">(</span><em>out</em>, <em>test</em>, <em>example</em>, <em>got</em>, <em>globs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.report_failure" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when a doctest fails.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for printing</li>
<li><code class="docutils literal notranslate"><span class="pre">test</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a> instance</li>
<li><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance in <code class="docutils literal notranslate"><span class="pre">test</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">got</span></code> – a string, the result of running <code class="docutils literal notranslate"><span class="pre">example</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">globs</span></code> – a dictionary of globals, used if in debugging mode</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>prints a report to <code class="docutils literal notranslate"><span class="pre">out</span></code></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">ex</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">no_failure_yet</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">report_failure</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;BAD ANSWER</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;.../sage/doctest/forker.py&quot;, line 11, in sage.doctest.forker</span>
<span class="go">Failed example:</span>
<span class="go">    doctest_var = 42; doctest_var^2</span>
<span class="go">Expected:</span>
<span class="go">    1764</span>
<span class="go">Got:</span>
<span class="go">    BAD ANSWER</span>
</pre></div>
</div>
<p>If debugging is turned on this function starts an IPython
prompt when a test returns an incorrect answer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SAGE_PEXPECT_LOG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;import doctest, sys, os, multiprocessing, subprocess&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;from sage.doctest.parsing import SageOutputChecker&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;import sage.doctest.forker as sdf&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;from sage.doctest.control import DocTestDefaults&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DD = DocTestDefaults(debug=True)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;ex1 = doctest.Example(&#39;a = 17&#39;, &#39;&#39;)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;ex2 = doctest.Example(&#39;2*a&#39;, &#39;1&#39;)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DT = doctest.DocTest([ex1,ex2], globals(), &#39;doubling&#39;, None, 0, None)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DTR = sdf.SageDocTestRunner(SageOutputChecker(), verbose=False, sage_options=DD, optionflags=doctest.NORMALIZE_WHITESPACE|doctest.ELLIPSIS)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;sdf.init_sage(); DTR.run(DT, clear_globs=False)&quot;</span><span class="p">))</span> <span class="c1"># indirect doctest</span>
<span class="go">**********************************************************************</span>
<span class="go">Line 1, in doubling</span>
<span class="go">Failed example:</span>
<span class="go">    2*a</span>
<span class="go">Expected:</span>
<span class="go">    1</span>
<span class="go">Got:</span>
<span class="go">    34</span>
<span class="go">**********************************************************************</span>
<span class="go">Previously executed commands:</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">_expect</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;sage: &#39;</span><span class="p">)</span>   <span class="c1"># sage0 just mis-identified the output as prompt, synchronize</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="go">&#39;...17&#39;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;quit&quot;</span><span class="p">)</span>
<span class="go">&#39;Returning to doctests...TestResults(failed=1, attempted=2)&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageDocTestRunner.report_overtime">
<code class="descname">report_overtime</code><span class="sig-paren">(</span><em>out</em>, <em>test</em>, <em>example</em>, <em>got</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.report_overtime" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when the <code class="docutils literal notranslate"><span class="pre">warn_long</span></code> option flag is set and a doctest
runs longer than the specified time.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for printing</li>
<li><code class="docutils literal notranslate"><span class="pre">test</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a> instance</li>
<li><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance in <code class="docutils literal notranslate"><span class="pre">test</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">got</span></code> – a string, the result of running <code class="docutils literal notranslate"><span class="pre">example</span></code></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>prints a report to <code class="docutils literal notranslate"><span class="pre">out</span></code></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.misc</span> <span class="kn">import</span> <span class="n">walltime</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">ex</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">ex</span><span class="o">.</span><span class="n">walltime</span> <span class="o">=</span> <span class="mf">1.23</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">report_overtime</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;BAD ANSWER</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;.../sage/doctest/forker.py&quot;, line 11, in sage.doctest.forker</span>
<span class="go">Warning, slow doctest:</span>
<span class="go">    doctest_var = 42; doctest_var^2</span>
<span class="go">Test ran for 1.23 s</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageDocTestRunner.report_start">
<code class="descname">report_start</code><span class="sig-paren">(</span><em>out</em>, <em>test</em>, <em>example</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.report_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when an example starts.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for printing</li>
<li><code class="docutils literal notranslate"><span class="pre">test</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a> instance</li>
<li><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance in <code class="docutils literal notranslate"><span class="pre">test</span></code></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>prints a report to <code class="docutils literal notranslate"><span class="pre">out</span></code></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">ex</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">report_start</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">)</span>
<span class="go">Trying (line 11):    doctest_var = 42; doctest_var^2</span>
<span class="go">Expecting:</span>
<span class="go">    1764</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageDocTestRunner.report_success">
<code class="descname">report_success</code><span class="sig-paren">(</span><em>out</em>, <em>test</em>, <em>example</em>, <em>got</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.report_success" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when an example succeeds.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for printing</li>
<li><code class="docutils literal notranslate"><span class="pre">test</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a> instance</li>
<li><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance in <code class="docutils literal notranslate"><span class="pre">test</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">got</span></code> – a string, the result of running <code class="docutils literal notranslate"><span class="pre">example</span></code></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>prints a report to <code class="docutils literal notranslate"><span class="pre">out</span></code></li>
<li>if in debugging mode, starts an IPython prompt at the point
of the failure</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.misc</span> <span class="kn">import</span> <span class="n">walltime</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">ex</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">ex</span><span class="o">.</span><span class="n">walltime</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">report_success</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;1764&#39;</span><span class="p">)</span>
<span class="go">ok [0.00 s]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageDocTestRunner.report_unexpected_exception">
<code class="descname">report_unexpected_exception</code><span class="sig-paren">(</span><em>out</em>, <em>test</em>, <em>example</em>, <em>exc_info</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.report_unexpected_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when a doctest raises an exception that’s not matched by the expected output.</p>
<p>If debugging has been turned on, starts an interactive debugger.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for printing</li>
<li><code class="docutils literal notranslate"><span class="pre">test</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a> instance</li>
<li><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance in <code class="docutils literal notranslate"><span class="pre">test</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">exc_info</span></code> – the result of <code class="docutils literal notranslate"><span class="pre">sys.exc_info()</span></code></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>prints a report to <code class="docutils literal notranslate"><span class="pre">out</span></code></li>
<li>if in debugging mode, starts PDB with the given traceback</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SAGE_PEXPECT_LOG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;import doctest, sys, os, multiprocessing, subprocess&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;from sage.doctest.parsing import SageOutputChecker&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;import sage.doctest.forker as sdf&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;from sage.doctest.control import DocTestDefaults&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DD = DocTestDefaults(debug=True)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;ex = doctest.Example(&#39;E = EllipticCurve([0,0]); E&#39;, &#39;A singular Elliptic Curve&#39;)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DT = doctest.DocTest([ex], globals(), &#39;singular_curve&#39;, None, 0, None)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DTR = sdf.SageDocTestRunner(SageOutputChecker(), verbose=False, sage_options=DD, optionflags=doctest.NORMALIZE_WHITESPACE|doctest.ELLIPSIS)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">old_prompt</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">_prompt</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">_prompt</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\(Pdb\) &quot;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DTR.run(DT, clear_globs=False)&quot;</span><span class="p">)</span> <span class="c1"># indirect doctest</span>
<span class="go">&#39;... ArithmeticError(&quot;invariants &quot; + str(ainvs) + &quot; define a singular curve&quot;)&#39;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">)</span>
<span class="go">&#39;...if self.discriminant() == 0:...raise ArithmeticError...&#39;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">)</span>
<span class="go">&#39;...EllipticCurve_field.__init__(self, K, ainvs)&#39;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;p ainvs&quot;</span><span class="p">)</span>
<span class="go">&#39;(0, 0, 0, 0, 0)&#39;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">_prompt</span> <span class="o">=</span> <span class="n">old_prompt</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;quit&quot;</span><span class="p">)</span>
<span class="go">&#39;TestResults(failed=1, attempted=1)&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageDocTestRunner.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>test</em>, <em>compileflags=None</em>, <em>out=None</em>, <em>clear_globs=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the examples in a given doctest.</p>
<p>This function replaces <code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTestRunner.run</span></code>
since it needs to handle spoofing. It also leaves the display
hook in place.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">test</span></code> – an instance of <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a></li>
<li><code class="docutils literal notranslate"><span class="pre">compileflags</span></code> – the set of compiler flags used to
execute examples (passed in to the <a class="reference external" href="https://docs.python.org/library/functions.html#compile" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">compile()</span></code></a>).  If
None, they are filled in from the result of
<code class="xref py py-func docutils literal notranslate"><span class="pre">doctest._extract_future_flags()</span></code> applied to
<code class="docutils literal notranslate"><span class="pre">test.globs</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for writing the output (defaults to
<code class="xref py py-func docutils literal notranslate"><span class="pre">sys.stdout.write()</span></code>).</li>
<li><code class="docutils literal notranslate"><span class="pre">clear_globs</span></code> – boolean (default True): whether to clear
the namespace after running this doctest.</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">f</span></code> – integer, the number of examples that failed</li>
<li><code class="docutils literal notranslate"><span class="pre">t</span></code> – the number of examples tried</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">clear_globs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">TestResults(failed=0, attempted=4)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageDocTestRunner.summarize">
<code class="descname">summarize</code><span class="sig-paren">(</span><em>verbose=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.summarize" title="Permalink to this definition">¶</a></dt>
<dd><p>Print results of testing to <code class="docutils literal notranslate"><span class="pre">self.msgfile</span></code> and return number
of failures and tests run.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">verbose</span></code> – whether to print lots of stuff</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>returns <code class="docutils literal notranslate"><span class="pre">(f,</span> <span class="pre">t)</span></code>, a <code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.TestResults</span></code> instance
giving the number of failures and the total number of tests
run.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">_name2ft</span><span class="p">[</span><span class="s1">&#39;sage.doctest.forker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">results</span> <span class="o">=</span> <span class="n">DTR</span><span class="o">.</span><span class="n">summarize</span><span class="p">()</span>
<span class="go">**********************************************************************</span>
<span class="go">1 item had failures:</span>
<span class="go">    1 of 120 in sage.doctest.forker</span>
<span class="gp">sage: </span><span class="n">results</span>
<span class="go">TestResults(failed=1, attempted=120)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageDocTestRunner.update_digests">
<code class="descname">update_digests</code><span class="sig-paren">(</span><em>example</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.update_digests" title="Permalink to this definition">¶</a></dt>
<dd><p>Update global and doctest digests.</p>
<p>Sage’s doctest runner tracks the state of doctests so that
their dependencies are known.  For example, in the following
two lines</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>it records that the second line depends on the first since the
first INSERTS <code class="docutils literal notranslate"><span class="pre">x</span></code> into the global namespace and the second
line RETRIEVES <code class="docutils literal notranslate"><span class="pre">x</span></code> from the global namespace.</p>
<p>This function updates the hashes that record these
dependencies.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">hashlib</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">running_global_digest</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<span class="go">&#39;d41d8cd98f00b204e9800998ecf8427e&#39;</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">running_doctest_digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">ex</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">ex</span><span class="o">.</span><span class="n">predecessors</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">update_digests</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">running_global_digest</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<span class="go">&#39;3cb44104292c3a3ab4da3112ce5dc35c&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageDocTestRunner.update_results">
<code class="descname">update_results</code><span class="sig-paren">(</span><em>D</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.update_results" title="Permalink to this definition">¶</a></dt>
<dd><p>When returning results we pick out the results of interest
since many attributes are not pickleable.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">D</span></code> – a dictionary to update with cputime and walltime</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>the number of failures (or False if there is no failure attribute)</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span><span class="p">,</span> <span class="n">DictAsObject</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.util</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="gp">sage: </span><span class="n">T</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">TestResults(failed=0, attempted=4)</span>
<span class="gp">sage: </span><span class="n">T</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">DTR</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">D</span> <span class="o">=</span> <span class="n">DictAsObject</span><span class="p">({</span><span class="s1">&#39;cputime&#39;</span><span class="p">:[],</span><span class="s1">&#39;walltime&#39;</span><span class="p">:[],</span><span class="s1">&#39;err&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">})</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">update_results</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="go">[(&#39;cputime&#39;, [...]), (&#39;err&#39;, None), (&#39;failures&#39;, 0), (&#39;tests&#39;, 4), (&#39;walltime&#39;, [...]), (&#39;walltime_skips&#39;, 0)]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="sage.doctest.forker.SageSpoofInOut">
<em class="property">class </em><code class="descclassname">sage.doctest.forker.</code><code class="descname">SageSpoofInOut</code><span class="sig-paren">(</span><em>outfile=None</em>, <em>infile=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageSpoofInOut" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="../../../structure/sage/structure/sage_object.html#sage.structure.sage_object.SageObject" title="(in Sage Reference Manual: Parents and Elements v8.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.structure.sage_object.SageObject</span></code></a></p>
<p>We replace the standard <code class="xref py py-class docutils literal notranslate"><span class="pre">doctest._SpoofOut</span></code> for three reasons:</p>
<ul class="simple">
<li>we need to divert the output of C programs that don’t print
through sys.stdout,</li>
<li>we want the ability to recover partial output from doctest
processes that segfault.</li>
<li>we also redirect stdin (usually from /dev/null) during doctests.</li>
</ul>
<p>This class defines streams <code class="docutils literal notranslate"><span class="pre">self.real_stdin</span></code>, <code class="docutils literal notranslate"><span class="pre">self.real_stdout</span></code>
and <code class="docutils literal notranslate"><span class="pre">self.real_stderr</span></code> which refer to the original streams.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">outfile</span></code> – (default: <code class="docutils literal notranslate"><span class="pre">tempfile.TemporaryFile()</span></code>) a seekable open file
object to which stdout and stderr should be redirected.</li>
<li><code class="docutils literal notranslate"><span class="pre">infile</span></code> – (default: <code class="docutils literal notranslate"><span class="pre">open(os.devnull)</span></code>) an open file object
from which stdin should be redirected.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">tempfile</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageSpoofInOut</span>
<span class="gp">sage: </span><span class="n">O</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="go">....:     S.start_spoofing()</span>
<span class="go">....:     print(&quot;hello world&quot;)</span>
<span class="go">....: finally:</span>
<span class="go">....:     S.stop_spoofing()</span>
<span class="go">....:</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="go">&#39;hello world\n&#39;</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">infile</span><span class="o">=</span><span class="n">O</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="go">....:     S.start_spoofing()</span>
<span class="go">....:     _ = subprocess.check_call(&quot;cat&quot;)</span>
<span class="go">....: finally:</span>
<span class="go">....:     S.stop_spoofing()</span>
<span class="go">....:</span>
<span class="go">hello world</span>
<span class="gp">sage: </span><span class="n">O</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="sage.doctest.forker.SageSpoofInOut.getvalue">
<code class="descname">getvalue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageSpoofInOut.getvalue" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the value that has been printed to <code class="docutils literal notranslate"><span class="pre">outfile</span></code> since the
last time this function was called.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageSpoofInOut</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="go">....:     S.start_spoofing()</span>
<span class="go">....:     print(&quot;step 1&quot;)</span>
<span class="go">....: finally:</span>
<span class="go">....:     S.stop_spoofing()</span>
<span class="go">....:</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="go">&#39;step 1\n&#39;</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="go">....:     S.start_spoofing()</span>
<span class="go">....:     print(&quot;step 2&quot;)</span>
<span class="go">....: finally:</span>
<span class="go">....:     S.stop_spoofing()</span>
<span class="go">....:</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="go">&#39;step 2\n&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageSpoofInOut.start_spoofing">
<code class="descname">start_spoofing</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageSpoofInOut.start_spoofing" title="Permalink to this definition">¶</a></dt>
<dd><p>Set stdin to read from <code class="docutils literal notranslate"><span class="pre">self.infile</span></code> and stdout to print to
<code class="docutils literal notranslate"><span class="pre">self.outfile</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">tempfile</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageSpoofInOut</span>
<span class="gp">sage: </span><span class="n">O</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="go">....:     S.start_spoofing()</span>
<span class="go">....:     print(&quot;this is not printed&quot;)</span>
<span class="go">....: finally:</span>
<span class="go">....:     S.stop_spoofing()</span>
<span class="go">....:</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="go">&#39;this is not printed\n&#39;</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="n">O</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="go">....:     S.start_spoofing()</span>
<span class="go">....:     v = sys.stdin.read()</span>
<span class="go">....: finally:</span>
<span class="go">....:     S.stop_spoofing()</span>
<span class="go">....:</span>
<span class="gp">sage: </span><span class="n">v</span>
<span class="go">&#39;this is not printed\n&#39;</span>
</pre></div>
</div>
<p>We also catch non-Python output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="go">....:     S.start_spoofing()</span>
<span class="go">....:     retval = os.system(&#39;&#39;&#39;echo &quot;Hello there&quot;\nif [ $? -eq 0 ]; then\necho &quot;good&quot;\nfi&#39;&#39;&#39;)</span>
<span class="go">....: finally:</span>
<span class="go">....:     S.stop_spoofing()</span>
<span class="go">....:</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="go">&#39;Hello there\ngood\n&#39;</span>
<span class="gp">sage: </span><span class="n">O</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.doctest.forker.SageSpoofInOut.stop_spoofing">
<code class="descname">stop_spoofing</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageSpoofInOut.stop_spoofing" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset stdin and stdout to their original values.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageSpoofInOut</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="go">....:     S.start_spoofing()</span>
<span class="go">....:     print(&quot;this is not printed&quot;)</span>
<span class="go">....: finally:</span>
<span class="go">....:     S.stop_spoofing()</span>
<span class="go">....:</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;this is now printed&quot;</span><span class="p">)</span>
<span class="go">this is now printed</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="sage.doctest.forker.TestResults">
<em class="property">class </em><code class="descclassname">sage.doctest.forker.</code><code class="descname">TestResults</code><a class="headerlink" href="#sage.doctest.forker.TestResults" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/library/functions.html#tuple" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a></p>
<dl class="attribute">
<dt id="sage.doctest.forker.TestResults.attempted">
<code class="descname">attempted</code><a class="headerlink" href="#sage.doctest.forker.TestResults.attempted" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="sage.doctest.forker.TestResults.failed">
<code class="descname">failed</code><a class="headerlink" href="#sage.doctest.forker.TestResults.failed" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="sage.doctest.forker.dummy_handler">
<code class="descclassname">sage.doctest.forker.</code><code class="descname">dummy_handler</code><span class="sig-paren">(</span><em>sig</em>, <em>frame</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.dummy_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Dummy signal handler for SIGCHLD (just to ensure the signal
isn’t ignored).</p>
</dd></dl>

<dl class="function">
<dt id="sage.doctest.forker.init_sage">
<code class="descclassname">sage.doctest.forker.</code><code class="descname">init_sage</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.init_sage" title="Permalink to this definition">¶</a></dt>
<dd><p>Import the Sage library.</p>
<p>This function is called once at the beginning of a doctest run
(rather than once for each file).  It imports the Sage library,
sets DOCTEST_MODE to True, and invalidates any interfaces.</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">init_sage</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">DOCTEST_MODE</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">sage: </span><span class="n">init_sage</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">DOCTEST_MODE</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Check that pexpect interfaces are invalidated, but still work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">gap</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;my_test_var := 42;&quot;</span><span class="p">)</span>
<span class="go">&#39;42&#39;</span>
<span class="gp">sage: </span><span class="n">gap</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;my_test_var;&quot;</span><span class="p">)</span>
<span class="go">&#39;42&#39;</span>
<span class="gp">sage: </span><span class="n">init_sage</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">gap</span><span class="p">(</span><span class="s1">&#39;Group((1,2,3)(4,5), (3,4))&#39;</span><span class="p">)</span>
<span class="go">Group( [ (1,2,3)(4,5), (3,4) ] )</span>
<span class="gp">sage: </span><span class="n">gap</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;my_test_var;&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">RuntimeError</span>: <span class="n">Gap produced error output...</span>
</pre></div>
</div>
<p>Check that SymPy equation pretty printer is limited in doctest
mode to default width (80 chars):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">sympify</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sympy.printing.pretty.pretty</span> <span class="kn">import</span> <span class="n">PrettyPrinter</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="s1">&#39;+x^&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)))</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;wrap_line&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">})</span><span class="o">.</span><span class="n">doprint</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="go"> 29    28    27    26    25    24    23    22    21    20    19    18    17</span>
<span class="go">x   + x   + x   + x   + x   + x   + x   + x   + x   + x   + x   + x   + x   +</span>

<span class="go"> 16    15    14    13    12    11    10    9    8    7    6    5    4    3</span>
<span class="go">x   + x   + x   + x   + x   + x   + x   + x  + x  + x  + x  + x  + x  + x  + x</span>

<span class="go">2</span>
<span class="go">  + x</span>
</pre></div>
</div>
<p>The displayhook sorts dictionary keys to simplify doctesting of
dictionary output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span> <span class="s1">&#39;au&#39;</span><span class="p">:</span><span class="mi">56</span><span class="p">,</span> <span class="s1">&#39;bbf&#39;</span><span class="p">:</span><span class="mi">234</span><span class="p">,</span> <span class="s1">&#39;aaa&#39;</span><span class="p">:</span><span class="mi">234</span><span class="p">}</span>
<span class="go">{&#39;a&#39;: 23, &#39;aaa&#39;: 234, &#39;au&#39;: 56, &#39;b&#39;: 34, &#39;bbf&#39;: 234}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.doctest.forker.showwarning_with_traceback">
<code class="descclassname">sage.doctest.forker.</code><code class="descname">showwarning_with_traceback</code><span class="sig-paren">(</span><em>message</em>, <em>category</em>, <em>filename</em>, <em>lineno</em>, <em>file=None</em>, <em>line=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.showwarning_with_traceback" title="Permalink to this definition">¶</a></dt>
<dd><p>Displays a warning message with a traceback.</p>
<p>INPUT: see <a class="reference external" href="https://docs.python.org/library/warnings.html#warnings.showwarning" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">warnings.showwarning()</span></code></a>.</p>
<p>OUTPUT: None</p>
<p>EXAMPLES:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">showwarning_with_traceback</span>
<span class="gp">sage: </span><span class="n">showwarning_with_traceback</span><span class="p">(</span><span class="s2">&quot;bad stuff&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="s2">&quot;myfile.py&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">doctest:warning</span>
<span class="go">  ...</span>
<span class="go">  File &quot;&lt;doctest sage.doctest.forker.showwarning_with_traceback[1]&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">    showwarning_with_traceback(&quot;bad stuff&quot;, UserWarning, &quot;myfile.py&quot;, Integer(0))</span>
<span class="go">:</span>
<span class="go">UserWarning: bad stuff</span>
</pre></div>
</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="sources.html"
                        title="previous chapter">Classes for sources of doctests</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="parsing.html"
                        title="next chapter">Parsing docstrings</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/sage/doctest/forker.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="parsing.html" title="Parsing docstrings"
             >next</a> |</li>
        <li class="right" >
          <a href="sources.html" title="Classes for sources of doctests"
             >previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Sage&#39;s Doctesting Framework</a> &#187;</li>
 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005--2019, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>