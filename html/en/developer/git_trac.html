
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=600, initial-scale=1">
    <title>Collaborative Development with Git-Trac &#8212; Sage Developer&#39;s Guide v9.0</title>
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Git the Hard Way" href="manual_git.html" />
    <link rel="prev" title="Sage Development Process" href="walk_through.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />
    <script src="_static/thebe.js" type="text/javascript"></script>
    <script src="_static/thebe-sage.js" type="text/javascript"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="manual_git.html" title="Git the Hard Way"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="walk_through.html" title="Sage Development Process"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="index.html">Developer&#39;s Guide v9.0</a> &#187;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="collaborative-development-with-git-trac">
<span id="chapter-git-trac"></span><h1>Collaborative Development with Git-Trac<a class="headerlink" href="#collaborative-development-with-git-trac" title="Permalink to this headline">¶</a></h1>
<p>Sometimes you will only want to work on local changes to Sage, for
your own private needs.  However, typically it is beneficial to
share code and ideas with others; the manner in which the
<a class="reference external" href="https://www.sagemath.org">Sage project</a> does this (as well as fixing
bugs and upgrading components) is in a very collaborative and
public setting on <a class="reference external" href="https://trac.sagemath.org">the Sage Trac server</a>
(the Sage bug and enhancement tracker).</p>
<p>One can use <code class="docutils literal notranslate"><span class="pre">git</span></code> <a class="reference internal" href="manual_git.html#chapter-manual-git"><span class="std std-ref">the hard way</span></a> for this,
but this section explains how to use the helper <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span></code> command, which
simplifies many of the most common actions in collaboration on Sage. Some
of the <a class="reference internal" href="git_background.html#section-git-tutorials"><span class="std std-ref">tutorials</span></a> we suggest may be helpful
in navigating what they are for.</p>
<p>Most of the commands in the following section will not work unless
you have an account on Trac. If you want to contribute to Sage, it
is a good idea to get an account now (see <a class="reference internal" href="trac.html#section-trac-account"><span class="std std-ref">Obtaining an Account</span></a>).</p>
<div class="section" id="installing-the-git-trac-command">
<span id="section-git-trac-install"></span><h2>Installing the Git-Trac Command<a class="headerlink" href="#installing-the-git-trac-command" title="Permalink to this headline">¶</a></h2>
<p>Git is a separate project from trac, and the two do not know how to
talk to each other. To simplify the development, we have a special
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span></code> subcommand for the git suite. Note that this really is
only to simplify interaction with our trac issue management, you can
perform every development task with just git and a web browser. See
<a class="reference internal" href="manual_git.html#chapter-manual-git"><span class="std std-ref">Git the Hard Way</span></a> instead if you prefer to do everything by
hand:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost]$</span> git clone https://github.com/sagemath/git-trac-command.git
<span class="go">Cloning into &#39;git-trac-command&#39;...</span>
<span class="go">[...]</span>
<span class="go">Checking connectivity... done.</span>
<span class="gp">[user@localhost]$</span> <span class="nb">source</span> git-trac-command/enable.sh
<span class="go">Prepending the git-trac command to your search PATH</span>
</pre></div>
</div>
<p>This creates a directory <code class="docutils literal notranslate"><span class="pre">git-trac-command</span></code>.</p>
<p>Sourcing the <code class="docutils literal notranslate"><span class="pre">enable.sh</span></code> script in there is just a quick and dirty
way to enable it temporarily. For a more permanent installation on
your system later, make sure to put the <code class="docutils literal notranslate"><span class="pre">git-trac</span></code> command in your
<code class="docutils literal notranslate"><span class="pre">PATH</span></code>. Assuming that <code class="docutils literal notranslate"><span class="pre">~/bin</span></code> is already in your <code class="docutils literal notranslate"><span class="pre">PATH</span></code>, you can
do this by symlinking:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost]$</span> <span class="nb">echo</span> <span class="nv">$PATH</span>
<span class="go">/home/user/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin</span>
<span class="gp">[user@localhost]$</span> <span class="nb">cd</span> git-trac-command
<span class="gp">[user@localhost git-trac-command]$</span> ln -s <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/git-trac ~/bin/
</pre></div>
</div>
<p>See the <a class="reference external" href="https://github.com/sagemath/git-trac-command">git-trac README</a> for
more details. At this point you leave <code class="docutils literal notranslate"><span class="pre">git-trac-command</span></code> subdirectory, and only go
there whenever you need to update the <code class="docutils literal notranslate"><span class="pre">git-trac</span></code> command.</p>
</div>
<div class="section" id="git-and-trac-configuration">
<span id="section-git-trac-setup"></span><h2>Git and Trac Configuration<a class="headerlink" href="#git-and-trac-configuration" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference external" href="https://trac.sagemath.org">trac</a> uses username/password for
authentication.</li>
<li>Our <a class="reference external" href="https://git.sagemath.org">git repository server</a> uses SSH
public key authentication for write access.</li>
</ul>
</div>
<p>You need to set up both authentication mechanisms to be able to upload
your changes with “git trac”. For read-only access neither
authentication mechanism is needed. To set up <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span></code>, first go
to the Sage directory and tell <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span></code> about your trac account:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost sage]$</span> git trac config --user USERNAME --pass <span class="s1">&#39;PASSWORD&#39;</span>
<span class="go">Trac xmlrpc URL:</span>
<span class="go">    https://trac.sagemath.org/xmlrpc (anonymous)</span>
<span class="go">    https://trac.sagemath.org/login/xmlrpc (authenticated)</span>
<span class="go">    realm sage.math.washington.edu</span>
<span class="go">Username: USERNAME</span>
<span class="go">Password: PASSWORD</span>
<span class="go">Retrieving SSH keys...</span>
<span class="go">    1024 ab:1b:7c:c9:9b:48:fe:dd:59:56:1e:9d:a4:a6:51:9d  My SSH Key</span>
</pre></div>
</div>
<p>where you have to replace USERNAME with your trac user name and
PASSWORD with your trac password. If you don’t have a trac account,
use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">config</span></code> without any arguments. The single quotes in
<code class="docutils literal notranslate"><span class="pre">'PASSWORD'</span></code> escape special characters that you might have in your
password. The password is stored in plain-text in <code class="docutils literal notranslate"><span class="pre">.git/config</span></code>, so
make sure that it is not readable by other users on your system. For
example, by running <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">0600</span> <span class="pre">.git/config</span></code> if your home directory
is not already private.</p>
<p>Instead of a username and password you may also configure authentication via
a generated token by passing <code class="docutils literal notranslate"><span class="pre">--token=&lt;token&gt;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">--pass</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost sage]$</span> git trac config --user<span class="o">=</span>&lt;username&gt; --token<span class="o">=</span>&lt;token&gt;
</pre></div>
</div>
<p>This is required if you authenticate to Trac with your GitHub account, as
you do not have a Trac password.  Logged in users can find their token
under <a class="reference external" href="https://trac.sagemath.org/prefs/token">the token tab in preferences on the trac site</a> .</p>
<p>If both a token and a username/password are configured, the token-based
authentication takes precedence.</p>
<p>If you do not want to store your trac username/password/token on disk you
can temporarily override it with the environment variables
<code class="docutils literal notranslate"><span class="pre">TRAC_USERNAME</span></code>,  <code class="docutils literal notranslate"><span class="pre">TRAC_PASSWORD</span></code>, and <code class="docutils literal notranslate"><span class="pre">TRAC_TOKEN</span></code> respectively.
These take precedence over any other configuration.</p>
<p>If there is no SSH key listed then you haven’t uploaded your SSH
public key to the trac server. You should do that now following the
instructions to <a class="reference internal" href="trac.html#section-trac-ssh-key"><span class="std std-ref">Linking your Public Key to your Trac Account</span></a>, if you want to upload
any changes. You may have to add your private key to your authentication agent:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost sage]$</span> ssh-add
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">config</span></code> command will automatically add a <code class="docutils literal notranslate"><span class="pre">trac</span></code>
remote git repository to your list of remotes if necessary.</p>
</div>
<p>If you followed the above instructions then you will have two remote
repositories set up:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost sage]$</span> git remote -v
<span class="go">origin      git://github.com/sagemath/sage.git (fetch)</span>
<span class="go">origin      git://github.com/sagemath/sage.git (push)</span>
<span class="go">trac        git://trac.sagemath.org/sage.git (fetch)</span>
<span class="go">trac        git@trac.sagemath.org:sage.git (push)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">git&#64;...</span></code> part of the push url means that write access is
secured with SSH keys, which you must have set up as in
<a class="reference internal" href="trac.html#section-trac-ssh-key"><span class="std std-ref">Linking your Public Key to your Trac Account</span></a>. Read-only access happens through the
fetch url and does not require SSH.</p>
<p>Finally, if you do not want to use the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span></code> subcommand at all
then you can set up the remote by hand as described in the section on
<a class="reference internal" href="manual_git.html#section-git-trac"><span class="std std-ref">The Trac Server</span></a>.</p>
</div>
<div class="section" id="trac-tickets-and-git-branches">
<h2>Trac Tickets and Git Branches<a class="headerlink" href="#trac-tickets-and-git-branches" title="Permalink to this headline">¶</a></h2>
<p>Now let’s start adding code to Sage!</p>
<div class="section" id="create-a-ticket">
<span id="section-git-trac-create"></span><h3>Create a Ticket<a class="headerlink" href="#create-a-ticket" title="Permalink to this headline">¶</a></h3>
<p>Suppose you have written an algorithm for calculating the last twin prime, and
want to add it to Sage. You would first open a ticket for that:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost sage]$</span> git trac create <span class="s1">&#39;Last Twin Prime&#39;</span>
<span class="go">Remote branch: u/user/last_twin_prime</span>
<span class="go">Newly-created ticket number: 12345</span>
<span class="go">Ticket URL: https://trac.sagemath.org/12345</span>
<span class="go">Local branch: t/12345/last_twin_prime</span>
</pre></div>
</div>
<p>This will create a new trac ticket titled “Last Twin Prime” with a
<em>remote branch</em> <code class="docutils literal notranslate"><span class="pre">u/user/last_twin_prime</span></code> attached to it. The remote
branch name is automatically derived from the ticket title; If you
don’t like this then you can use the <code class="docutils literal notranslate"><span class="pre">-b</span></code> switch to specify it
explicitly. See <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">create</span> <span class="pre">-h</span></code> for details. This new branch is
automatically checked out for you with the <em>local branch</em> name
<code class="docutils literal notranslate"><span class="pre">t/12345/last_twin_prime</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only some trac fields are filled in automatically. See
<a class="reference internal" href="trac.html#section-trac-fields"><span class="std std-ref">The Ticket Fields</span></a> for what trac fields are available and
how we use them.</p>
</div>
</div>
<div class="section" id="check-out-an-existing-ticket">
<span id="section-git-trac-checkout"></span><h3>Check out an Existing Ticket<a class="headerlink" href="#check-out-an-existing-ticket" title="Permalink to this headline">¶</a></h3>
<p>Alternatively, you can use the <a class="reference external" href="https://trac.sagemath.org">web interface to the Sage trac
development server</a> to open a new ticket.
Just log in and click on “Create Ticket”.</p>
<p>Or maybe somebody else already opened a ticket. Then, to get a suitable
local branch to make your edits, you would just run:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost sage]$</span> git trac checkout <span class="m">12345</span>
<span class="go">Loading ticket #12345...</span>
<span class="go">Checking out Trac #13744 remote branch u/user/last_twin_prime -&gt; local branch t/12345/last_twin_prime...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">checkout</span></code> command downloads an existing branch (as
specified in the “Branch:” field on the trac ticket) or creates a new
one if there is none yet. Just like the create command, you can
specify the remote branch name explicitly using the <code class="docutils literal notranslate"><span class="pre">-b</span></code> switch if
you want.</p>
</div>
<div class="section" id="note-on-branch-names">
<span id="section-git-trac-branch-names"></span><h3>Note on Branch Names<a class="headerlink" href="#note-on-branch-names" title="Permalink to this headline">¶</a></h3>
<p>The “Branch:” field of a trac ticket (see <a class="reference internal" href="trac.html#section-trac-fields"><span class="std std-ref">The Ticket Fields</span></a>) indicates
the git branch containing its code. Our git server implements the following
access restrictions for <strong>remote branch names</strong>:</p>
<ul class="simple">
<li>You can read/write/create a branch named
<code class="docutils literal notranslate"><span class="pre">u/your_username/whatever_you_like</span></code>. Everybody else can read.</li>
<li>Everybody can read/write/create a branch named <code class="docutils literal notranslate"><span class="pre">public/whatever_you_like</span></code>.</li>
</ul>
<p>Depending on your style of collaboration, you can use one or the
other. The <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span></code> subcommands defaults to the former.</p>
<p>As a convention, the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span></code> subcommand uses <strong>local branch
names</strong> of the form <code class="docutils literal notranslate"><span class="pre">t/12345/description</span></code>, where the number is the
trac ticket number. The script uses this number to figure out the
ticket from the local branch name. You can rename the local branches
if you want, but if they don’t contain the ticket number then you will
have to specify the ticket number manually when you are uploading your
changes.</p>
</div>
<div class="section" id="making-changes">
<span id="section-git-trac-editing"></span><h3>Making Changes<a class="headerlink" href="#making-changes" title="Permalink to this headline">¶</a></h3>
<p>Once you have checked out a ticket, edit the appropriate files and
commit your changes to the branch as described in
<a class="reference internal" href="walk_through.html#section-walkthrough-add-edit"><span class="std std-ref">Editing the Source Code</span></a> and
<a class="reference internal" href="walk_through.html#section-walkthrough-commit"><span class="std std-ref">Commits (Snapshots)</span></a>.</p>
</div>
</div>
<div class="section" id="uploading-changes-to-trac">
<span id="section-git-trac-push"></span><h2>Uploading Changes to Trac<a class="headerlink" href="#uploading-changes-to-trac" title="Permalink to this headline">¶</a></h2>
<div class="section" id="automatic-push">
<span id="section-git-trac-push-auto"></span><h3>Automatic Push<a class="headerlink" href="#automatic-push" title="Permalink to this headline">¶</a></h3>
<p>At some point, you may wish to share your changes with the rest of us:
maybe it is ready for review, or maybe you are collaborating with
someone and want to share your changes “up until now”. This is simply
done by:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost sage]$</span> git trac push
<span class="go">Pushing to Trac #12345...</span>
<span class="go">Guessed remote branch: u/user/last_twin_prime</span>

<span class="go">To git@trac.sagemath.org:sage.git</span>
<span class="go"> * [new branch]      HEAD -&gt; u/user/last_twin_prime</span>

<span class="go">Changing the trac &quot;Branch:&quot; field...</span>
</pre></div>
</div>
<p>This uploads your changes to a remote branch on the <a class="reference external" href="https://git.sagemath.org/sage.git">Sage git server</a>. The <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span></code> command uses
the following logic to find out the remote branch name:</p>
<ul class="simple">
<li>By default, the remote branch name will be whatever is already on
the trac ticket.</li>
<li>If there is no remote branch yet, the branch will be called
<code class="docutils literal notranslate"><span class="pre">u/user/description</span></code> (<code class="docutils literal notranslate"><span class="pre">u/user/last_twin_prime</span></code> in the example).</li>
<li>You can use the <code class="docutils literal notranslate"><span class="pre">--branch</span></code> option to specify the remote branch
name explicitly, but it needs to follow the naming convention from
<a class="reference internal" href="#section-git-trac-branch-names"><span class="std std-ref">Note on Branch Names</span></a> for you to have write
permission.</li>
</ul>
</div>
<div class="section" id="specifying-the-ticket-number">
<span id="section-git-trac-push-with-ticket-number"></span><h3>Specifying the Ticket Number<a class="headerlink" href="#specifying-the-ticket-number" title="Permalink to this headline">¶</a></h3>
<p>You can upload any local branch to an existing ticket, whether or not
you created the local branch with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span></code>. This works exactly
like in the case where you started with a ticket, except that you have
to specify the ticket number (since there is no way to tell which
ticket you have in mind). That is:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost sage]$</span> git trac push TICKETNUM
</pre></div>
</div>
<p>where you have to replace <code class="docutils literal notranslate"><span class="pre">TICKETNUM</span></code> with the number of the trac
ticket.</p>
</div>
<div class="section" id="finishing-it-up">
<span id="section-git-trac-push-finish"></span><h3>Finishing It Up<a class="headerlink" href="#finishing-it-up" title="Permalink to this headline">¶</a></h3>
<p>It is common to go through a few iterations of commits before you
upload, and you will probably also have pushed your changes a few
times before your changes are ready for review.</p>
<p>Once you are happy with the changes you uploaded, they must be
reviewed by somebody else before they can be included in the next
version of Sage. To mark your ticket as ready for review, you should
set it to <code class="docutils literal notranslate"><span class="pre">needs_review</span></code> on the trac server. Also, add yourself as
the (or one of the) author(s) for that ticket by inserting the
following as the first line:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Authors: Your Real Name
</pre></div>
</div>
</div>
</div>
<div class="section" id="downloading-changes-from-trac">
<span id="section-git-trac-pull"></span><h2>Downloading Changes from Trac<a class="headerlink" href="#downloading-changes-from-trac" title="Permalink to this headline">¶</a></h2>
<p>If somebody else worked on a ticket, or if you just switched
computers, you’ll want to get the latest version of the branch from a
ticket into your local branch. This is done with:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost sage]$</span> git trac pull
</pre></div>
</div>
<p>Technically, this does a <em>merge</em> (just like the standard <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span></code>)
command. See <a class="reference internal" href="manual_git.html#section-git-merge"><span class="std std-ref">Merging and Rebasing</span></a> for more background information.</p>
</div>
<div class="section" id="merging">
<span id="section-git-trac-merge"></span><h2>Merging<a class="headerlink" href="#merging" title="Permalink to this headline">¶</a></h2>
<p>As soon as you are working on a bigger project that spans multiple
tickets you will want to base your work on branches that have not been
merged into Sage yet. This is natural in collaborative development,
and in fact you are very much encouraged to split your work into
logically different parts. Ideally, each part that is useful on its
own and can be reviewed independently should be a different ticket
instead of a huge patch bomb.</p>
<p>For this purpose, you can incorporate branches from other tickets (or
just other local branches) into your current branch. This is called
merging, and all it does is include commits from other branches into
your current branch. In particular, this is done when a new Sage
release is made: the finished tickets are merged with the Sage master
and the result is the next Sage version. Git is smart enough to not
merge commits twice. In particular, it is possible to merge two
branches, one of which had already merged the other branch. The syntax
for merging is easy:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@localhost sage]$</span> git merge other_branch
</pre></div>
</div>
<p>This creates a new “merge” commit, joining your current branch and
<code class="docutils literal notranslate"><span class="pre">other_branch</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>You should avoid merging branches both ways. Once A merged B and B
merged A, there is no way to distinguish commits that were
originally made in A or B. Effectively, merging both ways combines
the branches and makes individual review impossible.</p>
<p>In practice, you should only merge when one of the following holds:</p>
<ul class="last simple">
<li>Either two tickets conflict, then you have to merge one into the
other in order to resolve the merge conflict.</li>
<li>Or you definitely need a feature that has been developed as part
of another branch.</li>
</ul>
</div>
<p>A special case of merging is merging in the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch. This
brings your local branch up to date with the newest Sage version. The
above warning against unnecessary merges still applies, though. Try to
do all of your development with the Sage version that you originally
started with. The only reason for merging in the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch is if
you need a new feature or if your branch conflicts. See
<a class="reference internal" href="advanced_git.html#section-git-update-latest"><span class="std std-ref">Update Branch to Latest SageMath Version (and Minimizing Recompilation Time)</span></a> for details.</p>
</div>
<div class="section" id="collaboration-and-conflict-resolution">
<span id="section-git-trac-collaborate"></span><h2>Collaboration and conflict resolution<a class="headerlink" href="#collaboration-and-conflict-resolution" title="Permalink to this headline">¶</a></h2>
<div class="section" id="exchanging-branches">
<h3>Exchanging Branches<a class="headerlink" href="#exchanging-branches" title="Permalink to this headline">¶</a></h3>
<p>It is very easy to collaborate by just going through the above steps
any number of times. For example, Alice starts a ticket and adds some
initial code:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[alice@laptop sage]$</span> git trac create <span class="s2">&quot;A and B Ticket&quot;</span>
<span class="go">... EDIT EDIT ...</span>
<span class="gp">[alice@laptop sage]$</span> git add .
<span class="gp">[alice@laptop sage]$</span> git commit
<span class="gp">[alice@laptop sage]$</span> git trac push
</pre></div>
</div>
<p>The trac ticket now has “Branch:” set to
<code class="docutils literal notranslate"><span class="pre">u/alice/a_and_b_ticket</span></code>. Bob downloads the branch and works some
more on it:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[bob@home sage]$</span> git trac checkout TICKET_NUMBER
<span class="go">... EDIT EDIT ...</span>
<span class="gp">[bob@home sage]$</span> git add .
<span class="gp">[bob@home sage]$</span> git commit
<span class="gp">[bob@home sage]$</span> git trac push
</pre></div>
</div>
<p>The trac ticket now has “Branch:” set to <code class="docutils literal notranslate"><span class="pre">u/bob/a_and_b_ticket</span></code>,
since Bob cannot write to <code class="docutils literal notranslate"><span class="pre">u/alice/...</span></code>. Now the two authors just
pull/push in their collaboration:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[alice@laptop sage]$</span> git trac pull
<span class="go">... EDIT EDIT ...</span>
<span class="gp">[alice@laptop sage]$</span> git add .
<span class="gp">[alice@laptop sage]$</span> git commit
<span class="gp">[alice@laptop sage]$</span> git trac push

<span class="gp">[bob@home sage]$</span> git trac pull
<span class="go">... EDIT EDIT ...</span>
<span class="gp">[bob@home sage]$</span> git add .
<span class="gp">[bob@home sage]$</span> git commit
<span class="gp">[bob@home sage]$</span> git trac push
</pre></div>
</div>
<p>Alice and Bob need not alternate, they can also add further commits on
top of their own remote branch.  As long as their changes do not
conflict (edit the same lines simultaneously), this is fine.</p>
</div>
<div class="section" id="conflict-resolution">
<span id="section-git-trac-conflict"></span><h3>Conflict Resolution<a class="headerlink" href="#conflict-resolution" title="Permalink to this headline">¶</a></h3>
<p>Merge conflicts happen if there are overlapping edits, and they are an
unavoidable consequence of distributed development. Fortunately,
resolving them is common and easy with git. As a hypothetical example,
consider the following code snippet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the `i`-th Fibonacci number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>This is clearly wrong; Two developers, namely Alice and Bob, decide to
fix it. First, in a cabin in the woods far away from any internet
connection, Alice corrects the seed values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Return the `i`-th Fibonacci number</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
       <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
   <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
<p>and turns those changes into a new commit:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[alice@laptop sage]$</span> git add fibonacci.py
<span class="gp">[alice@laptop sage]$</span> git commit -m <span class="s1">&#39;return correct seed values&#39;</span>
</pre></div>
</div>
<p>However, not having an internet connection, she cannot immediately
send her changes to the trac server. Meanwhile, Bob changes the
multiplication to an addition since that is the correct recursion
formula:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the `i`-th Fibonacci number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>and immediately uploads his change:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[bob@home sage]$</span> git add fibonacci.py
<span class="gp">[bob@home sage]$</span> git commit -m <span class="s1">&#39;corrected recursion formula, must be + instead of *&#39;</span>
<span class="gp">[bob@home sage]$</span> git trac push
</pre></div>
</div>
<p>Eventually, Alice returns to civilization. In her mailbox, she finds a
trac notification email that Bob has uploaded further changes to their
joint project. Hence, she starts out by getting his changes into her
own local branch:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[alice@laptop sage]$</span> git trac pull
<span class="go">...</span>
<span class="go">CONFLICT (content): Merge conflict in fibonacci.py</span>
<span class="go">Automatic merge failed; fix conflicts and then commit the result.</span>
</pre></div>
</div>
<p>The file now looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the `i`-th Fibonacci number</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span> <span class="n">HEAD</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
<span class="o">=======</span>
    <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span> <span class="mi">41675</span><span class="n">dfaedbfb89dcff0a47e520be4aa2b6c5d1b</span>
</pre></div>
</div>
<p>The conflict is shown between the conflict markers <code class="docutils literal notranslate"><span class="pre">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></code>. The first half (up to the <code class="docutils literal notranslate"><span class="pre">=======</span></code> marker) is Alice’s
current version, the second half is Bob’s version. The 40-digit hex
number after the second conflict marker is the SHA1 hash of the most
recent common parent of both.</p>
<p>It is now Alice’s job to resolve the conflict by reconciling their
changes, for example by editing the file. Her result is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the `i`-th Fibonacci number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
<p>And then upload both her original change <em>and</em> her merge commit to trac:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[alice@laptop sage]$</span> git add fibonacci.py
<span class="gp">[alice@laptop sage]$</span> git commit -m <span class="s2">&quot;merged Bob&#39;s changes with mine&quot;</span>
</pre></div>
</div>
<p>The resulting commit graph now has a loop:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[alice@laptop sage]$</span> git log --graph --oneline
<span class="go">*   6316447 merged Bob&#39;s changes with mine</span>
<span class="go">|\</span>
<span class="go">| * 41675df corrected recursion formula, must be + instead of *</span>
<span class="go">* | 14ae1d3 return correct seed values</span>
<span class="go">|/</span>
<span class="go">* 14afe53 initial commit</span>
</pre></div>
</div>
<p>If Bob decides to do further work on the ticket then he will have to
pull Alice’s changes. However, this time there is no conflict on his
end: git downloads both Alice’s conflicting commit and her resolution.</p>
</div>
</div>
<div class="section" id="reviewing">
<span id="section-git-trac-review"></span><h2>Reviewing<a class="headerlink" href="#reviewing" title="Permalink to this headline">¶</a></h2>
<p>For an explanation of what should be checked by the reviewer, see
<a class="reference internal" href="reviewer_checklist.html#chapter-review"><span class="std std-ref">The reviewer’s check list</span></a>.</p>
<p>If you go to the <a class="reference external" href="https://trac.sagemath.org">web interface to the Sage trac development server</a> then you can click on the “Branch:” field and see
the code that is added by combining all commits of the ticket. This is what
needs to be reviewed.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span></code> command gives you two commands that might be handy
(replace <code class="docutils literal notranslate"><span class="pre">12345</span></code> with the actual ticket number) if you do not want
to use the web interface:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">print</span> <span class="pre">12345</span></code> displays the trac ticket directly in your
terminal.</li>
<li><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">review</span> <span class="pre">12345</span></code> downloads the branch from the ticket and
shows you what is being added, analogous to clicking on the
“Branch:” field.</li>
</ul>
<p>To review tickets with minimal recompiling, start by building the “develop”
branch, that is, the latest beta. Just checking out an older ticket would most
likely reset the Sage tree to an older version, so you would have to compile
older versions of packages to make it work. Instead, you can create an anonymous
(“detached HEAD”) merge of the ticket and the develop branch using</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git trac try <span class="m">12345</span>
</pre></div>
</div>
<p>This will only touch files that are really modified by the ticket. In particular,
if only Python files are changed by the ticket (which is true for most tickets)
then you just have to run <code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-b</span></code> to rebuild the Sage library. If files other
than Python have been changed, you must run <code class="docutils literal notranslate"><span class="pre">make</span></code>. When you are finished
reviewing, just check out a named branch, for example</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git checkout develop
</pre></div>
</div>
<p>If you want to edit the ticket branch (that is, add additional commits) you cannot
use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">try</span></code>. You must <a class="reference internal" href="#section-git-trac-checkout"><span class="std std-ref">Check out an Existing Ticket</span></a> to get the actual ticket
branch as a starting point.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Collaborative Development with Git-Trac</a><ul>
<li><a class="reference internal" href="#installing-the-git-trac-command">Installing the Git-Trac Command</a></li>
<li><a class="reference internal" href="#git-and-trac-configuration">Git and Trac Configuration</a></li>
<li><a class="reference internal" href="#trac-tickets-and-git-branches">Trac Tickets and Git Branches</a><ul>
<li><a class="reference internal" href="#create-a-ticket">Create a Ticket</a></li>
<li><a class="reference internal" href="#check-out-an-existing-ticket">Check out an Existing Ticket</a></li>
<li><a class="reference internal" href="#note-on-branch-names">Note on Branch Names</a></li>
<li><a class="reference internal" href="#making-changes">Making Changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uploading-changes-to-trac">Uploading Changes to Trac</a><ul>
<li><a class="reference internal" href="#automatic-push">Automatic Push</a></li>
<li><a class="reference internal" href="#specifying-the-ticket-number">Specifying the Ticket Number</a></li>
<li><a class="reference internal" href="#finishing-it-up">Finishing It Up</a></li>
</ul>
</li>
<li><a class="reference internal" href="#downloading-changes-from-trac">Downloading Changes from Trac</a></li>
<li><a class="reference internal" href="#merging">Merging</a></li>
<li><a class="reference internal" href="#collaboration-and-conflict-resolution">Collaboration and conflict resolution</a><ul>
<li><a class="reference internal" href="#exchanging-branches">Exchanging Branches</a></li>
<li><a class="reference internal" href="#conflict-resolution">Conflict Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reviewing">Reviewing</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="walk_through.html"
                        title="previous chapter">Sage Development Process</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="manual_git.html"
                        title="next chapter">Git the Hard Way</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/git_trac.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="manual_git.html" title="Git the Hard Way"
             >next</a> |</li>
        <li class="right" >
          <a href="walk_through.html" title="Sage Development Process"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="index.html">Developer&#39;s Guide v9.0</a> &#187;</li>
 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005--2020, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>