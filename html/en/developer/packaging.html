
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=600, initial-scale=1">
    <title>Packaging Third-Party Code &#8212; Sage Developer&#39;s Guide v8.4</title>
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Packaging Old-Style SPKGs" href="packaging_old_spkgs.html" />
    <link rel="prev" title="Using External Libraries and Interfaces" href="coding_in_other.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />
    <script src="_static/thebe.js" type="text/javascript"></script>
    <script src="_static/thebe-sage.js" type="text/javascript"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="packaging_old_spkgs.html" title="Packaging Old-Style SPKGs"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="coding_in_other.html" title="Using External Libraries and Interfaces"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="index.html">Developer&#39;s Guide v8.4</a> &#187;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="packaging-third-party-code">
<span id="chapter-packaging"></span><h1>Packaging Third-Party Code<a class="headerlink" href="#packaging-third-party-code" title="Permalink to this headline">¶</a></h1>
<p>One of the mottoes of the Sage project is to not reinvent the wheel: If
an algorithm is already implemented in a well-tested library then
consider incorporating that library into Sage. The current list of
available packages are the subdirectories of <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/build/pkgs/</span></code>.
The installation of packages is done through a bash script located in
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/build/bin/sage-spkg</span></code>. This script is typically invoked by
giving the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[user@localhost]$ sage -i &lt;options&gt; &lt;package name&gt;...
</pre></div>
</div>
<p>options can be:</p>
<ul class="simple">
<li>-f: install a package even if the same version is already installed</li>
<li>-s: do not delete temporary build directory</li>
<li>-c: after installing, run the test suite for the spkg. This should
override the settings of <code class="docutils literal notranslate"><span class="pre">SAGE_CHECK</span></code> and <code class="docutils literal notranslate"><span class="pre">SAGE_CHECK_PACKAGES</span></code>.</li>
<li>-d: only download the package</li>
</ul>
<p>The section <a class="reference internal" href="#section-directory-structure"><span class="std std-ref">Directory Structure</span></a> describes the structure
of each individual package in <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/build/pkgs</span></code>. In section
<a class="reference internal" href="#section-manual-build"><span class="std std-ref">Building the package</span></a> we see how you can install and test a new
spkg that you or someone else wrote. Finally,
<a class="reference internal" href="#section-inclusion-procedure"><span class="std std-ref">Inclusion Procedure for New and Updated Packages</span></a> explains how to submit a new package
for inclusion in the Sage source code.</p>
<div class="section" id="package-types">
<span id="section-package-types"></span><h2>Package types<a class="headerlink" href="#package-types" title="Permalink to this headline">¶</a></h2>
<p>Not all packages are built by default, they are divided into standard,
optional and experimental ones:</p>
<ul class="simple">
<li><strong>standard</strong> packages are built by default. For a few packages,
<code class="docutils literal notranslate"><span class="pre">configure</span></code> checks whether they are available from the system,
in which case the build of those packages is skipped.
Standard packages have stringent quality requirements:
they should work on all supported platforms. In order
for a new standard package to be accepted, it should have been
optional for a while, see <a class="reference internal" href="#section-inclusion-procedure"><span class="std std-ref">Inclusion Procedure for New and Updated Packages</span></a>.</li>
<li><strong>optional</strong> packages are subject to the same requirements, they
should also work on all supported platforms. If there are
<a class="reference internal" href="doctesting.html#section-optional-doctest-flag"><span class="std std-ref">optional doctests</span></a> in the Sage
library, those tests must pass.
Note that optional packages are not tested as much as standard
packages, so in practice they might break more often than standard
packages.</li>
<li>for <strong>experimental</strong> packages, the bar is much lower: even if there are
some problems, the package can still be accepted.</li>
</ul>
</div>
<div class="section" id="directory-structure">
<span id="section-directory-structure"></span><h2>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<p>Third-party packages in Sage consist of two parts:</p>
<ol class="arabic simple">
<li>The tarball as it is distributed by the third party, or as close as
possible. Valid reasons for modifying the tarball are deleting
unnecessary files to keep the download size manageable,
regenerating auto-generated files or changing the directory structure
if necessary. In certain cases, you may need to (additionally) change
the filename of the tarball.
In any case, the actual code must be unmodified: if you need to
change the sources, add a <a class="reference internal" href="#section-spkg-patching"><span class="std std-ref">patch</span></a>
instead. See also <a class="reference internal" href="#section-spkg-src"><span class="std std-ref">Modified Tarballs</span></a> for automating the
modifications to the upstream tarball.</li>
<li>The build scripts and associated files are in a subdirectory
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/build/pkgs/&lt;package&gt;</span></code>, where you replace <code class="docutils literal notranslate"><span class="pre">&lt;package&gt;</span></code>
with a lower-case version of the upstream project name. If the
project name contains characters which are not alphanumeric
and are not an underscore, those characters should be removed
or replaced by an underscore. For example, the project
<code class="docutils literal notranslate"><span class="pre">FFLAS-FFPACK</span></code> is called <code class="docutils literal notranslate"><span class="pre">fflas_ffpack</span></code> in Sage and <code class="docutils literal notranslate"><span class="pre">path.py</span></code>
is renamed <code class="docutils literal notranslate"><span class="pre">pathpy</span></code> in Sage.</li>
</ol>
<p>As an example, let us consider a hypothetical FoO project. They
(upstream) distribute a tarball <code class="docutils literal notranslate"><span class="pre">FoO-1.3.tar.gz</span></code> (that will be
automatically placed in <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/upstream</span></code> during the installation
process). To package it in Sage, we create a subdirectory containing as
a minimum the following files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SAGE_ROOT/build/pkgs/foo
|-- checksums.ini
|-- dependencies
|-- package-version.txt
|-- spkg-install
|-- SPKG.txt
`-- type
</pre></div>
</div>
<p>The following are some additional files which can be added:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SAGE_ROOT/build/pkgs/foo
|-- patches
|   |-- bar.patch
|   `-- baz.patch
|-- spkg-check
`-- spkg-src
</pre></div>
</div>
<p>We discuss the individual files in the following sections.</p>
<div class="section" id="package-type">
<h3>Package type<a class="headerlink" href="#package-type" title="Permalink to this headline">¶</a></h3>
<p>The file <code class="docutils literal notranslate"><span class="pre">type</span></code> should contain a single word, which is either
<code class="docutils literal notranslate"><span class="pre">standard</span></code>, <code class="docutils literal notranslate"><span class="pre">optional</span></code> or <code class="docutils literal notranslate"><span class="pre">experimental</span></code>.
See <a class="reference internal" href="#section-package-types"><span class="std std-ref">Package types</span></a> for the meaning of these types.</p>
</div>
<div class="section" id="build-and-install-scripts">
<span id="section-spkg-install"></span><h3>Build and install scripts<a class="headerlink" href="#build-and-install-scripts" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">spkg-build</span></code> and <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> files are <code class="docutils literal notranslate"><span class="pre">bash</span></code> scripts that
build and/or install the package.  If no <code class="docutils literal notranslate"><span class="pre">spkg-build</span></code> exists, then the
<code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> is responsible for both steps, though separating them is
encouraged where possible.</p>
<p>It is also possible to include a similar script named <code class="docutils literal notranslate"><span class="pre">spkg-postinst</span></code> to run
additional steps after the package has been installed into <code class="docutils literal notranslate"><span class="pre">$SAGE_LOCAL</span></code>. It
is encouraged to put such steps in a separate <code class="docutils literal notranslate"><span class="pre">spkg-postinst</span></code> script rather
than combinging them with <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code>.  This is because since
<a class="reference external" href="https://trac.sagemath.org/24106">trac ticket #24106</a>, <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> does not necessarily install packages directly
to <code class="docutils literal notranslate"><span class="pre">$SAGE_LOCAL</span></code>.  However, by the time <code class="docutils literal notranslate"><span class="pre">spkg-postinst</span></code> is run, the
installation to <code class="docutils literal notranslate"><span class="pre">$SAGE_LOCAL</span></code> is complete.</p>
<p>These scripts should <em>not</em> be prefixed with a shebang line (<code class="docutils literal notranslate"><span class="pre">#!...</span></code>) and
should not have the executable bit set in their permissions.  These are
added automatically, along with some additional boilerplate, when the
package is installed.  The <code class="docutils literal notranslate"><span class="pre">spkg-build</span></code> and <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> files in the
Sage source tree need only focus on the specific steps for building and
installing that package.</p>
<p>In the best case, the upstream project can simply be installed by the
usual configure / make / make install steps. In that case, the build
script would simply consist of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd src

./configure --prefix=&quot;$SAGE_LOCAL&quot; --libdir=&quot;$SAGE_LOCAL/lib&quot;
if [ $? -ne 0 ]; then
    echo &gt;&amp;2 &quot;Error configuring PACKAGE_NAME.&quot;
    exit 1
fi

$MAKE
if [ $? -ne 0 ]; then
    echo &gt;&amp;2 &quot;Error building PACKAGE_NAME.&quot;
    exit 1
fi
</pre></div>
</div>
<p>The install script would consist of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd src
$MAKE install
if [ $? -ne 0 ]; then
    echo &gt;&amp;2 &quot;Error installing PACKAGE_NAME.&quot;
    exit 1
fi
</pre></div>
</div>
<p>Note that the top-level directory inside the tarball is renamed to
<code class="docutils literal notranslate"><span class="pre">src</span></code> before calling the <code class="docutils literal notranslate"><span class="pre">spkg-build</span></code> and <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code>
scripts, so you can just use <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">src</span></code> instead of <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">foo-1.3</span></code>.</p>
<p>If there is any meaningful documentation included but not installed by
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code>, then you can add something like the following to
install it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if [ &quot;$SAGE_SPKG_INSTALL_DOCS&quot; = yes ] ; then
    $MAKE doc
    if [ $? -ne 0 ]; then
        echo &gt;&amp;2 &quot;Error building PACKAGE_NAME docs.&quot;
        exit 1
    fi
    mkdir -p &quot;$SAGE_SHARE/doc/PACKAGE_NAME&quot;
    cp -R doc/* &quot;$SAGE_SHARE/doc/PACKAGE_NAME&quot;
fi
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Prior to Sage 8.1 the shebang line was included, and the scripts were
marked executable.  However, this is no longer the case as of
<a class="reference external" href="https://trac.sagemath.org/23179">trac ticket #23179</a>.  Now the scripts in the source tree are deliberately
written not to be directly executed, and are only made into executable
scripts when they are copied to the package’s build directory.</p>
<p>Build/install scripts may still be written in Python, but the Python
code should go in a separate file (e.g. <code class="docutils literal notranslate"><span class="pre">spkg-install.py</span></code>), and can
then be executed from the real <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> like:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span> <span class="n">sage</span><span class="o">-</span><span class="n">python23</span> <span class="n">spkg</span><span class="o">-</span><span class="n">install</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<p>Many packages currently do not separate the build and install steps and only
provide a <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> file that does both.  The separation is useful in
particular for root-owned install hierarchies, where something like <code class="docutils literal notranslate"><span class="pre">sudo</span></code>
must be used to install files.  For this purpose Sage uses an environment
variable <code class="docutils literal notranslate"><span class="pre">$SAGE_SUDO</span></code>, the value of which may be provided by the developer
at build time,  which should to the appropriate system-specific
<code class="docutils literal notranslate"><span class="pre">sudo</span></code>-like command (if any).  The following rules are then observed:</p>
<ul class="simple">
<li>If <code class="docutils literal notranslate"><span class="pre">spkg-build</span></code> exists, it is first called, followed by
<code class="docutils literal notranslate"><span class="pre">$SAGE_SUDO</span> <span class="pre">spkg-install</span></code>.</li>
<li>Otherwise, only <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> is called (without <code class="docutils literal notranslate"><span class="pre">$SAGE_SUDO</span></code>).  Such
packages should prefix all commands in <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> that write into
the installation hierarchy with <code class="docutils literal notranslate"><span class="pre">$SAGE_SUDO</span></code>.</li>
</ul>
</div>
<div class="section" id="self-tests">
<span id="section-spkg-check"></span><h3>Self-Tests<a class="headerlink" href="#self-tests" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">spkg-check</span></code> file is an optional, but highly recommended, script to
run self-tests of the package.  The format for the <code class="docutils literal notranslate"><span class="pre">spkg-check</span></code> is the
same as <code class="docutils literal notranslate"><span class="pre">spkg-build</span></code> and <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code>.  It is run after building and
installing if the <code class="docutils literal notranslate"><span class="pre">SAGE_CHECK</span></code> environment variable is set, see the Sage
installation guide. Ideally, upstream has some sort of tests suite that can
be run with the standard <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">check</span></code> target. In that case, the
<code class="docutils literal notranslate"><span class="pre">spkg-check</span></code> script would simply contain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd src
$MAKE check
</pre></div>
</div>
</div>
<div class="section" id="python-based-packages">
<span id="section-python"></span><h3>Python-based packages<a class="headerlink" href="#python-based-packages" title="Permalink to this headline">¶</a></h3>
<p>The best way to install a Python-based package is to use pip, in which
case the <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> script might just consist of</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">src</span> <span class="o">&amp;&amp;</span> <span class="n">sdh_pip_install</span> <span class="o">.</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">sdh_pip_install</span></code> is a function provided by <code class="docutils literal notranslate"><span class="pre">sage-dist-helpers</span></code> that
points to the correct <code class="docutils literal notranslate"><span class="pre">pip</span></code> for the Python used by Sage, and includes some
default flags needed for correct installation into Sage.</p>
<p>If pip will not work but a command like <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code>
will, then the <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> script should call <code class="docutils literal notranslate"><span class="pre">sage-python23</span></code>
rather than <code class="docutils literal notranslate"><span class="pre">python</span></code>. This will ensure that the correct version of
Python is used to build and install the package. The same holds for
<code class="docutils literal notranslate"><span class="pre">spkg-check</span></code> scripts; for example, the <code class="docutils literal notranslate"><span class="pre">scipy</span></code> <code class="docutils literal notranslate"><span class="pre">spkg-check</span></code>
file contains the line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span> <span class="n">sage</span><span class="o">-</span><span class="n">python23</span> <span class="n">spkg</span><span class="o">-</span><span class="n">check</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="the-spkg-txt-file">
<span id="section-spkg-spkg-txt"></span><h3>The SPKG.txt File<a class="headerlink" href="#the-spkg-txt-file" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">SPKG.txt</span></code> file should follow this pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>= PACKAGE_NAME =

== Description ==

What does the package do?

== License ==

What is the license? If non-standard, is it GPLv3+ compatible?

== Upstream Contact ==

Provide information for upstream contact.

== Dependencies ==

Put a bulleted list of dependencies here:

* python
* readline

== Special Update/Build Instructions ==

If the tarball was modified by hand and not via a spkg-src
script, describe what was changed.
</pre></div>
</div>
<p>with <code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span></code> replaced by the package name. Legacy
<code class="docutils literal notranslate"><span class="pre">SPKG.txt</span></code> files have an additional changelog section, but this
information is now kept in the git repository.</p>
</div>
<div class="section" id="package-dependencies">
<span id="section-dependencies"></span><h3>Package dependencies<a class="headerlink" href="#package-dependencies" title="Permalink to this headline">¶</a></h3>
<p>Many packages depend on other packages. Consider for example the
<code class="docutils literal notranslate"><span class="pre">eclib</span></code> package for elliptic curves. This package uses the libraries
PARI, NTL and FLINT. So the following is the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> file
for <code class="docutils literal notranslate"><span class="pre">eclib</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pari</span> <span class="n">ntl</span> <span class="n">flint</span>

<span class="o">----------</span>
<span class="n">All</span> <span class="n">lines</span> <span class="n">of</span> <span class="n">this</span> <span class="n">file</span> <span class="n">are</span> <span class="n">ignored</span> <span class="k">except</span> <span class="n">the</span> <span class="n">first</span><span class="o">.</span>
<span class="n">It</span> <span class="ow">is</span> <span class="n">copied</span> <span class="n">by</span> <span class="n">SAGE_ROOT</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">make</span><span class="o">/</span><span class="n">install</span> <span class="n">into</span> <span class="n">SAGE_ROOT</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">make</span><span class="o">/</span><span class="n">Makefile</span><span class="o">.</span>
</pre></div>
</div>
<p>If there are no dependencies, you can use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># no dependencies</span>

<span class="o">----------</span>
<span class="n">All</span> <span class="n">lines</span> <span class="n">of</span> <span class="n">this</span> <span class="n">file</span> <span class="n">are</span> <span class="n">ignored</span> <span class="k">except</span> <span class="n">the</span> <span class="n">first</span><span class="o">.</span>
<span class="n">It</span> <span class="ow">is</span> <span class="n">copied</span> <span class="n">by</span> <span class="n">SAGE_ROOT</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">make</span><span class="o">/</span><span class="n">install</span> <span class="n">into</span> <span class="n">SAGE_ROOT</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">make</span><span class="o">/</span><span class="n">Makefile</span><span class="o">.</span>
</pre></div>
</div>
<p>There are actually two kinds of dependencies: there are normal
dependencies and order-only dependencies, which are weaker. The syntax
for the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> file is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normal</span> <span class="n">dependencies</span> <span class="o">|</span> <span class="n">order</span><span class="o">-</span><span class="n">only</span> <span class="n">dependencies</span>
</pre></div>
</div>
<p>If there is no <code class="docutils literal notranslate"><span class="pre">|</span></code>, then all dependencies are normal.</p>
<ul class="simple">
<li>If package A has an <strong>order-only dependency</strong> on B, it simply means
that B must be built before A can be built. The version of B does not
matter, only the fact that B is installed matters.
This should be used if the dependency is purely a build-time
dependency (for example, a dependency on pip simply because the
<code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> file uses pip).</li>
<li>If A has a <strong>normal dependency</strong> on B, it means additionally that A
should be rebuilt every time that B gets updated. This is the most
common kind of dependency. A normal dependency is what you need for
libraries: if we upgrade NTL, we should rebuild everything which
uses NTL.</li>
</ul>
<p>In order to check that the dependencies of your package are likely
correct, the following command should work without errors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[user@localhost]$ make distclean &amp;&amp; make base &amp;&amp; make PACKAGE_NAME
</pre></div>
</div>
<p>Finally, note that standard packages should only depend on standard
packages and optional packages should only depend on standard or
optional packages.</p>
</div>
<div class="section" id="patching-sources">
<span id="section-spkg-patching"></span><h3>Patching Sources<a class="headerlink" href="#patching-sources" title="Permalink to this headline">¶</a></h3>
<p>Actual changes to the source code must be via patches, which should be placed
in the <code class="docutils literal notranslate"><span class="pre">patches/</span></code> directory, and must have the <code class="docutils literal notranslate"><span class="pre">.patch</span></code> extension. GNU
patch is distributed with Sage, so you can rely on it being available. Patches
must include documentation in their header (before the first diff hunk), and
must have only one “prefix” level in the paths (that is, only one path level
above the root of the upstream sources being patched).  So a typical patch file
should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Add</span> <span class="n">autodoc_builtin_argspec</span> <span class="n">config</span> <span class="n">option</span>

<span class="n">Following</span> <span class="n">the</span> <span class="n">title</span> <span class="n">line</span> <span class="n">you</span> <span class="n">can</span> <span class="n">add</span> <span class="n">a</span> <span class="n">multi</span><span class="o">-</span><span class="n">line</span> <span class="n">description</span> <span class="n">of</span>
<span class="n">what</span> <span class="n">the</span> <span class="n">patch</span> <span class="n">does</span><span class="p">,</span> <span class="n">where</span> <span class="n">you</span> <span class="n">got</span> <span class="n">it</span> <span class="kn">from</span> <span class="nn">if</span> <span class="n">you</span> <span class="n">did</span> <span class="ow">not</span> <span class="n">write</span> <span class="n">it</span>
<span class="n">yourself</span><span class="p">,</span> <span class="k">if</span> <span class="n">they</span> <span class="n">are</span> <span class="n">platform</span> <span class="n">specific</span><span class="p">,</span> <span class="k">if</span> <span class="n">they</span> <span class="n">should</span> <span class="n">be</span> <span class="n">pushed</span>
<span class="n">upstream</span><span class="p">,</span> <span class="n">etc</span><span class="o">...</span>

<span class="n">diff</span> <span class="o">-</span><span class="n">dru</span> <span class="n">Sphinx</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">2</span><span class="o">/</span><span class="n">sphinx</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">autodoc</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">orig</span> <span class="n">Sphinx</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">2</span><span class="o">/</span><span class="n">sphinx</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">autodoc</span><span class="o">.</span><span class="n">py</span>
<span class="o">---</span> <span class="n">Sphinx</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">2</span><span class="o">/</span><span class="n">sphinx</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">autodoc</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">orig</span>  <span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span> <span class="mi">20</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mf">09.000000000</span> <span class="o">+</span><span class="mi">1300</span>
<span class="o">+++</span> <span class="n">Sphinx</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">2</span><span class="o">/</span><span class="n">sphinx</span><span class="o">/</span><span class="n">ext</span><span class="o">/</span><span class="n">autodoc</span><span class="o">.</span><span class="n">py</span>  <span class="mi">2014</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">19</span> <span class="mi">23</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">09.000000000</span> <span class="o">+</span><span class="mi">1300</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">1452</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">1462</span><span class="p">,</span><span class="mi">7</span> <span class="o">@@</span>

     <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;autoclass_content&#39;</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
     <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;autodoc_member_order&#39;</span><span class="p">,</span> <span class="s1">&#39;alphabetic&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="o">+</span>    <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;autodoc_builtin_argspec&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
     <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;autodoc_default_flags&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">True</span><span class="p">)</span>
     <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;autodoc_docstring_signature&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
     <span class="n">app</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="s1">&#39;autodoc-process-docstring&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Patches directly under the <code class="docutils literal notranslate"><span class="pre">patches/</span></code> directly are applied automatically
before running the <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> script (so long as they have the <code class="docutils literal notranslate"><span class="pre">.patch</span></code>
extension).  If you need to apply patches conditionally (such as only on
a specifically platform), you can place those patches in a subdirectory of
<code class="docutils literal notranslate"><span class="pre">patches/</span></code> and apply them manually using the <code class="docutils literal notranslate"><span class="pre">sage-apply-patches</span></code> script.
For example, considering the layout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SAGE_ROOT/build/pkgs/foo
|-- patches
|   |-- solaris
|   |   |-- solaris.patch
|   |-- bar.patch
|   `-- baz.patch
</pre></div>
</div>
<p>The patches <code class="docutils literal notranslate"><span class="pre">bar.patch</span></code> and <code class="docutils literal notranslate"><span class="pre">baz.patch</span></code> are applied to the unpacked
upstream sources in <code class="docutils literal notranslate"><span class="pre">src/</span></code> before running <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code>.  To conditionally
apply the patch for Solaris the <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> should contain a section like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if [ $UNAME == &quot;SunOS&quot; ]; then
    sage-apply-patches -d solaris
fi
</pre></div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">-d</span></code> flag applies all patches in the <code class="docutils literal notranslate"><span class="pre">solaris/</span></code> subdirectory of
the main <code class="docutils literal notranslate"><span class="pre">patches/</span></code> directory.</p>
</div>
<div class="section" id="when-to-patch-when-to-repackage-when-to-autoconfiscate">
<span id="section-spkg-patch-or-repackage"></span><h3>When to patch, when to repackage, when to autoconfiscate<a class="headerlink" href="#when-to-patch-when-to-repackage-when-to-autoconfiscate" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Use unpatched original upstream tarball when possible.</p>
<p>Sometimes it may seem as if you need to patch a (hand-written)
<code class="docutils literal notranslate"><span class="pre">Makefile</span></code> because it “hard-codes” some paths or compiler flags:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>--- a/Makefile
+++ b/Makefile
@@ -77,7 +77,7 @@
 # This is a Makefile.
 # Handwritten.

-DESTDIR = /usr/local
+DESTDIR = $(SAGE_ROOT)/local
 BINDIR   = $(DESTDIR)/bin
 INCDIR   = $(DESTDIR)/include
 LIBDIR   = $(DESTDIR)/lib
</pre></div>
</div>
<p>Don’t use patching for that.  Makefile variables can be overridden
from the command-line.  Just use the following in <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$(MAKE) DESTDIR=&quot;$SAGE_ROOT/local&quot;
</pre></div>
</div>
</li>
<li><p class="first">Check if Debian or another distribution already provides patches
for upstream.  Use them, don’t reinvent the wheel.</p>
</li>
<li><p class="first">If the upstream Makefile does not build shared libraries,
don’t bother trying to patch it.</p>
<p>Autoconfiscate the package instead and use the standard facilities
of Automake and Libtool.  This ensures that the shared library build
is portable between Linux and macOS.</p>
</li>
<li><p class="first">If you have to make changes to <code class="docutils literal notranslate"><span class="pre">configure.ac</span></code> or other source
files of the autotools build system (or if you are autoconfiscating
the package), then you can’t use patching; make a <a class="reference internal" href="#section-spkg-src"><span class="std std-ref">modified
tarball</span></a> instead.</p>
</li>
<li><p class="first">If the patch would be huge, don’t use patching.  Make a
<a class="reference internal" href="#section-spkg-src"><span class="std std-ref">modified tarball</span></a> instead.</p>
</li>
<li><p class="first">Otherwise, <a class="reference internal" href="#section-spkg-patch-maintenance"><span class="std std-ref">maintain a set of patches</span></a>.</p>
</li>
</ul>
</div>
<div class="section" id="how-to-maintain-a-set-of-patches">
<span id="section-spkg-patch-maintenance"></span><h3>How to maintain a set of patches<a class="headerlink" href="#how-to-maintain-a-set-of-patches" title="Permalink to this headline">¶</a></h3>
<p>We recommend the following workflow for maintaining a set of patches.</p>
<ul>
<li><p class="first">Fork the package and put it on a public git repository.</p>
<p>If upstream has a public version control repository, import it from
there.  If upstream does not have a public version control
repository, import the current sources from the upstream tarball.
Let’s call the branch <code class="docutils literal notranslate"><span class="pre">upstream</span></code>.</p>
</li>
<li><p class="first">Create a branch for the changes necessary for Sage, let’s call it
<code class="docutils literal notranslate"><span class="pre">sage_package_VERSION</span></code>, where <code class="docutils literal notranslate"><span class="pre">version</span></code> is the upstream version
number.</p>
</li>
<li><p class="first">Make the changes and commit them to the branch.</p>
</li>
<li><p class="first">Generate the patches against the <code class="docutils literal notranslate"><span class="pre">upstream</span></code> branch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">Rf</span> <span class="n">SAGE_ROOT</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">pkgs</span><span class="o">/</span><span class="n">PACKAGE</span><span class="o">/</span><span class="n">patches</span>
<span class="n">mkdir</span> <span class="n">SAGE_ROOT</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">pkgs</span><span class="o">/</span><span class="n">PACKAGE</span><span class="o">/</span><span class="n">patches</span>
<span class="n">git</span> <span class="nb">format</span><span class="o">-</span><span class="n">patch</span> <span class="o">-</span><span class="n">o</span> <span class="n">SAGE_ROOT</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">pkgs</span><span class="o">/</span><span class="n">PACKAGE</span><span class="o">/</span><span class="n">patches</span><span class="o">/</span> <span class="n">upstream</span>
</pre></div>
</div>
</li>
<li><p class="first">Optionally, create an <code class="docutils literal notranslate"><span class="pre">spkg-src</span></code> file in the Sage package’s
directory that regenerates the patch directory using the above
commmands.</p>
</li>
<li><p class="first">When a new upstream version becomes available, merge (or import) it
into <code class="docutils literal notranslate"><span class="pre">upstream</span></code>, then create a new branch and rebase in on top of
the updated upstream:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">checkout</span> <span class="n">sage_package_OLDVERSION</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="n">sage_package_NEWVERSION</span>
<span class="n">git</span> <span class="n">rebase</span> <span class="n">upstream</span>
</pre></div>
</div>
<p>Then regenerate the patches.</p>
</li>
</ul>
</div>
<div class="section" id="modified-tarballs">
<span id="section-spkg-src"></span><h3>Modified Tarballs<a class="headerlink" href="#modified-tarballs" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">spkg-src</span></code> file is optional and only to document how the upstream
tarball was changed. Ideally it is not modified, then there would be no
<code class="docutils literal notranslate"><span class="pre">spkg-src</span></code> file present either.</p>
<p>However, if you really must modify the upstream tarball then it is
recommended that you write a script, called <code class="docutils literal notranslate"><span class="pre">spkg-src</span></code>, that makes the
changes. This not only serves as documentation but also makes it easier
to apply the same modifications to future versions.</p>
</div>
<div class="section" id="package-versioning">
<span id="section-spkg-versioning"></span><h3>Package Versioning<a class="headerlink" href="#package-versioning" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">package-version.txt</span></code> file containts just the version. So if
upstream is <code class="docutils literal notranslate"><span class="pre">FoO-1.3.tar.gz</span></code> then the package version file would only
contain <code class="docutils literal notranslate"><span class="pre">1.3</span></code>.</p>
<p>If the upstream package is taken from some revision other than a stable
version or if upstream doesn’t have a version number, you should use the
date at which the revision is made. For example, the
<code class="docutils literal notranslate"><span class="pre">database_stein_watkins</span></code> package with version <code class="docutils literal notranslate"><span class="pre">20110713</span></code> contains
the database as of 2011-07-13. Note that the date should refer to the
<em>contents</em> of the tarball, not to the day it was packaged for Sage.
This particular Sage package for <code class="docutils literal notranslate"><span class="pre">database_stein_watkins</span></code> was created
in 2014, but the data it contains was last updated in 2011.</p>
<p>If you apply any patches, or if you made changes to the upstream tarball
(see <a class="reference internal" href="#section-directory-structure"><span class="std std-ref">Directory Structure</span></a> for allowable changes),
then you should append a <code class="docutils literal notranslate"><span class="pre">.p0</span></code> to the version to indicate that it’s
not a vanilla package.</p>
<p>Additionally, whenever you make changes to a package <em>without</em> changing
the upstream tarball (for example, you add an additional patch or you
fix something in the <code class="docutils literal notranslate"><span class="pre">spkg-install</span></code> file), you should also add or
increase the patch level. So the different versions would
be <code class="docutils literal notranslate"><span class="pre">1.3</span></code>, <code class="docutils literal notranslate"><span class="pre">1.3.p0</span></code>, <code class="docutils literal notranslate"><span class="pre">1.3.p1</span></code>, …
The change in version number or patch level will trigger
re-installation of the package, such that the changes are taken into
account.</p>
</div>
<div class="section" id="checksums">
<span id="section-spkg-checksums"></span><h3>Checksums<a class="headerlink" href="#checksums" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">checksums.ini</span></code> file contains the filename pattern of the
upstream tarball (without the actual version) and its checksums. So if
upstream is <code class="docutils literal notranslate"><span class="pre">$SAGE_ROOT/upstream/FoO-1.3.tar.gz</span></code>, create a new file
<code class="docutils literal notranslate"><span class="pre">$SAGE_ROOT/build/pkgs/foo/checksums.ini</span></code> containing only:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tarball</span><span class="o">=</span><span class="n">FoO</span><span class="o">-</span><span class="n">VERSION</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Sage internally replaces the <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> substring with the content of
<code class="docutils literal notranslate"><span class="pre">package-version.txt</span></code>. To recompute the checksums, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[user@localhost]$ sage --package fix-checksum foo
</pre></div>
</div>
<p>which will modify the <code class="docutils literal notranslate"><span class="pre">checksums.ini</span></code> file with the correct
checksums.</p>
</div>
</div>
<div class="section" id="utility-script-to-create-package">
<h2>Utility script to create package<a class="headerlink" href="#utility-script-to-create-package" title="Permalink to this headline">¶</a></h2>
<p>Assuming that you have downloaded
<code class="docutils literal notranslate"><span class="pre">$SAGE_ROOT/upstream/FoO-1.3.tar.gz</span></code>, you can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[user@localhost]$ sage --package create foo --version 1.3 --tarball FoO-VERSION.tar.gz --type experimental
</pre></div>
</div>
<p>to create <code class="docutils literal notranslate"><span class="pre">$SAGE_ROOT/build/pkgs/foo/package-version.txt</span></code>,
<code class="docutils literal notranslate"><span class="pre">checksums.ini</span></code>, and <code class="docutils literal notranslate"><span class="pre">type</span></code> in one step.</p>
</div>
<div class="section" id="building-the-package">
<span id="section-manual-build"></span><h2>Building the package<a class="headerlink" href="#building-the-package" title="Permalink to this headline">¶</a></h2>
<p>At this stage you have a new tarball that is not yet distributed with
Sage (<code class="docutils literal notranslate"><span class="pre">FoO-1.3.tar.gz</span></code> in the example of section
<a class="reference internal" href="#section-directory-structure"><span class="std std-ref">Directory Structure</span></a>). Now you need to manually place it
in the <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/upstream/</span></code> directory and run
<code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">--fix-pkg-checksums</span></code> if you have not done that yet.</p>
<p>Now you can install the package using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[user@localhost]$ sage -i package_name
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[user@localhost]$ sage -f package_name
</pre></div>
</div>
<p>to force a reinstallation. If your package contains a <code class="docutils literal notranslate"><span class="pre">spkg-check</span></code>
script (see <a class="reference internal" href="#section-spkg-check"><span class="std std-ref">Self-Tests</span></a>) it can be run with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[user@localhost]$ sage -i -c package_name
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[user@localhost]$ sage -f -c package_name
</pre></div>
</div>
<p>If all went fine, open a ticket, put a link to the original tarball in
the ticket and upload a branch with the code under
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/build/pkgs</span></code>.</p>
</div>
<div class="section" id="inclusion-procedure-for-new-and-updated-packages">
<span id="section-inclusion-procedure"></span><h2>Inclusion Procedure for New and Updated Packages<a class="headerlink" href="#inclusion-procedure-for-new-and-updated-packages" title="Permalink to this headline">¶</a></h2>
<p>Packages that are not part of Sage will first become optional or
experimental (the latter if they will not build on all supported
systems). After they have been in optional for some time without
problems they can be proposed to be included as standard packages in
Sage.</p>
<p>To propose a package for optional/experimental inclusion please open a
trac ticket with the respective <code class="docutils literal notranslate"><span class="pre">Component:</span></code> field set to either
<code class="docutils literal notranslate"><span class="pre">packages:experimental</span></code> or <code class="docutils literal notranslate"><span class="pre">packages:optional</span></code>. The associated code
requirements are described in the following sections.</p>
<p>After the ticket was reviewed and included, optional packages stay in
that status for at least a year, after which they can be proposed to be
included as standard packages in Sage. For this a trac ticket is opened
with the <code class="docutils literal notranslate"><span class="pre">Component:</span></code> field set to <code class="docutils literal notranslate"><span class="pre">packages:standard</span></code>. Then make
a proposal in the Google Group <code class="docutils literal notranslate"><span class="pre">sage-devel</span></code>.</p>
<p>Upgrading packages to new upstream versions or with additional patches
includes opening a ticket in the respective category too, as described
above.</p>
<div class="section" id="license-information">
<h3>License Information<a class="headerlink" href="#license-information" title="Permalink to this headline">¶</a></h3>
<p>If you are patching a standard Sage spkg, then you should make sure that
the license information for that package is up-to-date, both in its
<code class="docutils literal notranslate"><span class="pre">SPKG.txt</span></code> file and in the file <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/COPYING.txt</span></code>.  For
example, if you are producing an spkg which upgrades the vanilla source
to a new version, check whether the license changed between versions.</p>
</div>
<div class="section" id="prerequisites-for-new-standard-packages">
<h3>Prerequisites for New Standard Packages<a class="headerlink" href="#prerequisites-for-new-standard-packages" title="Permalink to this headline">¶</a></h3>
<p>For a package to become part of Sage’s standard distribution, it
must meet the following requirements:</p>
<ul>
<li><p class="first"><strong>License</strong>. For standard packages, the license must be compatible
with the GNU General Public License, version 3. The Free Software
Foundation maintains a long list of <a class="reference external" href="http://www.gnu.org/licenses/license-list.html">licenses and comments about
them</a>.</p>
</li>
<li><p class="first"><strong>Build Support</strong>. The code must build on all the <a class="reference external" href="http://wiki.sagemath.org/SupportedPlatforms#Fully_supported">fully supported
platforms</a>.</p>
<p>A standard package should also work on all the platforms where Sage
is <a class="reference external" href="http://wiki.sagemath.org/SupportedPlatforms#Expected_to_work">expected to work</a> and
on which Sage <a class="reference external" href="http://wiki.sagemath.org/SupportedPlatforms#Almost_works">almost works</a> but
since we don’t fully support these platforms and often lack the
resources to test on them, you are not expected to confirm your
packages works on those platforms.</p>
</li>
<li><p class="first"><strong>Quality</strong>. The code should be “better” than any other available
code (that passes the two above criteria), and the authors need to
justify this. The comparison should be made to both Python and other
software. Criteria in passing the quality test include:</p>
<ul class="simple">
<li>Speed</li>
<li>Documentation</li>
<li>Usability</li>
<li>Absence of memory leaks</li>
<li>Maintainable</li>
<li>Portability</li>
<li>Reasonable build time, size, dependencies</li>
</ul>
</li>
<li><p class="first"><strong>Previously an optional package</strong>. A new standard package must have
spent some time as an optional package. Or have a good reason why
this is not possible.</p>
</li>
<li><p class="first"><strong>Refereeing</strong>. The code must be refereed, as discussed in
<a class="reference internal" href="trac.html#chapter-sage-trac"><span class="std std-ref">The Sage Trac Server</span></a>.</p>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Packaging Third-Party Code</a><ul>
<li><a class="reference internal" href="#package-types">Package types</a></li>
<li><a class="reference internal" href="#directory-structure">Directory Structure</a><ul>
<li><a class="reference internal" href="#package-type">Package type</a></li>
<li><a class="reference internal" href="#build-and-install-scripts">Build and install scripts</a></li>
<li><a class="reference internal" href="#self-tests">Self-Tests</a></li>
<li><a class="reference internal" href="#python-based-packages">Python-based packages</a></li>
<li><a class="reference internal" href="#the-spkg-txt-file">The SPKG.txt File</a></li>
<li><a class="reference internal" href="#package-dependencies">Package dependencies</a></li>
<li><a class="reference internal" href="#patching-sources">Patching Sources</a></li>
<li><a class="reference internal" href="#when-to-patch-when-to-repackage-when-to-autoconfiscate">When to patch, when to repackage, when to autoconfiscate</a></li>
<li><a class="reference internal" href="#how-to-maintain-a-set-of-patches">How to maintain a set of patches</a></li>
<li><a class="reference internal" href="#modified-tarballs">Modified Tarballs</a></li>
<li><a class="reference internal" href="#package-versioning">Package Versioning</a></li>
<li><a class="reference internal" href="#checksums">Checksums</a></li>
</ul>
</li>
<li><a class="reference internal" href="#utility-script-to-create-package">Utility script to create package</a></li>
<li><a class="reference internal" href="#building-the-package">Building the package</a></li>
<li><a class="reference internal" href="#inclusion-procedure-for-new-and-updated-packages">Inclusion Procedure for New and Updated Packages</a><ul>
<li><a class="reference internal" href="#license-information">License Information</a></li>
<li><a class="reference internal" href="#prerequisites-for-new-standard-packages">Prerequisites for New Standard Packages</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="coding_in_other.html"
                        title="previous chapter">Using External Libraries and Interfaces</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="packaging_old_spkgs.html"
                        title="next chapter">Packaging Old-Style SPKGs</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/packaging.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="packaging_old_spkgs.html" title="Packaging Old-Style SPKGs"
             >next</a> |</li>
        <li class="right" >
          <a href="coding_in_other.html" title="Using External Libraries and Interfaces"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="index.html">Developer&#39;s Guide v8.4</a> &#187;</li>
 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005--2018, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>