
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="viewport" content="width=600, initial-scale=1">
    <title>Using External Libraries and Interfaces &#8212; Sage Developer&#39;s Guide v9.2</title>
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Packaging Third-Party Code" href="packaging.html" />
    <link rel="prev" title="Coding in Cython" href="coding_in_cython.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />
    <script src="_static/thebe.js" type="text/javascript"></script>
    <script src="_static/thebe-sage.js" type="text/javascript"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="packaging.html" title="Packaging Third-Party Code"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="coding_in_cython.html" title="Coding in Cython"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="index.html">Developer&#39;s Guide v9.2</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Using External Libraries and Interfaces</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-external-libraries-and-interfaces">
<span id="chapter-other"></span><h1>Using External Libraries and Interfaces<a class="headerlink" href="#using-external-libraries-and-interfaces" title="Permalink to this headline">¶</a></h1>
<p>When writing code for Sage, use Python for the basic structure and
interface. For speed, efficiency, or convenience, you can implement
parts of the code using any of the following languages: <a class="reference internal" href="coding_in_cython.html#chapter-cython"><span class="std std-ref">Cython</span></a>, C/C++, Fortran 95, GAP, Common Lisp, Singular, and
PARI/GP. You can also use all C/C++ libraries included with Sage
<a class="reference internal" href="#sagecomponents" id="id1"><span>[SageComponents]</span></a>. And if you are okay with your code depending on
optional Sage packages, you can use Octave, or even Magma,
Mathematica, or Maple.</p>
<p>In this chapter, we discuss interfaces between Sage and <a class="reference internal" href="#section-pari-library"><span class="std std-ref">PARI</span></a>, <a class="reference internal" href="#section-gap"><span class="std std-ref">GAP</span></a> and
<a class="reference internal" href="#section-singular"><span class="std std-ref">Singular</span></a>.</p>
<div class="section" id="the-pari-c-library-interface">
<span id="section-pari-library"></span><h2>The PARI C Library Interface<a class="headerlink" href="#the-pari-c-library-interface" title="Permalink to this headline">¶</a></h2>
<p>Here is a step-by-step guide to adding new PARI functions to Sage. We
use the Frobenius form of a matrix as an example. Some heavy lifting
for matrices over integers is implemented using the PARI library. To
compute the Frobenius form in PARI, the <code class="docutils literal notranslate"><span class="pre">matfrobenius</span></code> function is
used.</p>
<p>There are two ways to interact with the PARI library from Sage. The
gp interface uses the gp interpreter. The PARI interface uses
direct calls to the PARI C functions—this is the preferred way
as it is much faster. Thus this section focuses on using PARI.</p>
<p>We will add a new method to the <code class="docutils literal notranslate"><span class="pre">gen</span></code> class. This is the abstract
representation of all PARI library objects. That means that once we
add a method to this class, every PARI object, whether it is a number,
polynomial or matrix, will have our new method. So you can do
<code class="docutils literal notranslate"><span class="pre">pari(1).matfrobenius()</span></code>, but since PARI wants to apply
<code class="docutils literal notranslate"><span class="pre">matfrobenius</span></code> to matrices, not numbers, you will receive a
<code class="docutils literal notranslate"><span class="pre">PariError</span></code> in this case.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gen</span></code> class is defined in
<code class="file docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/libs/cypari2/gen.pyx</span></code>, and this is where we
add the method <code class="docutils literal notranslate"><span class="pre">matfrobenius</span></code>:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">matfrobenius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span>
    <span class="s">r&quot;&quot;&quot;</span>
<span class="s">    M.matfrobenius(flag=0): Return the Frobenius form of the square</span>
<span class="s">    matrix M. If flag is 1, return only the elementary divisors (a list</span>
<span class="s">    of polynomials). If flag is 2, return a two-components vector [F,B]</span>
<span class="s">    where F is the Frobenius form and B is the basis change so that</span>
<span class="s">    `M=B^{-1} F B`.</span>

<span class="s">    EXAMPLES::</span>

<span class="s">        sage: a = pari(&#39;[1,2;3,4]&#39;)</span>
<span class="s">        sage: a.matfrobenius()</span>
<span class="s">        [0, 2; 1, 5]</span>
<span class="s">        sage: a.matfrobenius(flag=1)</span>
<span class="s">        [x^2 - 5*x - 2]</span>
<span class="s">        sage: a.matfrobenius(2)</span>
<span class="s">        [[0, 2; 1, 5], [1, -1/3; 0, 1/3]]</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="n">sig_on</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_gen</span><span class="p">(</span><span class="n">matfrobenius</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="mf">0</span><span class="p">))</span>
</pre></div>
</div>
<p>Note the use of the
<a class="reference external" href="http://cysignals.readthedocs.org/en/latest/#using-sig-on-and-sig-off">sig_on() statement</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">matfrobenius</span></code> call is just a call to the PARI C library
function <code class="docutils literal notranslate"><span class="pre">matfrobenius</span></code> with the appropriate parameters.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">self.new_gen(GEN</span> <span class="pre">x)</span></code> call constructs a new Sage <code class="docutils literal notranslate"><span class="pre">gen</span></code> object
from a given PARI <code class="docutils literal notranslate"><span class="pre">GEN</span></code> where the PARI <code class="docutils literal notranslate"><span class="pre">GEN</span></code> is stored as the
<code class="docutils literal notranslate"><span class="pre">.g</span></code> attribute.  Apart from this, <code class="docutils literal notranslate"><span class="pre">self.new_gen()</span></code> calls a closing
<code class="docutils literal notranslate"><span class="pre">sig_off()</span></code> macro and also clears the PARI stack so it is very
convenient to use in a <code class="docutils literal notranslate"><span class="pre">return</span></code> statement as illustrated above.  So
after <code class="docutils literal notranslate"><span class="pre">self.new_gen()</span></code>, all PARI <code class="docutils literal notranslate"><span class="pre">GEN</span></code>’s which are not converted
to Sage <code class="docutils literal notranslate"><span class="pre">gen</span></code>’s are gone.  There is also <code class="docutils literal notranslate"><span class="pre">self.new_gen_noclear(GEN</span>
<span class="pre">x)</span></code> which does the same as <code class="docutils literal notranslate"><span class="pre">self.new_gen(GEN</span> <span class="pre">x)</span></code> except that it
does <em>not</em> call <code class="docutils literal notranslate"><span class="pre">sig_off()</span></code> nor clear the PARI stack.</p>
<p>The information about which function to call and how to call it can be
retrieved from the PARI user’s manual (note: Sage includes the
development version of PARI, so check that version of the user’s
manual). Looking for <code class="docutils literal notranslate"><span class="pre">matfrobenius</span></code> you can find:</p>
<blockquote>
<div><p>The library syntax is <code class="docutils literal notranslate"><span class="pre">GEN</span> <span class="pre">matfrobenius(GEN</span> <span class="pre">M,</span> <span class="pre">long</span> <span class="pre">flag,</span> <span class="pre">long</span> <span class="pre">v</span>
<span class="pre">=</span> <span class="pre">-1)</span></code>, where <code class="docutils literal notranslate"><span class="pre">v</span></code> is a variable number.</p>
</div></blockquote>
<p>In case you are familiar with gp, please note that the PARI C function
may have a name that is different from the corresponding gp function
(for example, see <code class="docutils literal notranslate"><span class="pre">mathnf</span></code>), so always check the manual.</p>
<p>We can also add a <code class="docutils literal notranslate"><span class="pre">frobenius(flag)</span></code> method to the <code class="docutils literal notranslate"><span class="pre">matrix_integer</span></code>
class where we call the <code class="docutils literal notranslate"><span class="pre">matfrobenius()</span></code> method on the PARI object
associated to the matrix after doing some sanity checking. Then we
convert output from PARI to Sage objects:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">frobenius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the Frobenius form (rational canonical form) of this</span>
<span class="sd">    matrix.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    -  ``flag`` -- 0 (default), 1 or 2 as follows:</span>

<span class="sd">        -  ``0`` -- (default) return the Frobenius form of this</span>
<span class="sd">           matrix.</span>

<span class="sd">        -  ``1`` -- return only the elementary divisor</span>
<span class="sd">           polynomials, as polynomials in var.</span>

<span class="sd">        -  ``2`` -- return a two-components vector [F,B] where F</span>
<span class="sd">           is the Frobenius form and B is the basis change so that</span>
<span class="sd">           `M=B^{-1}FB`.</span>

<span class="sd">    -  ``var`` -- a string (default: &#39;x&#39;)</span>

<span class="sd">    ALGORITHM: uses PARI&#39;s matfrobenius()</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: A = MatrixSpace(ZZ, 3)(range(9))</span>
<span class="sd">        sage: A.frobenius(0)</span>
<span class="sd">        [ 0  0  0]</span>
<span class="sd">        [ 1  0 18]</span>
<span class="sd">        [ 0  1 12]</span>
<span class="sd">        sage: A.frobenius(1)</span>
<span class="sd">        [x^3 - 12*x^2 - 18*x]</span>
<span class="sd">        sage: A.frobenius(1, var=&#39;y&#39;)</span>
<span class="sd">        [y^3 - 12*y^2 - 18*y]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_square</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ArithmeticError</span><span class="p">(</span><span class="s">&quot;frobenius matrix of non-square matrix not defined.&quot;</span><span class="p">)</span>

    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pari__</span><span class="p">()</span><span class="o">.</span><span class="n">matfrobenius</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flag</span><span class="o">==</span><span class="mf">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_space</span><span class="p">()(</span><span class="n">v</span><span class="o">.</span><span class="n">python</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">flag</span><span class="o">==</span><span class="mf">1</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_ring</span><span class="p">(),</span> <span class="n">names</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
        <span class="n">retr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
            <span class="n">retr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;^&quot;</span><span class="p">,</span><span class="s">&quot;**&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">:</span><span class="n">r</span><span class="o">.</span><span class="n">gen</span><span class="p">()},</span> <span class="n">r</span><span class="o">.</span><span class="n">gens_dict</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">retr</span>
    <span class="k">elif</span> <span class="n">flag</span><span class="o">==</span><span class="mf">2</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">matrix_space</span><span class="o">.</span><span class="n">MatrixSpace</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">())(</span><span class="n">v</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">.</span><span class="n">python</span><span class="p">())</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">matrix_space</span><span class="o">.</span><span class="n">MatrixSpace</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">())(</span><span class="n">v</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">.</span><span class="n">python</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">F</span><span class="p">,</span> <span class="n">B</span>
</pre></div>
</div>
</div>
<div class="section" id="gap">
<span id="section-gap"></span><h2>GAP<a class="headerlink" href="#gap" title="Permalink to this headline">¶</a></h2>
<p>Wrapping a GAP function in Sage is a matter of writing a program in
Python that uses the pexpect interface to pipe various commands to GAP
and read back the input into Sage. This is sometimes easy, sometimes
hard.</p>
<p>For example, suppose we want to make a wrapper for the computation of
the Cartan matrix of a simple Lie algebra. The Cartan matrix of <span class="math notranslate nohighlight">\(G_2\)</span>
is available in GAP using the commands:</p>
<div class="highlight-gap notranslate"><div class="highlight"><pre><span></span><span class="nv">gap</span><span class="o">&gt;</span> <span class="nv">L</span><span class="o">:=</span> <span class="nv">SimpleLieAlgebra</span><span class="p">(</span> <span class="s">&quot;G&quot;</span><span class="o">,</span> <span class="nv">2</span><span class="o">,</span> <span class="nv">Rationals</span> <span class="p">)</span><span class="o">;</span>
<span class="o">&lt;</span><span class="nv">Lie</span> <span class="nv">algebra</span> <span class="nv">of</span> <span class="nv">dimension</span> <span class="nv">14</span> <span class="nv">over</span> <span class="nv">Rationals</span><span class="o">&gt;</span>
<span class="nv">gap</span><span class="o">&gt;</span> <span class="nv">R</span><span class="o">:=</span> <span class="nv">RootSystem</span><span class="p">(</span> <span class="nv">L</span> <span class="p">)</span><span class="o">;</span>
<span class="o">&lt;</span><span class="nv">root</span> <span class="nv">system</span> <span class="nv">of</span> <span class="nv">rank</span> <span class="nv">2</span><span class="o">&gt;</span>
<span class="nv">gap</span><span class="o">&gt;</span> <span class="nv">CartanMatrix</span><span class="p">(</span> <span class="nv">R</span> <span class="p">)</span><span class="o">;</span>
</pre></div>
</div>
<p>In Sage, one can access these commands by typing:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">L</span> <span class="o">=</span> <span class="n">gap</span><span class="o">.</span><span class="n">SimpleLieAlgebra</span><span class="p">(</span><span class="s1">&#39;&quot;G&quot;&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Rationals&#39;</span><span class="p">);</span> <span class="n">L</span>
<span class="go">Algebra( Rationals, [ v.1, v.2, v.3, v.4, v.5, v.6, v.7, v.8, v.9, v.10,</span>
<span class="go">  v.11, v.12, v.13, v.14 ] )</span>
<span class="gp">sage: </span><span class="n">R</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">RootSystem</span><span class="p">();</span> <span class="n">R</span>
<span class="go">&lt;root system of rank 2&gt;</span>
<span class="gp">sage: </span><span class="n">R</span><span class="o">.</span><span class="n">CartanMatrix</span><span class="p">()</span>
<span class="go">[ [ 2, -1 ], [ -3, 2 ] ]</span>
</pre></div>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">'&quot;G&quot;'</span></code> which is evaluated in GAP as the string <code class="docutils literal notranslate"><span class="pre">&quot;G&quot;</span></code>.</p>
<p>The purpose of this section is to use this example to show how one
might write a Python/Sage program whose input is, say, <code class="docutils literal notranslate"><span class="pre">('G',2)</span></code> and
whose output is the matrix above (but as a Sage Matrix—see the code
in the directory <code class="file docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/matrix/</span></code> and the
corresponding parts of the Sage reference manual).</p>
<p>First, the input must be converted into strings consisting of legal
GAP commands. Then the GAP output, which is also a string, must be
parsed and converted if possible to a corresponding Sage/Python
object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cartan_matrix</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">rank</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the Cartan matrix of given Chevalley type and rank.</span>

<span class="sd">    INPUT:</span>
<span class="sd">        type -- a Chevalley letter name, as a string, for</span>
<span class="sd">                a family type of simple Lie algebras</span>
<span class="sd">        rank -- an integer (legal for that type).</span>

<span class="sd">    EXAMPLES:</span>
<span class="sd">        sage: cartan_matrix(&quot;A&quot;,5)</span>
<span class="sd">        [ 2 -1  0  0  0]</span>
<span class="sd">        [-1  2 -1  0  0]</span>
<span class="sd">        [ 0 -1  2 -1  0]</span>
<span class="sd">        [ 0  0 -1  2 -1]</span>
<span class="sd">        [ 0  0  0 -1  2]</span>
<span class="sd">        sage: cartan_matrix(&quot;G&quot;,2)</span>
<span class="sd">        [ 2 -1]</span>
<span class="sd">        [-3  2]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">L</span> <span class="o">=</span> <span class="n">gap</span><span class="o">.</span><span class="n">SimpleLieAlgebra</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="o">%</span><span class="nb">type</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="s1">&#39;Rationals&#39;</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">RootSystem</span><span class="p">()</span>
    <span class="n">sM</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">CartanMatrix</span><span class="p">()</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sM</span><span class="p">))</span>
    <span class="n">MS</span>  <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="n">rank</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MS</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</pre></div>
</div>
<p>The output <code class="docutils literal notranslate"><span class="pre">ans</span></code> is a Python list. The last two lines convert that
list to an instance of the Sage class <code class="docutils literal notranslate"><span class="pre">Matrix</span></code>.</p>
<p>Alternatively, one could replace the first line of the above function
with this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="n">gap</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;SimpleLieAlgebra(&quot;</span><span class="si">%s</span><span class="s1">&quot;, </span><span class="si">%s</span><span class="s1">, Rationals);&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">rank</span><span class="p">))</span>
</pre></div>
</div>
<p>Defining “easy” and “hard” is subjective, but here is one definition.
Wrapping a GAP function is “easy” if there is already a corresponding
class in Python or Sage for the output data type of the GAP function
you are trying to wrap. For example, wrapping any GUAVA (GAP’s
error-correcting codes package) function is “easy” since
error-correcting codes are vector spaces over finite fields and GUAVA
functions return one of the following data types:</p>
<ul class="simple">
<li><p>vectors over finite fields,</p></li>
<li><p>polynomials over finite fields,</p></li>
<li><p>matrices over finite fields,</p></li>
<li><p>permutation groups or their elements,</p></li>
<li><p>integers.</p></li>
</ul>
<p>Sage already has classes for each of these.</p>
<p>A “hard” example is left as an exercise! Here are a few ideas.</p>
<ul class="simple">
<li><p>Write a wrapper for GAP’s <code class="docutils literal notranslate"><span class="pre">FreeLieAlgebra</span></code> function (or, more
generally, all the finitely presented Lie algebra functions in
GAP). This would require creating new Python objects.</p></li>
<li><p>Write a wrapper for GAP’s <code class="docutils literal notranslate"><span class="pre">FreeGroup</span></code> function (or, more
generally, all the finitely presented groups functions in GAP). This
would require writing some new Python objects.</p></li>
<li><p>Write a wrapper for GAP’s character tables. Though this could be
done without creating new Python objects, to make the most use of
these tables, it probably would be best to have new Python objects
for this.</p></li>
</ul>
</div>
<div class="section" id="libgap">
<span id="section-libgap"></span><h2>LibGAP<a class="headerlink" href="#libgap" title="Permalink to this headline">¶</a></h2>
<p>The disadvantage of using other programs through interfaces is that
there is a certain unavoidable latency (of the order of 10ms) involved
in sending input and receiving the result. If you have to call
functions in a tight loop this can be unacceptably slow. Calling into
a shared library has much lower latency and furthermore avoids having
to convert everything into a string in-between. This is why Sage
includes a shared library version of the GAP kernel, available as
<span class="math notranslate nohighlight">\(libgap\)</span> in Sage. The libgap analogue of the first example in
<a class="reference internal" href="#section-gap"><span class="std std-ref">GAP</span></a> is:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">SimpleLieAlgebra</span> <span class="o">=</span> <span class="n">libgap</span><span class="o">.</span><span class="n">function_factory</span><span class="p">(</span><span class="s1">&#39;SimpleLieAlgebra&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">L</span> <span class="o">=</span> <span class="n">SimpleLieAlgebra</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">QQ</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">R</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">RootSystem</span><span class="p">();</span>  <span class="n">R</span>
<span class="go">&lt;root system of rank 2&gt;</span>
<span class="gp">sage: </span><span class="n">R</span><span class="o">.</span><span class="n">CartanMatrix</span><span class="p">()</span>    <span class="c1"># output is a GAP matrix</span>
<span class="go">[ [ 2, -1 ], [ -3, 2 ] ]</span>
<span class="gp">sage: </span><span class="n">matrix</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">CartanMatrix</span><span class="p">())</span>   <span class="c1"># convert to Sage matrix</span>
<span class="go">[ 2 -1]</span>
<span class="go">[-3  2]</span>
</pre></div>
</div>
</div>
<div class="section" id="singular">
<span id="section-singular"></span><h2>Singular<a class="headerlink" href="#singular" title="Permalink to this headline">¶</a></h2>
<p>Using Singular functions from Sage is not much different conceptually
from using GAP functions from Sage. As with GAP, this can range from
easy to hard, depending on how much of the data structure of the
output of the Singular function is already present in Sage.</p>
<p>First, some terminology. For us, a <em>curve</em> <span class="math notranslate nohighlight">\(X\)</span> over a finite field <span class="math notranslate nohighlight">\(F\)</span>
is an equation of the form <span class="math notranslate nohighlight">\(f(x,y) = 0\)</span>, where <span class="math notranslate nohighlight">\(f \in F[x,y]\)</span> is a
polynomial. It may or may not be singular. A <em>place of degree</em> <span class="math notranslate nohighlight">\(d\)</span> is
a Galois orbit of <span class="math notranslate nohighlight">\(d\)</span> points in <span class="math notranslate nohighlight">\(X(E)\)</span>, where <span class="math notranslate nohighlight">\(E/F\)</span> is of degree
<span class="math notranslate nohighlight">\(d\)</span>. For example, a place of degree <span class="math notranslate nohighlight">\(1\)</span> is also a place of degree <span class="math notranslate nohighlight">\(3\)</span>,
but a place of degree <span class="math notranslate nohighlight">\(2\)</span> is not since no degree <span class="math notranslate nohighlight">\(3\)</span> extension of <span class="math notranslate nohighlight">\(F\)</span>
contains a degree <span class="math notranslate nohighlight">\(2\)</span> extension. Places of degree <span class="math notranslate nohighlight">\(1\)</span> are also called
<span class="math notranslate nohighlight">\(F\)</span>-rational points.</p>
<p>As an example of the Sage/Singular interface, we will explain how to
wrap Singular’s <code class="docutils literal notranslate"><span class="pre">NSplaces</span></code>, which computes places on a curve over a
finite field. (The command <code class="docutils literal notranslate"><span class="pre">closed_points</span></code> also does this in some
cases.) This is “easy” since no new Python classes are needed in Sage
to carry this out.</p>
<p>Here is an example on how to use this command in Singular:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> A Computer Algebra System for Polynomial Computations   /   version 3-0-0
                                                       0&lt;
     by: G.-M. Greuel, G. Pfister, H. Schoenemann        \   May 2005
FB Mathematik der Universitaet, D-67653 Kaiserslautern    \
&gt; LIB &quot;brnoeth.lib&quot;;
[...]
&gt; ring s=5,(x,y),lp;
&gt; poly f=y^2-x^9-x;
&gt; list X1=Adj_div(f);
Computing affine singular points ...
Computing all points at infinity ...
Computing affine singular places ...
Computing singular places at infinity ...
Computing non-singular places at infinity ...
Adjunction divisor computed successfully

The genus of the curve is 4
&gt; list X2=NSplaces(1,X1);
Computing non-singular affine places of degree 1 ...
&gt; list X3=extcurve(1,X2);

Total number of rational places : 6

&gt; def R=X3[1][5];
&gt; setring R;
&gt; POINTS;
[1]:
   [1]:
      0
   [2]:
      1
   [3]:
      0
[2]:
   [1]:
      -2
   [2]:
      1
   [3]:
      1
[3]:
   [1]:
      -2
   [2]:
      1
   [3]:
      1
[4]:
   [1]:
      -2
   [2]:
      -1
   [3]:
      1
[5]:
   [1]:
      2
   [2]:
      -2
   [3]:
      1
[6]:
   [1]:
      0
   [2]:
      0
   [3]:
      1
</pre></div>
</div>
<p>Here is another way of doing this same calculation in the Sage
interface to Singular:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">singular</span><span class="o">.</span><span class="n">LIB</span><span class="p">(</span><span class="s2">&quot;brnoeth.lib&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">singular</span><span class="o">.</span><span class="n">ring</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;(x,y)&#39;</span><span class="p">,</span><span class="s1">&#39;lp&#39;</span><span class="p">)</span>
<span class="go">    polynomial ring, over a field, global ordering</span>
<span class="go">    //   coefficients: ZZ/5</span>
<span class="go">    //   number of vars : 2</span>
<span class="go">    //        block   1 : ordering lp</span>
<span class="go">    //                  : names    x y</span>
<span class="go">    //        block   2 : ordering C</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">singular</span><span class="p">(</span><span class="s1">&#39;y^2-x^9-x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;list X1=Adj_div(</span><span class="si">%s</span><span class="s2">);&quot;</span><span class="o">%</span><span class="k">f</span>.name()))
<span class="go">Computing affine singular points ...</span>
<span class="go">Computing all points at infinity ...</span>
<span class="go">Computing affine singular places ...</span>
<span class="go">Computing singular places at infinity ...</span>
<span class="go">Computing non-singular places at infinity ...</span>
<span class="go">Adjunction divisor computed successfully</span>

<span class="go">The genus of the curve is 4</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;list X2=NSplaces(1,X1);&quot;</span><span class="p">))</span>
<span class="go">Computing non-singular affine places of degree 1 ...</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;list X3=extcurve(1,X2);&quot;</span><span class="p">))</span>

<span class="go">Total number of rational places : 6</span>

<span class="gp">sage: </span><span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;def R=X3[1][5];&quot;</span><span class="p">)</span>
<span class="go">&#39;&#39;</span>
<span class="gp">sage: </span><span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;setring R;&quot;</span><span class="p">)</span>
<span class="go">&#39;&#39;</span>
<span class="gp">sage: </span><span class="n">L</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;POINTS;&quot;</span><span class="p">)</span>

<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="go">[1]:</span>
<span class="go">   [1]:</span>
<span class="go">      0</span>
<span class="go">   [2]:</span>
<span class="go">      1</span>
<span class="go">   [3]:</span>
<span class="go">      0</span>
<span class="go">[2]:</span>
<span class="go">   [1]:</span>
<span class="go">      -2</span>
<span class="go">   [2]:</span>
<span class="go">      -1</span>
<span class="go">   [3]:</span>
<span class="go">      1</span>
<span class="go">...</span>
</pre></div>
</div>
<p>From looking at the output, notice that our wrapper function will need
to parse the string represented by <span class="math notranslate nohighlight">\(L\)</span> above, so let us write a
separate function to do just that. This requires figuring out how to
determine where the coordinates of the points are placed in the string
<span class="math notranslate nohighlight">\(L\)</span>. Python has some very useful string manipulation commands to do
just that.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">points_parser</span><span class="p">(</span><span class="n">string_points</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will parse a string of points</span>
<span class="sd">    of X over a finite field F returned by Singular&#39;s NSplaces</span>
<span class="sd">    command into a Python list of points with entries from F.</span>

<span class="sd">    EXAMPLES:</span>
<span class="sd">        sage: F = GF(5)</span>
<span class="sd">        sage: points_parser(L,F)</span>
<span class="sd">        ((0, 1, 0), (3, 4, 1), (0, 0, 1), (2, 3, 1), (3, 1, 1), (2, 2, 1))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Pts</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="c1">#start block to compute a pt</span>
    <span class="n">L1</span><span class="o">=</span><span class="n">L</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">L1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">32</span><span class="p">:</span>
        <span class="n">idx</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;     &quot;</span><span class="p">)</span>
        <span class="n">pt</span><span class="o">=</span><span class="p">[]</span>
        <span class="c1">## start block1 for compute pt</span>
        <span class="n">idx</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;     &quot;</span><span class="p">)</span>
        <span class="n">idx2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">L2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">idx2</span><span class="p">]</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">L2</span><span class="p">)))</span>
        <span class="c1"># end block1 to compute pt</span>
        <span class="n">L1</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">8</span><span class="p">:]</span> <span class="c1"># repeat block 2 more times</span>
        <span class="c1">## start block2 for compute pt</span>
        <span class="n">idx</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;     &quot;</span><span class="p">)</span>
        <span class="n">idx2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">L2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">idx2</span><span class="p">]</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">L2</span><span class="p">)))</span>
        <span class="c1"># end block2 to compute pt</span>
        <span class="n">L1</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">8</span><span class="p">:]</span> <span class="c1"># repeat block 1 more time</span>
        <span class="c1">## start block3 for compute pt</span>
        <span class="n">idx</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;     &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:]:</span>
            <span class="n">idx2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx2</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:])</span>
        <span class="n">L2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">idx2</span><span class="p">]</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">L2</span><span class="p">)))</span>
        <span class="c1"># end block3 to compute pt</span>
        <span class="c1">#end block to compute a pt</span>
        <span class="n">Pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pt</span><span class="p">))</span>  <span class="c1"># repeat until no more pts</span>
        <span class="n">L1</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">8</span><span class="p">:]</span> <span class="c1"># repeat block 2 more times</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Pts</span><span class="p">)</span>
</pre></div>
</div>
<p>Now it is an easy matter to put these ingredients together into a Sage
function which takes as input a triple <span class="math notranslate nohighlight">\((f,F,d)\)</span>: a polynomial <span class="math notranslate nohighlight">\(f\)</span> in
<span class="math notranslate nohighlight">\(F[x,y]\)</span> defining <span class="math notranslate nohighlight">\(X:\  f(x,y)=0\)</span> (note that the variables <span class="math notranslate nohighlight">\(x,y\)</span> must
be used), a finite field <span class="math notranslate nohighlight">\(F\)</span> <em>of prime order</em>, and the degree <span class="math notranslate nohighlight">\(d\)</span>. The
output is the number of places in <span class="math notranslate nohighlight">\(X\)</span> of degree <span class="math notranslate nohighlight">\(d=1\)</span> over <span class="math notranslate nohighlight">\(F\)</span>. At the
moment, there is no “translation” between elements of <span class="math notranslate nohighlight">\(GF(p^d)\)</span> in
Singular and Sage unless <span class="math notranslate nohighlight">\(d=1\)</span>. So, for this reason, we restrict
ourselves to points of degree one.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">places_on_curve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INPUT:</span>
<span class="sd">        f -- element of F[x,y], defining X: f(x,y)=0</span>
<span class="sd">        F -- a finite field of *prime order*</span>

<span class="sd">    OUTPUT:</span>
<span class="sd">        integer -- the number of places in X of degree d=1 over F</span>

<span class="sd">    EXAMPLES:</span>
<span class="sd">        sage: F=GF(5)</span>
<span class="sd">        sage: R=PolynomialRing(F,2,names=[&quot;x&quot;,&quot;y&quot;])</span>
<span class="sd">        sage: x,y=R.gens()</span>
<span class="sd">        sage: f=y^2-x^9-x</span>
<span class="sd">        sage: places_on_curve(f,F)</span>
<span class="sd">        ((0, 1, 0), (3, 4, 1), (0, 0, 1), (2, 3, 1), (3, 1, 1), (2, 2, 1))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">characteristic</span><span class="p">()</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;LIB &quot;brnoeth.lib&quot;;&#39;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;ring s=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,(x,y),lp;&quot;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;poly f=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;list X1=Adj_div(f);&quot;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;list X2=NSplaces(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,X1);&quot;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;list X3=extcurve(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,X2);&quot;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;def R=X3[1][5];&quot;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;setring R;&quot;</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;POINTS;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">points_parser</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the ordering returned by this Sage function is exactly the
same as the ordering in the Singular variable <code class="docutils literal notranslate"><span class="pre">POINTS</span></code>.</p>
<p>One more example (in addition to the one in the docstring):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">F</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">R</span> <span class="o">=</span> <span class="n">MPolynomialRing</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">y</span><span class="o">+</span><span class="n">y</span><span class="o">^</span><span class="mi">3</span><span class="o">+</span><span class="n">x</span>
<span class="gp">sage: </span><span class="n">places_on_curve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
<span class="go">((0, 1, 0), (1, 0, 0), (0, 0, 1))</span>
</pre></div>
</div>
</div>
<div class="section" id="singular-another-approach">
<h2>Singular: Another Approach<a class="headerlink" href="#singular-another-approach" title="Permalink to this headline">¶</a></h2>
<p>There is also a more Python-like interface to Singular. Using this,
the code is much simpler, as illustrated below. First, we demonstrate
computing the places on a curve in a particular case:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">singular</span><span class="o">.</span><span class="n">lib</span><span class="p">(</span><span class="s1">&#39;brnoeth.lib&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">R</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">ring</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;(x,y)&#39;</span><span class="p">,</span> <span class="s1">&#39;lp&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;y^2 - x^9 - x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">X1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">Adj_div</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">X2</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">NSplaces</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">X3</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">extcurve</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">R</span> <span class="o">=</span> <span class="n">X3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">singular</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">L</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;POINTS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that these elements of L are defined modulo 5 in Singular, and
they compare differently than you would expect from their print
representation:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">sorted</span><span class="p">([(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)])</span>
<span class="go">[(0, 0, 1), (0, 1, 0), (2, 2, 1), (2, -2, 1), (-2, 1, 1), (-2, -1, 1)]</span>
</pre></div>
</div>
<p>Next, we implement the general function (for brevity we omit the
docstring, which is the same as above). Note that the <code class="docutils literal notranslate"><span class="pre">point_parser</span></code>
function is not required:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">places_on_curve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">characteristic</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">F</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">lib</span><span class="p">(</span><span class="s1">&#39;brnoeth.lib&#39;</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">ring</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;(x,y)&#39;</span><span class="p">,</span> <span class="s1">&#39;lp&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;y^2 - x^9 - x&#39;</span><span class="p">)</span>
    <span class="n">X1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">Adj_div</span><span class="p">()</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">NSplaces</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X1</span><span class="p">)</span>
    <span class="n">X3</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">extcurve</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">X3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">setring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;POINTS&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span> \
             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">size</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<p>This code is much shorter, nice, and more readable. However, it
depends on certain functions, e.g. <code class="docutils literal notranslate"><span class="pre">singular.setring</span></code> having been
implemented in the Sage/Singular interface, whereas the code in the
previous section used only the barest minimum of that interface.</p>
</div>
<div class="section" id="creating-a-new-pseudo-tty-interface">
<h2>Creating a New Pseudo-TTY Interface<a class="headerlink" href="#creating-a-new-pseudo-tty-interface" title="Permalink to this headline">¶</a></h2>
<p>You can create Sage pseudo-tty interfaces that allow Sage to work with
almost any command line program, and which do not require any
modification or extensions to that program. They are also surprisingly
fast and flexible (given how they work!), because all I/O is buffered,
and because interaction between Sage and the command line program can
be non-blocking (asynchronous). A pseudo-tty Sage interface is
asynchronous because it derives from the Sage class <code class="docutils literal notranslate"><span class="pre">Expect</span></code>, which
handles the communication between Sage and the external process.</p>
<p>For example, here is part of the file
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/interfaces/octave.py</span></code>, which
defines an interface between Sage and Octave, an open source program
for doing numerical computations, among other things:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">expect</span> <span class="kn">import</span> <span class="n">Expect</span><span class="p">,</span> <span class="n">ExpectElement</span>

<span class="k">class</span> <span class="nc">Octave</span><span class="p">(</span><span class="n">Expect</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The first two lines import the library <code class="docutils literal notranslate"><span class="pre">os</span></code>, which contains
operating system routines, and also the class <code class="docutils literal notranslate"><span class="pre">Expect</span></code>, which is the
basic class for interfaces. The third line defines the class
<code class="docutils literal notranslate"><span class="pre">Octave</span></code>; it derives from <code class="docutils literal notranslate"><span class="pre">Expect</span></code> as well. After this comes a
docstring, which we omit here (see the file for details). Next comes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script_subdirectory</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">server</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">server_tmpdir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">Expect</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;octave&#39;</span><span class="p">,</span>
                    <span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;octave --no-line-editing --silent&quot;</span><span class="p">,</span>
                    <span class="n">server</span> <span class="o">=</span> <span class="n">server</span><span class="p">,</span>
                    <span class="n">server_tmpdir</span> <span class="o">=</span> <span class="n">server_tmpdir</span><span class="p">,</span>
                    <span class="n">script_subdirectory</span> <span class="o">=</span> <span class="n">script_subdirectory</span><span class="p">,</span>
                    <span class="n">restart_on_ctrlc</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="n">verbose_start</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span><span class="p">,</span>
                    <span class="n">eval_using_file_cutoff</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>This uses the class <code class="docutils literal notranslate"><span class="pre">Expect</span></code> to set up the Octave interface:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the variable var to the given value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Error executing code in Octave</span><span class="se">\n</span><span class="s2">CODE:</span><span class="se">\n\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">Octave ERROR:</span><span class="se">\n\t</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">out</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the value of the variable var.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">var</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

<span class="k">def</span> <span class="nf">console</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">octave_console</span><span class="p">()</span>
</pre></div>
</div>
<p>These let users type <code class="docutils literal notranslate"><span class="pre">octave.set('x',</span> <span class="pre">3)</span></code>, after which
<code class="docutils literal notranslate"><span class="pre">octave.get('x')</span></code> returns <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">3'</span></code>. Running <code class="docutils literal notranslate"><span class="pre">octave.console()</span></code>
dumps the user into an Octave interactive shell:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">solve_linear_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use octave to compute a solution x to A*x = b, as a list.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - A -- mxn matrix A with entries in QQ or RR</span>
<span class="sd">    - b -- m-vector b entries in QQ or RR (resp)</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">    An list x (if it exists) which solves M*x = b</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: M33 = MatrixSpace(QQ,3,3)</span>
<span class="sd">        sage: A   = M33([1,2,3,4,5,6,7,8,0])</span>
<span class="sd">        sage: V3  = VectorSpace(QQ,3)</span>
<span class="sd">        sage: b   = V3([1,2,3])</span>
<span class="sd">        sage: octave.solve_linear_system(A,b)    # optional - octave</span>
<span class="sd">        [-0.333333, 0.666667, 0]</span>

<span class="sd">    AUTHOR: David Joyner and William Stein</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">nrows</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">ncols</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dimensions of A and b must be compatible&quot;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">sage.matrix.all</span> <span class="kn">import</span> <span class="n">MatrixSpace</span>
    <span class="kn">from</span> <span class="nn">sage.rings.all</span> <span class="kn">import</span> <span class="n">QQ</span>
    <span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">b</span>  <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="c1"># converted b to a &quot;column vector&quot;</span>
    <span class="n">sA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sage2octave_matrix_string</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sage2octave_matrix_string</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;a = &quot;</span> <span class="o">+</span> <span class="n">sA</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;b = &quot;</span> <span class="o">+</span> <span class="n">sb</span> <span class="p">)</span>
    <span class="n">soln</span> <span class="o">=</span> <span class="n">octave</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;c = a </span><span class="se">\\</span><span class="s2"> b&quot;</span><span class="p">)</span>
    <span class="n">soln</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> &quot;</span><span class="p">,</span><span class="s2">&quot;[&quot;</span><span class="p">)</span>
    <span class="n">soln</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
    <span class="n">soln</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">sol</span>  <span class="o">=</span> <span class="n">soln</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
</pre></div>
</div>
<p>This code defines the method <code class="docutils literal notranslate"><span class="pre">solve_linear_system</span></code>, which works as
documented.</p>
<p>These are only excerpts from <code class="docutils literal notranslate"><span class="pre">octave.py</span></code>; check that file for more
definitions and examples. Look at other files in the directory
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/interfaces/</span></code> for examples of interfaces to other
software packages.</p>
<dl class="citation">
<dt class="label" id="sagecomponents"><span class="brackets"><a class="fn-backref" href="#id1">SageComponents</a></span></dt>
<dd><p>See <a class="reference external" href="http://www.sagemath.org/links-components.html">http://www.sagemath.org/links-components.html</a>
for a list</p>
</dd>
</dl>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using External Libraries and Interfaces</a><ul>
<li><a class="reference internal" href="#the-pari-c-library-interface">The PARI C Library Interface</a></li>
<li><a class="reference internal" href="#gap">GAP</a></li>
<li><a class="reference internal" href="#libgap">LibGAP</a></li>
<li><a class="reference internal" href="#singular">Singular</a></li>
<li><a class="reference internal" href="#singular-another-approach">Singular: Another Approach</a></li>
<li><a class="reference internal" href="#creating-a-new-pseudo-tty-interface">Creating a New Pseudo-TTY Interface</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="coding_in_cython.html"
                        title="previous chapter">Coding in Cython</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="packaging.html"
                        title="next chapter">Packaging Third-Party Code</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/coding_in_other.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="packaging.html" title="Packaging Third-Party Code"
             >next</a> |</li>
        <li class="right" >
          <a href="coding_in_cython.html" title="Coding in Cython"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="index.html">Developer&#39;s Guide v9.2</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Using External Libraries and Interfaces</a></li> 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005--2020, The Sage Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* The sidebar toggle adapts its height to the bodywrapper height. */
    const resizeObserver = new ResizeObserver(entries => {
        tog.height(bod.height());
    });
    resizeObserver.observe(bod[0]);

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>