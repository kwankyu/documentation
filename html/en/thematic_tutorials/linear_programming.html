
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=600, initial-scale=1">
    <title>Linear Programming (Mixed Integer) &#8212; Thematic Tutorials v8.9</title>
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Number Theory and the RSA Public Key Cryptosystem" href="numtheory_rsa.html" />
    <link rel="prev" title="Vector calculus in the Euclidean plane" href="vector_calculus/vector_calc_plane.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />
    <script src="_static/thebe.js" type="text/javascript"></script>
    <script src="_static/thebe-sage.js" type="text/javascript"></script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="numtheory_rsa.html" title="Number Theory and the RSA Public Key Cryptosystem"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="vector_calculus/vector_calc_plane.html" title="Vector calculus in the Euclidean plane"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="index.html">Thematic Tutorials v8.9</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="toctree.html" accesskey="U">Thematic tutorial document tree</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="linear-programming-mixed-integer">
<span id="linear-programming"></span><h1>Linear Programming (Mixed Integer)<a class="headerlink" href="#linear-programming-mixed-integer" title="Permalink to this headline">¶</a></h1>
<p>This document explains the use of linear programming (LP) – and of
mixed integer linear programming (MILP) – in Sage by illustrating it
with several problems it can solve. Most of the examples given are
motivated by graph-theoretic concerns, and should be understandable
without any specific knowledge of this field. As a tool in
Combinatorics, using linear programming amounts to understanding how
to reformulate an optimization (or existence) problem through linear
constraints.</p>
<p>This is a translation of a chapter from the book
<a class="reference external" href="http://sagebook.gforge.inria.fr">Calcul mathematique avec Sage</a>.</p>
<div class="section" id="definition">
<h2>Definition<a class="headerlink" href="#definition" title="Permalink to this headline">¶</a></h2>
<p>Here we present the usual definition of what a linear program is: it
is defined by a matrix <span class="math notranslate nohighlight">\(A: \mathbb{R}^m \mapsto \mathbb{R}^n\)</span>, along
with two vectors <span class="math notranslate nohighlight">\(b,c \in \mathbb{R}^n\)</span>. Solving a linear program is
searching for a vector <span class="math notranslate nohighlight">\(x\)</span> maximizing an <em>objective</em> function and
satisfying a set of constraints, i.e.</p>
<div class="math notranslate nohighlight">
\[c^t x = \max_{x' \text{ such that } Ax' \leq b} c^t x'\]</div>
<p>where the ordering <span class="math notranslate nohighlight">\(u \leq u'\)</span> between two vectors means that the
entries of <span class="math notranslate nohighlight">\(u'\)</span> are pairwise greater than the entries of <span class="math notranslate nohighlight">\(u\)</span>. We also
write:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{Max: } &amp; c^t x\\
\text{Such that: } &amp; Ax \leq b\end{split}\]</div>
<p>Equivalently, we can also say that solving a linear program amounts to
maximizing a linear function defined over a polytope (preimage or
<span class="math notranslate nohighlight">\(A^{-1} (\leq b)\)</span>). These definitions, however, do not tell us how to
use linear programming in combinatorics. In the following, we will
show how to solve optimization problems like the Knapsack problem, the
Maximum Matching problem, and a Flow problem.</p>
</div>
<div class="section" id="mixed-integer-linear-programming">
<h2>Mixed integer linear programming<a class="headerlink" href="#mixed-integer-linear-programming" title="Permalink to this headline">¶</a></h2>
<p>There are bad news coming along with this definition of linear
programming: an LP can be solved in polynomial time. This is indeed
bad news, because this would mean that unless we define LP of
exponential size, we cannot expect LP to solve NP-complete problems,
which would be a disappointment. On a brighter side, it becomes
NP-complete to solve a linear program if we are allowed to specify
constraints of a different kind: requiring that some variables be
integers instead of real values. Such an LP is actually called a “mixed
integer linear program” (some variables can be integers, some other
reals). Hence, we can expect to find in the MILP framework a <em>wide</em>
range of expressivity.</p>
</div>
<div class="section" id="practical">
<h2>Practical<a class="headerlink" href="#practical" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-milp-class">
<h3>The <code class="docutils literal notranslate"><span class="pre">MILP</span></code> class<a class="headerlink" href="#the-milp-class" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">MILP</span></code> class in Sage represents a MILP! It is also used to
solve regular LP. It has a very small number of methods, meant to
define our set of constraints and variables, then to read the solution
found by the solvers once computed. It is also possible to export a
MILP defined with Sage to a <code class="docutils literal notranslate"><span class="pre">.lp</span></code> or <code class="docutils literal notranslate"><span class="pre">.mps</span></code> file, understood by most
solvers.</p>
<p>Let us ask Sage to solve the following LP:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{Max: } &amp; x + y + 3z\\
\text{Such that: } &amp; x + 2y \leq 4\\
\text{} &amp; 5z - y \leq 8\\
\text{} &amp; x,y,z \geq 0\\\end{split}\]</div>
<p>To achieve it, we need to define a corresponding <code class="docutils literal notranslate"><span class="pre">MILP</span></code> object, along with 3
variables <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">z</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span> <span class="o">=</span> <span class="n">MixedIntegerLinearProgram</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">new_variable</span><span class="p">(</span><span class="n">real</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nonnegative</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Next, we set the objective function</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<p>And finally we set the constraints</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">z</span> <span class="o">-</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">solve</span></code> method returns by default the optimal value reached by
the objective function</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">solve</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">8.8</span>
</pre></div>
</div>
<p>We can read the optimal assignation found by the solver for <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span> and
<span class="math notranslate nohighlight">\(z\)</span> through the <code class="docutils literal notranslate"><span class="pre">get_values</span></code> method</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">4.0</span>
<span class="gp">sage: </span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">sage: </span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">1.6</span>
</pre></div>
</div>
</div>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>In the previous example, we obtained variables through <code class="docutils literal notranslate"><span class="pre">v['x']</span></code>, <code class="docutils literal notranslate"><span class="pre">v['y']</span></code>
and <code class="docutils literal notranslate"><span class="pre">v['z']</span></code>. This being said, larger LP/MILP will require us to associate an
LP variable to many Sage objects, which can be integers, strings, or even the
vertices and edges of a graph. For example:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">new_variable</span><span class="p">(</span><span class="n">real</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nonnegative</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>With this new object <code class="docutils literal notranslate"><span class="pre">x</span></code> we can now write constraints using
<code class="docutils literal notranslate"><span class="pre">x[1],...,x[15]</span></code>.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that we did not need to define the “length” of <code class="docutils literal notranslate"><span class="pre">x</span></code>. Actually, <code class="docutils literal notranslate"><span class="pre">x</span></code>
would accept any immutable object as a key, as a dictionary would. We can now
write</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;I am a valid key&quot;</span><span class="p">]</span> <span class="o">+</span>
<span class="gp">....: </span>                 <span class="n">x</span><span class="p">[(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="n">pi</span><span class="p">)]</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>And because any immutable object can be used as a key, doubly indexed variables
<span class="math notranslate nohighlight">\(x^{1,1}, ..., x^{1,15}, x^{2,1}, ..., x^{15,15}\)</span> can be referenced by
<code class="docutils literal notranslate"><span class="pre">x[1,1],...,x[1,15],x[2,1],...,x[15,15]</span></code></p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="typed-variables-and-bounds">
<h4>Typed variables and bounds<a class="headerlink" href="#typed-variables-and-bounds" title="Permalink to this headline">¶</a></h4>
<p><strong>Types :</strong> If you want a variable to assume only integer or binary values, use
the <code class="docutils literal notranslate"><span class="pre">integer=True</span></code> or <code class="docutils literal notranslate"><span class="pre">binary=True</span></code> arguments of the <code class="docutils literal notranslate"><span class="pre">new_variable</span></code>
method. Alternatively, call the <code class="docutils literal notranslate"><span class="pre">set_integer</span></code> and <code class="docutils literal notranslate"><span class="pre">set_binary</span></code> methods.</p>
<p><strong>Bounds :</strong> If you want your variables to only take nonnegative values, you can
say so when calling <code class="docutils literal notranslate"><span class="pre">new_variable</span></code> with the argument <code class="docutils literal notranslate"><span class="pre">nonnegative=True</span></code>. If
you want to set a different upper/lower bound on a variable, add a constraint or
use the <code class="docutils literal notranslate"><span class="pre">set_min</span></code>, <code class="docutils literal notranslate"><span class="pre">set_max</span></code> methods.</p>
</div>
</div>
</div>
<div class="section" id="basic-linear-programs">
<h2>Basic linear programs<a class="headerlink" href="#basic-linear-programs" title="Permalink to this headline">¶</a></h2>
<div class="section" id="knapsack">
<h3>Knapsack<a class="headerlink" href="#knapsack" title="Permalink to this headline">¶</a></h3>
<p>The <em>Knapsack</em> problem is the following: given a collection of items
having both a weight and a <em>usefulness</em>, we would like to fill a bag
whose capacity is constrained while maximizing the usefulness of the
items contained in the bag (we will consider the sum of the items’
usefulness). For the purpose of this tutorial, we set the restriction
that the bag can only carry a certain total weight.</p>
<p>To achieve this, we have to associate to each object <span class="math notranslate nohighlight">\(o\)</span> of our
collection <span class="math notranslate nohighlight">\(C\)</span> a binary variable <code class="docutils literal notranslate"><span class="pre">taken[o]</span></code>, set to 1 when the
object is in the bag, and to 0 otherwise. We are trying to solve the
following MILP</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{Max: } &amp; \sum_{o \in L} \text{usefulness}_o \times \text{taken}_o\\
\text{Such that: } &amp; \sum_{o \in L} \text{weight}_o \times \text{taken}_o \leq C\\\end{split}\]</div>
<p>Using Sage, we will give to our items a random weight:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pan&quot;</span><span class="p">,</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="s2">&quot;knife&quot;</span><span class="p">,</span> <span class="s2">&quot;gourd&quot;</span><span class="p">,</span> <span class="s2">&quot;flashlight&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">L</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;random_stuff_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)])</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">weight</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">sage: </span><span class="n">usefulness</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">set_random_seed</span><span class="p">(</span><span class="mi">685474</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">L</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">weight</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="n">usefulness</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
</pre></div>
</div>
<p>We can now define the MILP itself</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span> <span class="o">=</span> <span class="n">MixedIntegerLinearProgram</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">taken</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">new_variable</span><span class="p">(</span><span class="n">binary</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weight</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">*</span> <span class="n">taken</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">L</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">C</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">usefulness</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">*</span> <span class="n">taken</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">L</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span> <span class="c1"># abs tol 1e-6</span>
<span class="go">3.1502766806530307</span>
<span class="gp">sage: </span><span class="n">taken</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">taken</span><span class="p">)</span>
</pre></div>
</div>
<p>The solution found is (of course) admissible</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">sum</span><span class="p">(</span><span class="n">weight</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">*</span> <span class="n">taken</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># abs tol 1e-6</span>
<span class="go">0.6964959796619171</span>
</pre></div>
</div>
<p>Should we take a flashlight?</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">taken</span><span class="p">[</span><span class="s2">&quot;flashlight&quot;</span><span class="p">]</span>
<span class="go">1.0</span>
</pre></div>
</div>
<p>Wise advice. Based on purely random considerations.</p>
</div>
</div>
<div class="section" id="matching">
<h2>Matching<a class="headerlink" href="#matching" title="Permalink to this headline">¶</a></h2>
<p>Given a graph <span class="math notranslate nohighlight">\(G\)</span>, a matching is a set of pairwise disjoint edges. The
empty set is a trivial matching. So we focus our attention on maximum
matchings: we want to find in a graph a matching whose cardinality is
maximal. Computing the maximum matching in a graph is a polynomial
problem, which is a famous result of Edmonds. Edmonds’ algorithm is
based on local improvements and the proof that a given matching is
maximum if it cannot be improved. This algorithm is not the hardest to
implement among those graph theory can offer, though this problem can
be modeled with a very simple MILP.</p>
<p>To do it, we need – as previously – to associate a binary variable
to each one of our objects: the edges of our graph (a value of 1
meaning that the corresponding edge is included in the maximum
matching). Our constraint on the edges taken being that they are
disjoint, it is enough to require that, <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> being two edges
and <span class="math notranslate nohighlight">\(m_x, m_y\)</span> their associated variables, the inequality <span class="math notranslate nohighlight">\(m_x + m_y
\leq 1\)</span> is satisfied, as we are sure that the two of them cannot both
belong to the matching. Hence, we are able to write the MILP we
want. However, the number of inequalities can be easily decreased by
noticing that two edges cannot be taken simultaneously inside a
matching if and only if they have a common endpoint <span class="math notranslate nohighlight">\(v\)</span>. We can then
require instead that at most one edge incident to <span class="math notranslate nohighlight">\(v\)</span> be taken inside
the matching, which is a linear constraint. We will be solving:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{Max: } &amp; \sum_{e \in E(G)} m_e\\
\text{Such that: } &amp; \forall v, \sum_{\substack{e \in E(G) \\ v \sim e}} m_e \leq 1\end{split}\]</div>
<p>Let us write the Sage code of this MILP:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">g</span> <span class="o">=</span> <span class="n">graphs</span><span class="o">.</span><span class="n">PetersenGraph</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">p</span> <span class="o">=</span> <span class="n">MixedIntegerLinearProgram</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">matching</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">new_variable</span><span class="p">(</span><span class="n">binary</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">matching</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="bp">False</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">p</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">matching</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
<span class="gp">....: </span>        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">edges_incident</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="go">5.0</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">matching</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">matching</span><span class="p">)</span>
<span class="gp">sage: </span><span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">matching</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># not tested</span>
<span class="go">[(0, 1), (6, 9), (2, 7), (3, 4), (5, 8)]</span>
</pre></div>
</div>
</div>
<div class="section" id="flows">
<h2>Flows<a class="headerlink" href="#flows" title="Permalink to this headline">¶</a></h2>
<p>Yet another fundamental algorithm in graph theory: maximum flow! It
consists, given a directed graph and two vertices <span class="math notranslate nohighlight">\(s, t\)</span>, in sending a
maximum <em>flow</em> from <span class="math notranslate nohighlight">\(s\)</span> to <span class="math notranslate nohighlight">\(t\)</span> using the edges of <span class="math notranslate nohighlight">\(G\)</span>, each of them
having a maximal capacity.</p>
<img alt="_images/lp_flot1.png" class="align-center" src="_images/lp_flot1.png" />
<p>The definition of this problem is almost its LP formulation. We are
looking for real values associated to each edge, which would
represent the intensity of flow going through them, under two types of
constraints:</p>
<ul class="simple">
<li>The amount of flow arriving on a vertex (different from <span class="math notranslate nohighlight">\(s\)</span> or <span class="math notranslate nohighlight">\(t\)</span>)
is equal to the amount of flow leaving it.</li>
<li>The amount of flow going through an edge is bounded by the capacity
of this edge.</li>
</ul>
<p>This being said, we have to maximize the amount of flow leaving
<span class="math notranslate nohighlight">\(s\)</span>: all of it will end up in <span class="math notranslate nohighlight">\(t\)</span>, as the other vertices are sending
just as much as they receive. We can model the flow problem with the
following LP</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{Max: } &amp; \sum_{sv \in G} f_{sv}\\
\text{Such that: } &amp; \forall v \in G, {\substack{v \neq s \\ v \neq t}}, \sum_{vu \in G} f_{vu} - \sum_{uv \in G} f_{uv} = 0\\
&amp; \forall uv \in G, f_{uv} \leq 1\\\end{split}\]</div>
<p>We will solve the flow problem on an orientation of Chvatal’s
graph, in which all the edges have a capacity of 1:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">g</span> <span class="o">=</span> <span class="n">graphs</span><span class="o">.</span><span class="n">ChvatalGraph</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">minimum_outdegree_orientation</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span> <span class="o">=</span> <span class="n">MixedIntegerLinearProgram</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">new_variable</span><span class="p">(</span><span class="n">real</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nonnegative</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">t</span><span class="p">:</span>
<span class="gp">....: </span>        <span class="n">p</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
<span class="gp">....: </span>            <span class="nb">sum</span><span class="p">(</span><span class="n">f</span><span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="n">u</span><span class="p">)]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">neighbors_out</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="gp">....: </span>            <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">f</span><span class="p">[(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">neighbors_in</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="n">p</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">f</span><span class="p">[(</span><span class="n">s</span><span class="p">,</span><span class="n">u</span><span class="p">)]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">neighbors_out</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">p</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>  <span class="c1"># rel tol 2e-11</span>
<span class="go">2.0</span>
</pre></div>
</div>
<img alt="_images/lp_flot2.png" class="align-center" src="_images/lp_flot2.png" />
</div>
<div class="section" id="solvers">
<h2>Solvers<a class="headerlink" href="#solvers" title="Permalink to this headline">¶</a></h2>
<p>Sage solves linear programs by calling specific libraries. The
following libraries are currently supported:</p>
<ul>
<li><p class="first"><a class="reference external" href="http://www.coin-or.org/projects/Cbc.xml">CBC</a>: A solver from
<a class="reference external" href="http://www.coin-or.org/">COIN-OR</a></p>
<p>Provided under the open source license CPL, but incompatible with
GPL. CBC can be installed using the shell command
<code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-i</span> <span class="pre">cbc</span> <span class="pre">sagelib</span></code>.</p>
</li>
<li><p class="first"><a class="reference external" href="http://www-01.ibm.com/software/integration/optimization/cplex/">CPLEX</a>:
A solver from <a class="reference external" href="http://www.ilog.com/">ILOG</a></p>
<p>Proprietary, but free for researchers and students.</p>
</li>
<li><p class="first"><a class="reference external" href="http://cvxopt.org/">CVXOPT</a>: an LP solver from Python Software for
Convex Optimization, uses an interior-point method, always installed in Sage.</p>
<p>Licensed under the GPL.</p>
</li>
<li><p class="first"><a class="reference external" href="http://www.gnu.org/software/glpk/">GLPK</a>: A solver from <a class="reference external" href="http://www.gnu.org/">GNU</a></p>
<p>Licensed under the GPLv3. This solver is always installed, as the default one, in Sage.</p>
</li>
<li><p class="first"><a class="reference external" href="http://www.gurobi.com/">GUROBI</a></p>
<p>Proprietary, but free for researchers and students.</p>
</li>
<li><p class="first"><a class="reference external" href="http://bugseng.com/products/ppl">PPL</a>: A solver from bugSeng.</p>
<p>This solver provides exact (arbitrary precision) computation, always installed in Sage.</p>
<p>Licensed under the GPLv3.</p>
</li>
</ul>
</div>
<div class="section" id="using-cplex-or-gurobi-through-sage">
<h2>Using CPLEX or GUROBI through Sage<a class="headerlink" href="#using-cplex-or-gurobi-through-sage" title="Permalink to this headline">¶</a></h2>
<p>ILOG’s CPLEX and GUROBI being proprietary softwares, you must be in possession
of several files to use it through Sage. In each case, the <strong>expected</strong> (it may
change !) filename is joined.</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>A valid license file</dt>
<dd><ul class="first last">
<li>CPLEX : a <code class="docutils literal notranslate"><span class="pre">.ilm</span></code> file</li>
<li>GUROBI : a <code class="docutils literal notranslate"><span class="pre">.lic</span></code> file</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>A compiled version of the library</dt>
<dd><ul class="first last">
<li>CPLEX : <code class="docutils literal notranslate"><span class="pre">libcplex.a</span></code></li>
<li>GUROBI : <code class="docutils literal notranslate"><span class="pre">libgurobi55.so</span></code> (or more recent)</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The library file</dt>
<dd><ul class="first last">
<li>CPLEX : <code class="docutils literal notranslate"><span class="pre">cplex.h</span></code></li>
<li>GUROBI : <code class="docutils literal notranslate"><span class="pre">gurobi_c.h</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The environment variable defining the licence’s path must also be set when
running Sage. You can append to your <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> file one of the following :</p>
<ul>
<li><p class="first">For CPLEX</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ILOG_LICENSE_FILE</span><span class="o">=</span>/path/to/the/license/ilog/ilm/access_1.ilm
</pre></div>
</div>
</li>
<li><p class="first">For GUROBI</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">GRB_LICENSE_FILE</span><span class="o">=</span>/path/to/the/license/gurobi.lic
</pre></div>
</div>
</li>
</ul>
<p>As Sage also needs the files library and header files the easiest way is to
create symbolic links to these files in the appropriate directories:</p>
<ul>
<li><dl class="first docutils">
<dt>For CPLEX:</dt>
<dd><ul class="first">
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">libcplex.a</span></code> – in <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/local/lib/</span></code>, type:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ln -s /path/to/lib/libcplex.a .
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">cplex.h</span></code> – in <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/local/include/</span></code>, type:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ln -s /path/to/include/cplex.h .
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">cpxconst.h</span></code> (if it exists) – in <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/local/include/</span></code>, type:</p>
</li>
</ul>
<blockquote class="last">
<div><div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ln -s /path/to/include/cpxconst.h .
</pre></div>
</div>
</div></blockquote>
</dd>
</dl>
</li>
<li><p class="first">For GUROBI</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">libgurobi56.so</span></code> – in <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/local/lib/</span></code>, type:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ln -s /path/to/lib/libgurobi56.so libgurobi.so
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">gurobi_c.h</span></code> – in <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/local/include/</span></code>, type:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ln -s /path/to/include/gurobi_c.h .
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p><strong>It is very important that the names of the symbolic links in Sage’s folders
be precisely as indicated. If the names differ, Sage will not notice that
the files are present</strong></p>
<p>Once this is done, Sage is to be asked to notice the changes by running:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> make
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Linear Programming (Mixed Integer)</a><ul>
<li><a class="reference internal" href="#definition">Definition</a></li>
<li><a class="reference internal" href="#mixed-integer-linear-programming">Mixed integer linear programming</a></li>
<li><a class="reference internal" href="#practical">Practical</a><ul>
<li><a class="reference internal" href="#the-milp-class">The <code class="docutils literal notranslate"><span class="pre">MILP</span></code> class</a></li>
<li><a class="reference internal" href="#variables">Variables</a><ul>
<li><a class="reference internal" href="#typed-variables-and-bounds">Typed variables and bounds</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#basic-linear-programs">Basic linear programs</a><ul>
<li><a class="reference internal" href="#knapsack">Knapsack</a></li>
</ul>
</li>
<li><a class="reference internal" href="#matching">Matching</a></li>
<li><a class="reference internal" href="#flows">Flows</a></li>
<li><a class="reference internal" href="#solvers">Solvers</a></li>
<li><a class="reference internal" href="#using-cplex-or-gurobi-through-sage">Using CPLEX or GUROBI through Sage</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="vector_calculus/vector_calc_plane.html"
                        title="previous chapter">Vector calculus in the Euclidean plane</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="numtheory_rsa.html"
                        title="next chapter">Number Theory and the RSA Public Key Cryptosystem</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/linear_programming.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="numtheory_rsa.html" title="Number Theory and the RSA Public Key Cryptosystem"
             >next</a> |</li>
        <li class="right" >
          <a href="vector_calculus/vector_calc_plane.html" title="Vector calculus in the Euclidean plane"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/logo_sagemath_black.svg" height="28" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="index.html">Thematic Tutorials v8.9</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="toctree.html" >Thematic tutorial document tree</a> &#187;</li> 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2005--2019, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>